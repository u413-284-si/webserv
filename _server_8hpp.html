<!-- HTML header for doxygen 1.9.4-->
<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=11" />
	<meta name="generator" content="Doxygen 1.9.1" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>webserv: inc/Server.hpp File Reference</title>
	<link href="tabs.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<link href="doxygen.css" rel="stylesheet" type="text/css" />
	<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
	<script type="text/javascript">
		DoxygenAwesomeDarkModeToggle.init()
	</script>
	<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
	<script type="text/javascript">
		DoxygenAwesomeFragmentCopyButton.init()
	</script>
	<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
	<script type="text/javascript">
		DoxygenAwesomeParagraphLink.init()
	</script>
</head>
<body>
		<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
			<div id="titlearea">
				<table cellspacing="0" cellpadding="0">
					<tbody>
						<tr id="projectrow">
							<td id="projectalign">
								<div id="projectname">webserv
								</div>
								<div id="projectbrief">This is when you finally understand why a URL starts with HTTP.</div>
							</td>
						</tr>
						<!--BEGIN FULL_SIDEBAR-->
						<tr>
							<td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
						</tr>
						<!--END FULL_SIDEBAR-->
					</tbody>
				</table>
			</div>
			<!-- end header part --><!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_server_8hpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Server.hpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="_config_file_8hpp_source.html">ConfigFile.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_connection_8hpp_source.html">Connection.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="constants_8hpp_source.html">constants.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_epoll_wrapper_8hpp_source.html">EpollWrapper.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_file_system_policy_8hpp_source.html">FileSystemPolicy.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_log_8hpp_source.html">Log.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_request_parser_8hpp_source.html">RequestParser.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_response_builder_8hpp_source.html">ResponseBuilder.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_socket_8hpp_source.html">Socket.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_socket_policy_8hpp_source.html">SocketPolicy.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_status_code_8hpp_source.html">StatusCode.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_target_resource_handler_8hpp_source.html">TargetResourceHandler.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="error_8hpp_source.html">error.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="signal_handler_8hpp_source.html">signalHandler.hpp</a>&quot;</code><br />
<code>#include &lt;algorithm&gt;</code><br />
<code>#include &lt;bits/types/time_t.h&gt;</code><br />
<code>#include &lt;cassert&gt;</code><br />
<code>#include &lt;cerrno&gt;</code><br />
<code>#include &lt;cstdio&gt;</code><br />
<code>#include &lt;cstdlib&gt;</code><br />
<code>#include &lt;cstring&gt;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;map&gt;</code><br />
<code>#include &lt;netdb.h&gt;</code><br />
<code>#include &lt;netinet/in.h&gt;</code><br />
<code>#include &lt;stdexcept&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;sys/epoll.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;utility&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for Server.hpp:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp__dep__incl.svg" width="100%" height="395"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div>
<p><a href="_server_8hpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_server.html">Server</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main class of the HTTP server.  <a href="class_server.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a35359f61d42dbd6561a07c12009ca45a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#a35359f61d42dbd6561a07c12009ca45a">initVirtualServers</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int backlog, const std::vector&lt; <a class="el" href="struct_config_server.html">ConfigServer</a> &gt; &amp;serverConfigs)</td></tr>
<tr class="memdesc:a35359f61d42dbd6561a07c12009ca45a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize virtual servers.  <a href="_server_8hpp.html#a35359f61d42dbd6561a07c12009ca45a">More...</a><br /></td></tr>
<tr class="separator:a35359f61d42dbd6561a07c12009ca45a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f6456b9a16154a6d320ae8b370285d6"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#a4f6456b9a16154a6d320ae8b370285d6">isDuplicateServer</a> (const <a class="el" href="class_server.html">Server</a> &amp;server, const std::string &amp;host, const std::string &amp;port)</td></tr>
<tr class="memdesc:a4f6456b9a16154a6d320ae8b370285d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check for duplicate virtual servers.  <a href="_server_8hpp.html#a4f6456b9a16154a6d320ae8b370285d6">More...</a><br /></td></tr>
<tr class="separator:a4f6456b9a16154a6d320ae8b370285d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6ca6a0179cbb661c05aa6b2758f5389"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">createVirtualServer</a> (<a class="el" href="class_server.html">Server</a> &amp;server, const std::string &amp;host, int backlog, const std::string &amp;port)</td></tr>
<tr class="memdesc:aa6ca6a0179cbb661c05aa6b2758f5389"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a new virtual server and registers it with the server object.  <a href="_server_8hpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">More...</a><br /></td></tr>
<tr class="separator:aa6ca6a0179cbb661c05aa6b2758f5389"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab66b27c2186daacb15a6b13dd43be31b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#ab66b27c2186daacb15a6b13dd43be31b">runServer</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:ab66b27c2186daacb15a6b13dd43be31b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Runs the main event loop with a server object.  <a href="_server_8hpp.html#ab66b27c2186daacb15a6b13dd43be31b">More...</a><br /></td></tr>
<tr class="separator:ab66b27c2186daacb15a6b13dd43be31b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4211c4d6b958979b39b3dfc8148c801a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#a4211c4d6b958979b39b3dfc8148c801a">handleEvent</a> (<a class="el" href="class_server.html">Server</a> &amp;server, struct epoll_event)</td></tr>
<tr class="memdesc:a4211c4d6b958979b39b3dfc8148c801a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accepts new connections or handles existing ones.  <a href="_server_8hpp.html#a4211c4d6b958979b39b3dfc8148c801a">More...</a><br /></td></tr>
<tr class="separator:a4211c4d6b958979b39b3dfc8148c801a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb579f3d67061d752e882e6fb3ef6f18"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#adb579f3d67061d752e882e6fb3ef6f18">acceptConnections</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int serverFd, const <a class="el" href="struct_socket.html">Socket</a> &amp;serverSock, uint32_t eventMask)</td></tr>
<tr class="memdesc:adb579f3d67061d752e882e6fb3ef6f18"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accept new connections.  <a href="_server_8hpp.html#adb579f3d67061d752e882e6fb3ef6f18">More...</a><br /></td></tr>
<tr class="separator:adb579f3d67061d752e882e6fb3ef6f18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac74673700d26f829e84f0b5011c35c94"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#ac74673700d26f829e84f0b5011c35c94">handleConnection</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:ac74673700d26f829e84f0b5011c35c94"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle a client connection.  <a href="_server_8hpp.html#ac74673700d26f829e84f0b5011c35c94">More...</a><br /></td></tr>
<tr class="separator:ac74673700d26f829e84f0b5011c35c94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06d0cb066f08d5567ea6ba4ef2897927"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#a06d0cb066f08d5567ea6ba4ef2897927">connectionReceiveHeader</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a06d0cb066f08d5567ea6ba4ef2897927"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive request header from a client.  <a href="_server_8hpp.html#a06d0cb066f08d5567ea6ba4ef2897927">More...</a><br /></td></tr>
<tr class="separator:a06d0cb066f08d5567ea6ba4ef2897927"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a172c400277e73261d212c33f66226090"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#a172c400277e73261d212c33f66226090">isCompleteRequestHeader</a> (const std::string &amp;connectionBuffer)</td></tr>
<tr class="memdesc:a172c400277e73261d212c33f66226090"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the connection buffer contains a request header.  <a href="_server_8hpp.html#a172c400277e73261d212c33f66226090">More...</a><br /></td></tr>
<tr class="separator:a172c400277e73261d212c33f66226090"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83350eae81b96dd7b301d1238268ffdb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#a83350eae81b96dd7b301d1238268ffdb">handleCompleteRequestHeader</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a83350eae81b96dd7b301d1238268ffdb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a received complete request header.  <a href="_server_8hpp.html#a83350eae81b96dd7b301d1238268ffdb">More...</a><br /></td></tr>
<tr class="separator:a83350eae81b96dd7b301d1238268ffdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f930db051b00ade521e2633cee948bd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#a3f930db051b00ade521e2633cee948bd">connectionReceiveBody</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a3f930db051b00ade521e2633cee948bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receives the body of a connection.  <a href="_server_8hpp.html#a3f930db051b00ade521e2633cee948bd">More...</a><br /></td></tr>
<tr class="separator:a3f930db051b00ade521e2633cee948bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14a0c5a1227276017a19d9b52141c13a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#a14a0c5a1227276017a19d9b52141c13a">isCompleteBody</a> (<a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a14a0c5a1227276017a19d9b52141c13a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the HTTP request body has been completely received.  <a href="_server_8hpp.html#a14a0c5a1227276017a19d9b52141c13a">More...</a><br /></td></tr>
<tr class="separator:a14a0c5a1227276017a19d9b52141c13a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac98878a19797a7f939c3a5ea1e028e56"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#ac98878a19797a7f939c3a5ea1e028e56">connectionBuildResponse</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:ac98878a19797a7f939c3a5ea1e028e56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Builds the response for a client connection.  <a href="_server_8hpp.html#ac98878a19797a7f939c3a5ea1e028e56">More...</a><br /></td></tr>
<tr class="separator:ac98878a19797a7f939c3a5ea1e028e56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcf8118ac987f6afae3aec0c54cc5f9f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#adcf8118ac987f6afae3aec0c54cc5f9f">connectionSendResponse</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:adcf8118ac987f6afae3aec0c54cc5f9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the response to a client connection.  <a href="_server_8hpp.html#adcf8118ac987f6afae3aec0c54cc5f9f">More...</a><br /></td></tr>
<tr class="separator:adcf8118ac987f6afae3aec0c54cc5f9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb21ebec72f9526fbba446f7d566117e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#abb21ebec72f9526fbba446f7d566117e">connectionHandleTimeout</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:abb21ebec72f9526fbba446f7d566117e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a timeout for a client connection.  <a href="_server_8hpp.html#abb21ebec72f9526fbba446f7d566117e">More...</a><br /></td></tr>
<tr class="separator:abb21ebec72f9526fbba446f7d566117e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28fd29ec48bd9459c678980cfccca4cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#a28fd29ec48bd9459c678980cfccca4cf">checkForTimeout</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:a28fd29ec48bd9459c678980cfccca4cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterates through all connections and checks if any have timed out.  <a href="_server_8hpp.html#a28fd29ec48bd9459c678980cfccca4cf">More...</a><br /></td></tr>
<tr class="separator:a28fd29ec48bd9459c678980cfccca4cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e2693ba11e20b84de090bcdd0b665db"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#a9e2693ba11e20b84de090bcdd0b665db">cleanupClosedConnections</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:a9e2693ba11e20b84de090bcdd0b665db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterates through all connections and removes closed ones.  <a href="_server_8hpp.html#a9e2693ba11e20b84de090bcdd0b665db">More...</a><br /></td></tr>
<tr class="separator:a9e2693ba11e20b84de090bcdd0b665db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2feae308a0fa968c84525fcdfb19251"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#af2feae308a0fa968c84525fcdfb19251">cleanupIdleConnections</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:af2feae308a0fa968c84525fcdfb19251"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterates through all connections, closes and removes idle ones.  <a href="_server_8hpp.html#af2feae308a0fa968c84525fcdfb19251">More...</a><br /></td></tr>
<tr class="separator:af2feae308a0fa968c84525fcdfb19251"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a115ecd76e344c1007bedc48b9bbdc0fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8hpp.html#a115ecd76e344c1007bedc48b9bbdc0fa">shutdownServer</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:a115ecd76e344c1007bedc48b9bbdc0fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a graceful shutdown of the server.  <a href="_server_8hpp.html#a115ecd76e344c1007bedc48b9bbdc0fa">More...</a><br /></td></tr>
<tr class="separator:a115ecd76e344c1007bedc48b9bbdc0fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a35359f61d42dbd6561a07c12009ca45a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35359f61d42dbd6561a07c12009ca45a">&#9670;&nbsp;</a></span>initVirtualServers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool initVirtualServers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>backlog</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="struct_config_server.html">ConfigServer</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>serverConfigs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize virtual servers. </p>
<p>First initializes all wildcard servers (0.0.0.0) in the configuration file by opening a socket for them. They need to be initialized first because any already initialized socket on the same port would block the wildcard server. Then initializes the remaining virtual servers. It checks for duplicate servers using <a class="el" href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6" title="Check for duplicate virtual servers.">isDuplicateServer()</a> and skips opening the socket server if it already exists.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to initialize virtual servers for. </td></tr>
    <tr><td class="paramname">backlog</td><td>The maximum length to which the queue of pending connections for the virtual server may grow. </td></tr>
    <tr><td class="paramname">serverConfigs</td><td>The vector of server configurations from the configuration file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if at least one virtual server was added, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00408">408</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;{</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Initializing virtual servers&quot;</span>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Check for wildcard servers&quot;</span>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keyword">const</span> std::string wildcard = <span class="stringliteral">&quot;0.0.0.0&quot;</span>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">for</span> (std::vector&lt;ConfigServer&gt;::const_iterator iter = serverConfigs.begin(); iter != serverConfigs.end(); ++iter) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;host == wildcard) {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Adding virtual server: &quot;</span> &lt;&lt; iter-&gt;host &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; iter-&gt;port;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">isDuplicateServer</a>(server, iter-&gt;host, iter-&gt;port))</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">createVirtualServer</a>(server, iter-&gt;host, backlog, iter-&gt;port))</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Failed to add virtual server: &quot;</span> &lt;&lt; iter-&gt;host &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; iter-&gt;port;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Add remaining virtual servers&quot;</span>;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">for</span> (std::vector&lt;ConfigServer&gt;::const_iterator iter = serverConfigs.begin(); iter != serverConfigs.end(); ++iter) {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Adding virtual server: &quot;</span> &lt;&lt; iter-&gt;host &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; iter-&gt;port;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">isDuplicateServer</a>(server, iter-&gt;host, iter-&gt;port))</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">createVirtualServer</a>(server, iter-&gt;host, backlog, iter-&gt;port))</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Failed to add virtual server: &quot;</span> &lt;&lt; iter-&gt;serverName;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">if</span> (server.<a class="code" href="class_server.html#ad5228a2a917b01adff3b89007c036ec4">getVirtualServers</a>().empty())</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Finished setting up virtual servers&quot;</span>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;}</div>
<div class="ttc" id="a_log_8hpp_html_a6ff63e8955665c4a58b1598f2b07c51a"><div class="ttname"><a href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a></div><div class="ttdeci">#define LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="_log_8hpp_source.html#l00010">Log.hpp:10</a></div></div>
<div class="ttc" id="a_log_8hpp_html_aeb4f36db01bd128c7afeac5889dac311"><div class="ttname"><a href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a></div><div class="ttdeci">#define LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="_log_8hpp_source.html#l00011">Log.hpp:11</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a4f6456b9a16154a6d320ae8b370285d6"><div class="ttname"><a href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">isDuplicateServer</a></div><div class="ttdeci">bool isDuplicateServer(const Server &amp;server, const std::string &amp;host, const std::string &amp;port)</div><div class="ttdoc">Check for duplicate virtual servers.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00461">Server.cpp:461</a></div></div>
<div class="ttc" id="a_server_8cpp_html_aa6ca6a0179cbb661c05aa6b2758f5389"><div class="ttname"><a href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">createVirtualServer</a></div><div class="ttdeci">bool createVirtualServer(Server &amp;server, const std::string &amp;host, int backlog, const std::string &amp;port)</div><div class="ttdoc">Creates a new virtual server and registers it with the server object.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00504">Server.cpp:504</a></div></div>
<div class="ttc" id="aclass_server_html_ad5228a2a917b01adff3b89007c036ec4"><div class="ttname"><a href="class_server.html#ad5228a2a917b01adff3b89007c036ec4">Server::getVirtualServers</a></div><div class="ttdeci">std::map&lt; int, Socket &gt; &amp; getVirtualServers()</div><div class="ttdoc">Getter for virtual servers.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00063">Server.cpp:63</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a35359f61d42dbd6561a07c12009ca45a_cgraph.svg" width="100%" height="504"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a35359f61d42dbd6561a07c12009ca45a_icgraph.svg" width="263" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a4f6456b9a16154a6d320ae8b370285d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f6456b9a16154a6d320ae8b370285d6">&#9670;&nbsp;</a></span>isDuplicateServer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isDuplicateServer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check for duplicate virtual servers. </p>
<p>Checks if a virtual server with the provided host and port already exists in the virtual servers map. If the host is "localhost", it checks for a virtual server with the host address "127.0.0.1" or "::1". If the existing server is a wildcard server (0.0.0.0) only the port needs to match.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to check for duplicate virtual servers. </td></tr>
    <tr><td class="paramname">host</td><td>The host address of the virtual server. </td></tr>
    <tr><td class="paramname">port</td><td>The port number of the virtual server.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if a duplicate virtual server exists, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00461">461</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;{</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keyword">const</span> std::string wildcard = <span class="stringliteral">&quot;0.0.0.0&quot;</span>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">if</span> (host == <span class="stringliteral">&quot;localhost&quot;</span>) {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keywordflow">for</span> (std::map&lt;int, Socket&gt;::const_iterator iter = server.<a class="code" href="class_server.html#ad5228a2a917b01adff3b89007c036ec4">getVirtualServers</a>().begin();</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;             iter != server.<a class="code" href="class_server.html#ad5228a2a917b01adff3b89007c036ec4">getVirtualServers</a>().end(); ++iter) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="keywordflow">if</span> ((iter-&gt;second.host == wildcard || iter-&gt;second.host == <span class="stringliteral">&quot;127.0.0.1&quot;</span> || iter-&gt;second.host == <span class="stringliteral">&quot;::1&quot;</span>)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                &amp;&amp; iter-&gt;second.port == port) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Virtual server already exists: &quot;</span> &lt;&lt; iter-&gt;second;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">for</span> (std::map&lt;int, Socket&gt;::const_iterator iter = server.<a class="code" href="class_server.html#ad5228a2a917b01adff3b89007c036ec4">getVirtualServers</a>().begin();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;             iter != server.<a class="code" href="class_server.html#ad5228a2a917b01adff3b89007c036ec4">getVirtualServers</a>().end(); ++iter) {</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <span class="keywordflow">if</span> ((iter-&gt;second.host == wildcard || iter-&gt;second.host == host) &amp;&amp; iter-&gt;second.port == port) {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Virtual server already exists: &quot;</span> &lt;&lt; iter-&gt;second;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        }</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a4f6456b9a16154a6d320ae8b370285d6_cgraph.svg" width="382" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a4f6456b9a16154a6d320ae8b370285d6_icgraph.svg" width="448" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aa6ca6a0179cbb661c05aa6b2758f5389"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6ca6a0179cbb661c05aa6b2758f5389">&#9670;&nbsp;</a></span>createVirtualServer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool createVirtualServer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>backlog</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a new virtual server and registers it with the server object. </p>
<p>Creates a listening socket for a virtual server using the provided host, port, and backlog and adds it to the virtual servers map. Uses <a class="el" href="class_server.html#abf1dc68ec7f88650ad80e93f56e14e5c" title="Wrapper function to SocketPolicy::resolveListeningAddresses.">Server::resolveListeningAddresses()</a> to get a list of address information for the provided host and port. It then tries to create a listening socket for each value in the list using <a class="el" href="class_server.html#a4e98a13498a791a2f3639e67e5b849e0" title="Wrapper function to SocketPolicy::createListeningSocket.">Server::createListeningSocket()</a>. If succesful calls <a class="el" href="class_server.html#ae4900f55d072ebbe26a92c14b17de396" title="Wrapper function to SocketPolicy::retrieveSocketInfo.">Server::retrieveSocketInfo()</a> and registers the virtual server using <a class="el" href="class_server.html#aae8cc5a8fc07a6ce97d468d94cd08a6e" title="Register a virtual server.">Server::registerVirtualServer()</a>. If any step fails, it continues to the next value in the list. After the loop, the created address list is freed. If no valid socket was created, it logs an error and returns false.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to add the virtual server to. </td></tr>
    <tr><td class="paramname">host</td><td>host address for the virtual server. </td></tr>
    <tr><td class="paramname">backlog</td><td>maximum length to which the queue of pending connections for the virtual server may grow. </td></tr>
    <tr><td class="paramname">port</td><td>port number for the virtual server.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the virtual server was successfully added, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00504">504</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;{</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keyword">struct </span>addrinfo* list = server.<a class="code" href="class_server.html#abf1dc68ec7f88650ad80e93f56e14e5c">resolveListeningAddresses</a>(host, port);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> (list == NULL)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordtype">size_t</span> successfulSock = 0;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordtype">size_t</span> countTryCreateSocket = 1;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">struct</span> addrinfo* curr = list; curr != NULL; curr = curr-&gt;ai_next) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; countTryCreateSocket &lt;&lt; <span class="stringliteral">&quot;. try to create listening socket&quot;</span>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> newFd = server.<a class="code" href="class_server.html#a4e98a13498a791a2f3639e67e5b849e0">createListeningSocket</a>(curr, backlog);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">if</span> (newFd == -1)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keyword">const</span> <a class="code" href="struct_socket.html">Socket</a> serverSock = server.<a class="code" href="class_server.html#ae4900f55d072ebbe26a92c14b17de396">retrieveSocketInfo</a>(curr-&gt;ai_addr);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="keywordflow">if</span> (serverSock.<a class="code" href="struct_socket.html#a986f7cf6e2d3334e9ad91a35681c1f80">host</a>.empty() &amp;&amp; serverSock.<a class="code" href="struct_socket.html#af75711bf9c0f0788d7767f836a97c5e6">port</a>.empty()) {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            close(newFd);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">if</span> (!server.<a class="code" href="class_server.html#aae8cc5a8fc07a6ce97d468d94cd08a6e">registerVirtualServer</a>(newFd, serverSock))</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        ++successfulSock;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    freeaddrinfo(list);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">if</span> (successfulSock == 0) {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Cannot bind to a valid socket.&quot;</span>;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160; </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;}</div>
<div class="ttc" id="a_log_8hpp_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="_log_8hpp_source.html#l00013">Log.hpp:13</a></div></div>
<div class="ttc" id="aclass_server_html_a4e98a13498a791a2f3639e67e5b849e0"><div class="ttname"><a href="class_server.html#a4e98a13498a791a2f3639e67e5b849e0">Server::createListeningSocket</a></div><div class="ttdeci">int createListeningSocket(const struct addrinfo *addrinfo, int backlog) const</div><div class="ttdoc">Wrapper function to SocketPolicy::createListeningSocket.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00255">Server.cpp:255</a></div></div>
<div class="ttc" id="aclass_server_html_aae8cc5a8fc07a6ce97d468d94cd08a6e"><div class="ttname"><a href="class_server.html#aae8cc5a8fc07a6ce97d468d94cd08a6e">Server::registerVirtualServer</a></div><div class="ttdeci">bool registerVirtualServer(int serverFd, const Socket &amp;serverSock)</div><div class="ttdoc">Register a virtual server.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00130">Server.cpp:130</a></div></div>
<div class="ttc" id="aclass_server_html_abf1dc68ec7f88650ad80e93f56e14e5c"><div class="ttname"><a href="class_server.html#abf1dc68ec7f88650ad80e93f56e14e5c">Server::resolveListeningAddresses</a></div><div class="ttdeci">struct addrinfo * resolveListeningAddresses(const std::string &amp;host, const std::string &amp;port) const</div><div class="ttdoc">Wrapper function to SocketPolicy::resolveListeningAddresses.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00243">Server.cpp:243</a></div></div>
<div class="ttc" id="aclass_server_html_ae4900f55d072ebbe26a92c14b17de396"><div class="ttname"><a href="class_server.html#ae4900f55d072ebbe26a92c14b17de396">Server::retrieveSocketInfo</a></div><div class="ttdeci">Socket retrieveSocketInfo(struct sockaddr *sockaddr) const</div><div class="ttdoc">Wrapper function to SocketPolicy::retrieveSocketInfo.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00268">Server.cpp:268</a></div></div>
<div class="ttc" id="astruct_socket_html"><div class="ttname"><a href="struct_socket.html">Socket</a></div><div class="ttdoc">Represent a socket connection.</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8hpp_source.html#l00008">Socket.hpp:8</a></div></div>
<div class="ttc" id="astruct_socket_html_a986f7cf6e2d3334e9ad91a35681c1f80"><div class="ttname"><a href="struct_socket.html#a986f7cf6e2d3334e9ad91a35681c1f80">Socket::host</a></div><div class="ttdeci">std::string host</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8hpp_source.html#l00009">Socket.hpp:9</a></div></div>
<div class="ttc" id="astruct_socket_html_af75711bf9c0f0788d7767f836a97c5e6"><div class="ttname"><a href="struct_socket.html#af75711bf9c0f0788d7767f836a97c5e6">Socket::port</a></div><div class="ttdeci">std::string port</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8hpp_source.html#l00010">Socket.hpp:10</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_aa6ca6a0179cbb661c05aa6b2758f5389_cgraph.svg" width="100%" height="466"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_aa6ca6a0179cbb661c05aa6b2758f5389_icgraph.svg" width="459" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab66b27c2186daacb15a6b13dd43be31b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab66b27c2186daacb15a6b13dd43be31b">&#9670;&nbsp;</a></span>runServer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void runServer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Runs the main event loop with a server object. </p>
<p>This functions enters a continuous loop to handle incoming events == connections. It waits for events with the <a class="el" href="class_epoll_wrapper.html" title="Wrapper class for epoll instance.">EpollWrapper</a>. If a vector of events is returned it processes all of them via <a class="el" href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4" title="Accepts new connections or handles existing ones.">handleEvent()</a>. When events are processed or the server.waitForEvents() timeout happens checks for connection timeouts with <a class="el" href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf" title="Iterates through all connections and checks if any have timed out.">checkForTimeout()</a>. Then cleans up closed connections with <a class="el" href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db" title="Iterates through all connections and removes closed ones.">cleanupClosedConnections()</a>. The loop continues until a signal is received and saved in g_SignalStatus. It then logs the signal. If the signal is SIGQUIT it performs a graceful shutdown with <a class="el" href="_server_8cpp.html#a115ecd76e344c1007bedc48b9bbdc0fa" title="Performs a graceful shutdown of the server.">shutdownServer()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to run the event loop for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">std::runtime_error</td><td>if waitForEvents() encounters an error. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00556">556</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;{</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Server started&quot;</span>;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a> == 0) {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> nfds = server.<a class="code" href="class_server.html#acbcbebe2c30446acc9a90f40f9986b62">waitForEvents</a>();</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160; </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="keywordflow">for</span> (std::vector&lt;struct epoll_event&gt;::const_iterator iter = server.<a class="code" href="class_server.html#a1768b6e65ed7b3205141698ca459ffd8">eventsBegin</a>();</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;             iter != server.<a class="code" href="class_server.html#a1768b6e65ed7b3205141698ca459ffd8">eventsBegin</a>() + nfds; ++iter) {</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <a class="code" href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4">handleEvent</a>(server, *iter);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <a class="code" href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf">checkForTimeout</a>(server);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <a class="code" href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">cleanupClosedConnections</a>(server);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Received signal &quot;</span> &lt;&lt; <a class="code" href="signal_handler_8hpp.html#adc4193659d5893030190dca46c276ac7">signalNumToName</a>(<a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a>);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a> == SIGQUIT)</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <a class="code" href="_server_8cpp.html#a115ecd76e344c1007bedc48b9bbdc0fa">shutdownServer</a>(server);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a115ecd76e344c1007bedc48b9bbdc0fa"><div class="ttname"><a href="_server_8cpp.html#a115ecd76e344c1007bedc48b9bbdc0fa">shutdownServer</a></div><div class="ttdeci">void shutdownServer(Server &amp;server)</div><div class="ttdoc">Performs a graceful shutdown of the server.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01133">Server.cpp:1133</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a28fd29ec48bd9459c678980cfccca4cf"><div class="ttname"><a href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf">checkForTimeout</a></div><div class="ttdeci">void checkForTimeout(Server &amp;server)</div><div class="ttdoc">Iterates through all connections and checks if any have timed out.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01059">Server.cpp:1059</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a9e2693ba11e20b84de090bcdd0b665db"><div class="ttname"><a href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">cleanupClosedConnections</a></div><div class="ttdeci">void cleanupClosedConnections(Server &amp;server)</div><div class="ttdoc">Iterates through all connections and removes closed ones.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01086">Server.cpp:1086</a></div></div>
<div class="ttc" id="a_server_8cpp_html_af9f4479a6262c17deef89938118d27f4"><div class="ttname"><a href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4">handleEvent</a></div><div class="ttdeci">void handleEvent(Server &amp;server, struct epoll_event event)</div><div class="ttdoc">Accepts new connections or handles existing ones.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00595">Server.cpp:595</a></div></div>
<div class="ttc" id="aclass_server_html_a1768b6e65ed7b3205141698ca459ffd8"><div class="ttname"><a href="class_server.html#a1768b6e65ed7b3205141698ca459ffd8">Server::eventsBegin</a></div><div class="ttdeci">std::vector&lt; struct epoll_event &gt;::const_iterator eventsBegin() const</div><div class="ttdoc">Wrapper function to EpollWrapper::eventsBegin.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00207">Server.cpp:207</a></div></div>
<div class="ttc" id="aclass_server_html_acbcbebe2c30446acc9a90f40f9986b62"><div class="ttname"><a href="class_server.html#acbcbebe2c30446acc9a90f40f9986b62">Server::waitForEvents</a></div><div class="ttdeci">int waitForEvents()</div><div class="ttdoc">Wrapper function to EpollWrapper::waitForEvents.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00200">Server.cpp:200</a></div></div>
<div class="ttc" id="asignal_handler_8hpp_html_a8dcc1e48e0bf890094e11efb58edafa1"><div class="ttname"><a href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a></div><div class="ttdeci">volatile std::sig_atomic_t g_signalStatus</div><div class="ttdef"><b>Definition:</b> <a href="signal_handler_8cpp_source.html#l00005">signalHandler.cpp:5</a></div></div>
<div class="ttc" id="asignal_handler_8hpp_html_adc4193659d5893030190dca46c276ac7"><div class="ttname"><a href="signal_handler_8hpp.html#adc4193659d5893030190dca46c276ac7">signalNumToName</a></div><div class="ttdeci">std::string signalNumToName(int signum)</div><div class="ttdoc">Converts a signal number to its name.</div><div class="ttdef"><b>Definition:</b> <a href="signal_handler_8cpp_source.html#l00020">signalHandler.cpp:20</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_ab66b27c2186daacb15a6b13dd43be31b_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_ab66b27c2186daacb15a6b13dd43be31b_icgraph.svg" width="199" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a4211c4d6b958979b39b3dfc8148c801a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4211c4d6b958979b39b3dfc8148c801a">&#9670;&nbsp;</a></span>handleEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleEvent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct epoll_event&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accepts new connections or handles existing ones. </p>
<p>This function acts as a general dispatcher for handling events. Checks if the event file descriptor is in the virtual servers map. If it is, it calls <a class="el" href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18" title="Accept new connections.">acceptConnections()</a>. If the event mask contains EPOLLERR, it logs an error and closes the virtual server.</p>
<p>If it is not in the virtual servers map, then it is a connection event. If the event mask contains EPOLLERR or EPOLLHUP, the event mask is set to EPOLLIN. This is done to handle errors and hangups that may occur during the processing of the connection. The <a class="el" href="class_server.html" title="Main class of the HTTP server.">Server</a> could then try to recv(), which will return 0 in case of EPOLLHUP or -1 in case of EPOLLERR, resulting in a connection close. </p><dl class="section see"><dt>See also</dt><dd><a href="https://stackoverflow.com/a/29206631">https://stackoverflow.com/a/29206631</a></dd></dl>
<p>handleConnections() is called with the connection from the connections map. A connection should exist in the connections map, therefore it is not checked if the file descriptor is in the connections map.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>The epoll event to handle. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00595">595</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;{</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    uint32_t eventMask = <span class="keyword">event</span>.events;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    std::map&lt;int, Socket&gt;::const_iterator iter = server.<a class="code" href="class_server.html#ad5228a2a917b01adff3b89007c036ec4">getVirtualServers</a>().find(event.data.fd);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span> (iter != server.<a class="code" href="class_server.html#ad5228a2a917b01adff3b89007c036ec4">getVirtualServers</a>().end()) {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordflow">if</span> ((eventMask &amp; EPOLLERR) != 0) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Error condition happened on the associated file descriptor of &quot;</span> &lt;&lt; iter-&gt;second;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            close(event.data.fd);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <a class="code" href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18">acceptConnections</a>(server, iter-&gt;first, iter-&gt;second, eventMask);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">if</span> ((eventMask &amp; EPOLLERR) != 0) {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;epoll_wait: EPOLLERR&quot;</span>;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            eventMask = EPOLLIN;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((eventMask &amp; EPOLLHUP) != 0) {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;epoll_wait: EPOLLHUP&quot;</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            eventMask = EPOLLIN;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <a class="code" href="_server_8cpp.html#a581dddd40d3728b6d22216003e2065b5">handleConnection</a>(server, event.data.fd, server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().at(event.data.fd));</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a581dddd40d3728b6d22216003e2065b5"><div class="ttname"><a href="_server_8cpp.html#a581dddd40d3728b6d22216003e2065b5">handleConnection</a></div><div class="ttdeci">void handleConnection(Server &amp;server, const int clientFd, Connection &amp;connection)</div><div class="ttdoc">Handle a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00709">Server.cpp:709</a></div></div>
<div class="ttc" id="a_server_8cpp_html_adb579f3d67061d752e882e6fb3ef6f18"><div class="ttname"><a href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18">acceptConnections</a></div><div class="ttdeci">void acceptConnections(Server &amp;server, int serverFd, const Socket &amp;serverSock, uint32_t eventMask)</div><div class="ttdoc">Accept new connections.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00640">Server.cpp:640</a></div></div>
<div class="ttc" id="aclass_server_html_aab1a7e57f49a0c7b7f1cea147d8bf9aa"><div class="ttname"><a href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">Server::getConnections</a></div><div class="ttdeci">std::map&lt; int, Connection &gt; &amp; getConnections()</div><div class="ttdoc">Getter for connections.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00077">Server.cpp:77</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a4211c4d6b958979b39b3dfc8148c801a_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a4211c4d6b958979b39b3dfc8148c801a_icgraph.svg" width="524" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="adb579f3d67061d752e882e6fb3ef6f18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb579f3d67061d752e882e6fb3ef6f18">&#9670;&nbsp;</a></span>acceptConnections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void acceptConnections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>serverFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_socket.html">Socket</a> &amp;&#160;</td>
          <td class="paramname"><em>serverSock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>eventMask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accept new connections. </p>
<p>If the event mask does not contain <code>EPOLLIN</code>, it logs an error and returns. A server socket should always receive a read event.</p>
<p>In a loop, calls <a class="el" href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865" title="Wrapper function to SocketPolicy::acceptSingleConnection().">Server::acceptSingleConnection()</a> to accept new connections on the server socket. When <a class="el" href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865" title="Wrapper function to SocketPolicy::acceptSingleConnection().">Server::acceptSingleConnection()</a> is successful, information of the client socket is retrieved with <a class="el" href="class_server.html#ae4900f55d072ebbe26a92c14b17de396" title="Wrapper function to SocketPolicy::retrieveSocketInfo.">Server::retrieveSocketInfo()</a>. This new client socket is then registered with <a class="el" href="class_server.html#ac145e9f668db85b10a66829bd2677746" title="Register a connection.">Server::registerConnection()</a>.</p>
<p>The while-loop allows for multiple connections to be accepted in one call of this function. It is broken when accept() sets errno to EAGAIN or EWOULDBLOCK (equivalent error codes indicating that a non-blocking operation would normally block), meaning that no more connections are pending. If another errno is returned logs an error and continues to the next iteration of the loop. This is because the server sockets are in EPOLLET mode. If only one connection would be accepted the same server fd would not be reported again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to accept connections for. </td></tr>
    <tr><td class="paramname">serverFd</td><td>File descriptor of the server socket. </td></tr>
    <tr><td class="paramname">serverSock</td><td><a class="el" href="class_server.html" title="Main class of the HTTP server.">Server</a> socket which reported an event. </td></tr>
    <tr><td class="paramname">eventMask</td><td>Event mask of the reported event. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00640">640</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;{</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Accept connections on: &quot;</span> &lt;&lt; serverSock;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160; </div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">if</span> ((eventMask &amp; EPOLLIN) == 0) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Received unknown event:&quot;</span> &lt;&lt; eventMask;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> isWildcardServer = (serverSock.host == <span class="stringliteral">&quot;0.0.0.0&quot;</span>);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keyword">struct </span>sockaddr_storage clientAddr = {};</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        socklen_t clientLen = <span class="keyword">sizeof</span>(clientAddr);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="comment">// NOLINTNEXTLINE: we need to use reinterpret_cast to convert sockaddr_storage to sockaddr</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keyword">struct </span>sockaddr* addrCast = <span class="keyword">reinterpret_cast&lt;</span>struct sockaddr*<span class="keyword">&gt;</span>(&amp;clientAddr);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> clientFd = server.<a class="code" href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865">acceptSingleConnection</a>(serverFd, addrCast, &amp;clientLen);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="keywordflow">if</span> (clientFd == -2)</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            <span class="keywordflow">return</span>; <span class="comment">// No more pending connections</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="keywordflow">if</span> (clientFd == -1)</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="keywordflow">continue</span>; <span class="comment">// Error accepting connection</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="keyword">const</span> <a class="code" href="struct_socket.html">Socket</a> clientSock = server.<a class="code" href="class_server.html#ae4900f55d072ebbe26a92c14b17de396">retrieveSocketInfo</a>(addrCast);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">if</span> (clientSock.<a class="code" href="struct_socket.html#a986f7cf6e2d3334e9ad91a35681c1f80">host</a>.empty() &amp;&amp; clientSock.<a class="code" href="struct_socket.html#af75711bf9c0f0788d7767f836a97c5e6">port</a>.empty()) {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            close(clientFd);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="keyword">const</span> <a class="code" href="struct_socket.html">Socket</a> boundSock = isWildcardServer ? server.<a class="code" href="class_server.html#a65c2f3dc363bdb70a98895686826e5e8">retrieveBoundSocketInfo</a>(clientFd) : serverSock;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">if</span> (boundSock.<a class="code" href="struct_socket.html#a986f7cf6e2d3334e9ad91a35681c1f80">host</a>.empty() &amp;&amp; boundSock.<a class="code" href="struct_socket.html#af75711bf9c0f0788d7767f836a97c5e6">port</a>.empty()) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            close(clientFd);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">if</span> (!server.<a class="code" href="class_server.html#ac145e9f668db85b10a66829bd2677746">registerConnection</a>(boundSock, clientFd, clientSock))</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;}</div>
<div class="ttc" id="aclass_server_html_a65c2f3dc363bdb70a98895686826e5e8"><div class="ttname"><a href="class_server.html#a65c2f3dc363bdb70a98895686826e5e8">Server::retrieveBoundSocketInfo</a></div><div class="ttdeci">Socket retrieveBoundSocketInfo(int sockfd) const</div><div class="ttdoc">Wrapper function to SocketPolicy::retrieveBoundSocketInfo.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00281">Server.cpp:281</a></div></div>
<div class="ttc" id="aclass_server_html_ac145e9f668db85b10a66829bd2677746"><div class="ttname"><a href="class_server.html#ac145e9f668db85b10a66829bd2677746">Server::registerConnection</a></div><div class="ttdeci">bool registerConnection(const Socket &amp;serverSock, int clientFd, const Socket &amp;clientSock)</div><div class="ttdoc">Register a connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00158">Server.cpp:158</a></div></div>
<div class="ttc" id="aclass_server_html_ad8823ad2d9c9a94cfafb40e8e0653865"><div class="ttname"><a href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865">Server::acceptSingleConnection</a></div><div class="ttdeci">int acceptSingleConnection(int sockfd, struct sockaddr *addr, socklen_t *addrlen) const</div><div class="ttdoc">Wrapper function to SocketPolicy::acceptSingleConnection().</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00291">Server.cpp:291</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_adb579f3d67061d752e882e6fb3ef6f18_cgraph.svg" width="100%" height="466"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_adb579f3d67061d752e882e6fb3ef6f18_icgraph.svg" width="100%" height="385"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ac74673700d26f829e84f0b5011c35c94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac74673700d26f829e84f0b5011c35c94">&#9670;&nbsp;</a></span>handleConnection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleConnection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle a client connection. </p>
<p>After epoll reports an event on a client socket, this function is called to handle the connection. The event from the client can either be incoming (EPOLLIN) or outgoing (EPOLLOUT). This function dispatches to the correct subfunction depending on the connection state:</p><ol type="1">
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a69ce01d1521944754fb16d9d2e59186c">Connection::Idle</a> (in): every new connection starts in this state after it connects. Also if the connection is kept alive, it is in this state. When the client wants to send a request it changes the state to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a>.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a> (in): when the connection wants to send a request. <a class="el" href="_server_8cpp.html#a06d0cb066f08d5567ea6ba4ef2897927" title="Receive request header from a client.">connectionReceiveHeader()</a> reads the request header from the client and parses it. If the request header is complete, it changes the state to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a> or <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a> (in): if the request header indicates a body, <a class="el" href="_server_8cpp.html#a3f930db051b00ade521e2633cee948bd" title="Receives the body of a connection.">connectionReceiveBody()</a> reads the body from the client. If the body is complete, it changes the state to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a> (out): after a complete request (header and optional body) is received <a class="el" href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56" title="Builds the response for a client connection.">connectionBuildResponse()</a> builds the response for the client. It then changes the state to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a> and also calls <a class="el" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f" title="Sends the response to a client connection.">connectionSendResponse()</a> to try to immediatly send the response to the client.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a> (out): <a class="el" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f" title="Sends the response to a client connection.">connectionSendResponse()</a> sends the response to the client. This dispatch happens only if the response is not completely sent the first time.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a> (out): if the connection has timed out, <a class="el" href="_server_8cpp.html#abb21ebec72f9526fbba446f7d566117e" title="Handles a timeout for a client connection.">connectionHandleTimeout()</a> sets the request status to timeout. Then it calls <a class="el" href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56" title="Builds the response for a client connection.">connectionBuildResponse()</a> to build the error message, which then gets sent with <a class="el" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f" title="Sends the response to a client connection.">connectionSendResponse()</a>.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a> (not reached): the connection is closed and can be cleaned. This case should not be reached.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to handle the connection for. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to handle. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00709">709</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;{</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Handling connection: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a> &lt;&lt; <span class="stringliteral">&quot; for server: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#ae9c64be721ccc3676197f3ebbb58fe18">m_serverSocket</a>;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">switch</span> (connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a>) {</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a69ce01d1521944754fb16d9d2e59186c">Connection::Idle</a>):</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a>;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <a class="code" href="_server_8cpp.html#a06d0cb066f08d5567ea6ba4ef2897927">connectionReceiveHeader</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a>):</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <a class="code" href="_server_8cpp.html#a06d0cb066f08d5567ea6ba4ef2897927">connectionReceiveHeader</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a>):</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <a class="code" href="_server_8cpp.html#a3f930db051b00ade521e2633cee948bd">connectionReceiveBody</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>):</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <a class="code" href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56">connectionBuildResponse</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a>):</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <a class="code" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f">connectionSendResponse</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a>):</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <a class="code" href="_server_8cpp.html#abb21ebec72f9526fbba446f7d566117e">connectionHandleTimeout</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>):</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    }</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a06d0cb066f08d5567ea6ba4ef2897927"><div class="ttname"><a href="_server_8cpp.html#a06d0cb066f08d5567ea6ba4ef2897927">connectionReceiveHeader</a></div><div class="ttdeci">void connectionReceiveHeader(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Receive request header from a client.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00759">Server.cpp:759</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a3f930db051b00ade521e2633cee948bd"><div class="ttname"><a href="_server_8cpp.html#a3f930db051b00ade521e2633cee948bd">connectionReceiveBody</a></div><div class="ttdeci">void connectionReceiveBody(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Receives the body of a connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00882">Server.cpp:882</a></div></div>
<div class="ttc" id="a_server_8cpp_html_abb21ebec72f9526fbba446f7d566117e"><div class="ttname"><a href="_server_8cpp.html#abb21ebec72f9526fbba446f7d566117e">connectionHandleTimeout</a></div><div class="ttdeci">void connectionHandleTimeout(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Handles a timeout for a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01041">Server.cpp:1041</a></div></div>
<div class="ttc" id="a_server_8cpp_html_ac98878a19797a7f939c3a5ea1e028e56"><div class="ttname"><a href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56">connectionBuildResponse</a></div><div class="ttdeci">void connectionBuildResponse(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Builds the response for a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00973">Server.cpp:973</a></div></div>
<div class="ttc" id="a_server_8cpp_html_adcf8118ac987f6afae3aec0c54cc5f9f"><div class="ttname"><a href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f">connectionSendResponse</a></div><div class="ttdeci">void connectionSendResponse(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Sends the response to a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01000">Server.cpp:1000</a></div></div>
<div class="ttc" id="astruct_connection_html_a244c1b9870181fb1c847758d21e2c8b3"><div class="ttname"><a href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">Connection::m_clientSocket</a></div><div class="ttdeci">Socket m_clientSocket</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00031">Connection.hpp:31</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a></div><div class="ttdeci">@ ReceiveBody</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00023">Connection.hpp:23</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a></div><div class="ttdeci">@ Closed</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00028">Connection.hpp:27</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a></div><div class="ttdeci">@ BuildResponse</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00024">Connection.hpp:24</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a></div><div class="ttdeci">@ ReceiveHeader</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00022">Connection.hpp:22</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a69ce01d1521944754fb16d9d2e59186c"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a69ce01d1521944754fb16d9d2e59186c">Connection::Idle</a></div><div class="ttdeci">@ Idle</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00021">Connection.hpp:21</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a></div><div class="ttdeci">@ Timeout</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00026">Connection.hpp:26</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a></div><div class="ttdeci">@ SendResponse</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00025">Connection.hpp:25</a></div></div>
<div class="ttc" id="astruct_connection_html_ae9c64be721ccc3676197f3ebbb58fe18"><div class="ttname"><a href="struct_connection.html#ae9c64be721ccc3676197f3ebbb58fe18">Connection::m_serverSocket</a></div><div class="ttdeci">Socket m_serverSocket</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00030">Connection.hpp:30</a></div></div>
<div class="ttc" id="astruct_connection_html_af433353beabb6990235b13b24c8b6bbe"><div class="ttname"><a href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">Connection::m_status</a></div><div class="ttdeci">ConnectionStatus m_status</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00033">Connection.hpp:33</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_ac74673700d26f829e84f0b5011c35c94_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_ac74673700d26f829e84f0b5011c35c94_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a06d0cb066f08d5567ea6ba4ef2897927"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06d0cb066f08d5567ea6ba4ef2897927">&#9670;&nbsp;</a></span>connectionReceiveHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionReceiveHeader </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive request header from a client. </p>
<p>This function reads data from the client socket using <a class="el" href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423" title="Wrapper function to SocketPolicy::readFromSocket.">Server::readFromSocket()</a>. The amount of bytes to read from the socket is determined by the bytes already received from the client. It can never be bigger than the buffer size.</p><ul>
<li>If bytes read is -1, it indicates an internal server error</li>
<li>If bytes read is 0, it indicates that the connection has been closed by the client In both cases the clientFd is closed and the connection status is set to Closed. If bytes read is greater than 0, the bytes received are added to the connection buffer and the bytes received of the connection are updated as well as time since the last event is updated to the current time. If the buffer contains a complete request header, the function <a class="el" href="_server_8cpp.html#a83350eae81b96dd7b301d1238268ffdb" title="Handles a received complete request header.">handleCompleteRequestHeader()</a> is called. If no complete request was received and the received bytes match the buffer size, sets HTTP status code to 413 Request Header Fields Too Large and status to BuildResponse, since the request header was too big.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to receive the request for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd><p class="startdd">Implement body handling. </p>
<p class="enddd">make clientHeaderBufferSize configurable. </p>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00759">759</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;{</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Receive Request Header for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    std::vector&lt;char&gt;&amp; buffer = server.<a class="code" href="class_server.html#a45f1691489d81cdd6acc640d96d5046b">getClientHeaderBuffer</a>();</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">if</span> (buffer.capacity() &lt; <a class="code" href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a>)</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        buffer.resize(<a class="code" href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a>);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    buffer.clear();</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> bytesToRead = <a class="code" href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a> - connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size();</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Bytes to read: &quot;</span> &lt;&lt; bytesToRead;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keyword">const</span> ssize_t bytesRead = server.<a class="code" href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423">readFromSocket</a>(clientFd, &amp;buffer[0], bytesToRead, 0);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Bytes read: &quot;</span> &lt;&lt; bytesRead;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">if</span> (bytesRead == -1) {</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Internal server error while reading from socket: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bytesRead == 0) {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Connection closed by client: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.append(buffer.begin(), buffer.begin() + bytesRead);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        connection.<a class="code" href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">m_timeSinceLastEvent</a> = std::time(0);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a172c400277e73261d212c33f66226090">isCompleteRequestHeader</a>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>)) {</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            <a class="code" href="_server_8cpp.html#a83350eae81b96dd7b301d1238268ffdb">handleCompleteRequestHeader</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received partial request header: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size() == <a class="code" href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a>) {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Buffer full, didn&#39;t receive complete request header from &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa934528334c51781e546b5808ef678212">StatusRequestHeaderFieldsTooLarge</a>;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        }</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a172c400277e73261d212c33f66226090"><div class="ttname"><a href="_server_8cpp.html#a172c400277e73261d212c33f66226090">isCompleteRequestHeader</a></div><div class="ttdeci">bool isCompleteRequestHeader(const std::string &amp;connectionBuffer)</div><div class="ttdoc">Checks if the connection buffer contains a request header.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00806">Server.cpp:806</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a83350eae81b96dd7b301d1238268ffdb"><div class="ttname"><a href="_server_8cpp.html#a83350eae81b96dd7b301d1238268ffdb">handleCompleteRequestHeader</a></div><div class="ttdeci">void handleCompleteRequestHeader(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Handles a received complete request header.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00829">Server.cpp:829</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa934528334c51781e546b5808ef678212"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa934528334c51781e546b5808ef678212">StatusRequestHeaderFieldsTooLarge</a></div><div class="ttdeci">@ StatusRequestHeaderFieldsTooLarge</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00015">StatusCode.hpp:15</a></div></div>
<div class="ttc" id="aclass_server_html_a043a3f346d803051483a0321fc5c98db"><div class="ttname"><a href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a></div><div class="ttdeci">static const std::size_t s_clientHeaderBufferSize</div><div class="ttdef"><b>Definition:</b> <a href="_server_8hpp_source.html#l00053">Server.hpp:53</a></div></div>
<div class="ttc" id="aclass_server_html_a45f1691489d81cdd6acc640d96d5046b"><div class="ttname"><a href="class_server.html#a45f1691489d81cdd6acc640d96d5046b">Server::getClientHeaderBuffer</a></div><div class="ttdeci">std::vector&lt; char &gt; &amp; getClientHeaderBuffer()</div><div class="ttdoc">Getter for client header buffer.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00107">Server.cpp:107</a></div></div>
<div class="ttc" id="aclass_server_html_ae94e3d4b5743580a6fbe3228d58af423"><div class="ttname"><a href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423">Server::readFromSocket</a></div><div class="ttdeci">ssize_t readFromSocket(int sockfd, char *buffer, size_t size, int flags) const</div><div class="ttdoc">Wrapper function to SocketPolicy::readFromSocket.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00308">Server.cpp:308</a></div></div>
<div class="ttc" id="aclass_server_html_afab1a4ec9e524b0dae8f60080642e7fe"><div class="ttname"><a href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">Server::modifyEvent</a></div><div class="ttdeci">bool modifyEvent(int modfd, uint32_t eventMask) const</div><div class="ttdoc">Wrapper function to EpollWrapper::modifyEvent.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00225">Server.cpp:225</a></div></div>
<div class="ttc" id="astruct_connection_html_a4157497e77aed0e8b399a47eba498683"><div class="ttname"><a href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">Connection::m_buffer</a></div><div class="ttdeci">std::string m_buffer</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00034">Connection.hpp:34</a></div></div>
<div class="ttc" id="astruct_connection_html_a8038f77baa0072e5aa044efa5ab47625"><div class="ttname"><a href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">Connection::m_timeSinceLastEvent</a></div><div class="ttdeci">time_t m_timeSinceLastEvent</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00032">Connection.hpp:32</a></div></div>
<div class="ttc" id="astruct_connection_html_ae94a8a88f07c64cf17ada17c7e670ada"><div class="ttname"><a href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">Connection::m_request</a></div><div class="ttdeci">HTTPRequest m_request</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00035">Connection.hpp:35</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_a4ab3aefab7679eeb2b4e97f7043bdff3"><div class="ttname"><a href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">HTTPRequest::httpStatus</a></div><div class="ttdeci">statusCode httpStatus</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00027">HTTPRequest.hpp:27</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a06d0cb066f08d5567ea6ba4ef2897927_cgraph.svg" width="100%" height="537"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a06d0cb066f08d5567ea6ba4ef2897927_icgraph.svg" width="100%" height="385"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a172c400277e73261d212c33f66226090"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a172c400277e73261d212c33f66226090">&#9670;&nbsp;</a></span>isCompleteRequestHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isCompleteRequestHeader </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>connectionBuffer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the connection buffer contains a request header. </p>
<p>A request header is defined as a string that ends with "\r\n\r\n". </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">connectionBuffer</td><td>The buffer to check for a complete request. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the buffer contains a complete request, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00806">806</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;{</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">return</span> (connectionBuffer.find(<span class="stringliteral">&quot;\r\n\r\n&quot;</span>) != std::string::npos);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a172c400277e73261d212c33f66226090_icgraph.svg" width="100%" height="385"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a83350eae81b96dd7b301d1238268ffdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83350eae81b96dd7b301d1238268ffdb">&#9670;&nbsp;</a></span>handleCompleteRequestHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleCompleteRequestHeader </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles a received complete request header. </p>
<p>This function is called when a complete request header has been received from the client. It parses the request header with <a class="el" href="class_server.html#a34bc61299318fe1918293b1d656ee5f9" title="Wrapper function to RequestParser::parseHeader.">Server::parseHeader()</a>. An error while parsing the header sets <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a> and modifies the event to listen to EPOLLOUT. After parsing the header, tries to find the "Host" header field in the request headers. If it exists, it rechecks the server configuration for the connection. Then it tries to find the target resource for the request with <a class="el" href="class_server.html#a79e42d429f816514a89b11c729875797" title="Wrapper function to TargetResourceHandler::execute.">Server::findTargetResource()</a> which also sets the active location for the connection. Checks with found location if method is allowed. If not sets StatusMethodNotAllowed. If Status is still OK, and the request has a body, set to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a> and the received request header is deleted from the buffer. Else sets to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a> and the event is modified to listen to EPOLLOUT. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client socket. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00829">829</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;{</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received complete request header: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160; </div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        server.<a class="code" href="class_server.html#a34bc61299318fe1918293b1d656ee5f9">parseHeader</a>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>, connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>);</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    } <span class="keywordflow">catch</span> (std::exception&amp; e) {</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; e.what();</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    std::map&lt;std::string, std::string&gt;::iterator iter = connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a7f295acd62075df13848bd3103c89bbf">headers</a>.find(<span class="stringliteral">&quot;host&quot;</span>);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordflow">if</span> (iter != connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a7f295acd62075df13848bd3103c89bbf">headers</a>.end()) {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="_connection_8hpp.html#a354192f8dd87ca049cf8b7e6de9000da">hasValidServerConfig</a>(connection, server.<a class="code" href="class_server.html#a54745950beb9e321d9a56084501c18e9">getServerConfigs</a>(), iter-&gt;second)) {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Failed to set active server for &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            close(clientFd);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        }</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    server.<a class="code" href="class_server.html#a79e42d429f816514a89b11c729875797">findTargetResource</a>(connection, connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="comment">// bool array and method are scoped with enum Method</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="comment">// NOLINTNEXTLINE(cppcoreguidelines-pro-bounds-constant-array-index)</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordflow">if</span> (!connection.<a class="code" href="struct_connection.html#afff86c74740618d83bab5af4f34d10af">location</a>-&gt;allowedMethods[connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a67c428c2e03ff5e9e3fc4403ba9377a9">method</a>])</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa3a2f8b3e6cff3c3161d55afc45abe018">StatusMethodNotAllowed</a>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> == <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaac2100e382b4b426b38bf06e5f738a080">StatusOK</a> &amp;&amp; connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#ab3f30f449eb8a8b6df63cd67986961ff">hasBody</a>) {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a>;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.erase(0, connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.find(<span class="stringliteral">&quot;\r\n\r\n&quot;</span>) + 4);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    }</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;}</div>
<div class="ttc" id="a_connection_8hpp_html_a354192f8dd87ca049cf8b7e6de9000da"><div class="ttname"><a href="_connection_8hpp.html#a354192f8dd87ca049cf8b7e6de9000da">hasValidServerConfig</a></div><div class="ttdeci">bool hasValidServerConfig(Connection &amp;connection, const std::vector&lt; ConfigServer &gt; &amp;serverConfigs)</div><div class="ttdoc">Selects the server configuration for a connection.</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8cpp_source.html#l00080">Connection.cpp:80</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa3a2f8b3e6cff3c3161d55afc45abe018"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa3a2f8b3e6cff3c3161d55afc45abe018">StatusMethodNotAllowed</a></div><div class="ttdeci">@ StatusMethodNotAllowed</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00012">StatusCode.hpp:12</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaac2100e382b4b426b38bf06e5f738a080"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaac2100e382b4b426b38bf06e5f738a080">StatusOK</a></div><div class="ttdeci">@ StatusOK</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00006">StatusCode.hpp:6</a></div></div>
<div class="ttc" id="aclass_server_html_a34bc61299318fe1918293b1d656ee5f9"><div class="ttname"><a href="class_server.html#a34bc61299318fe1918293b1d656ee5f9">Server::parseHeader</a></div><div class="ttdeci">void parseHeader(const std::string &amp;requestString, HTTPRequest &amp;request)</div><div class="ttdoc">Wrapper function to RequestParser::parseHeader.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00339">Server.cpp:339</a></div></div>
<div class="ttc" id="aclass_server_html_a54745950beb9e321d9a56084501c18e9"><div class="ttname"><a href="class_server.html#a54745950beb9e321d9a56084501c18e9">Server::getServerConfigs</a></div><div class="ttdeci">const std::vector&lt; ConfigServer &gt; &amp; getServerConfigs() const</div><div class="ttdoc">Const Getter for server configs.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00093">Server.cpp:93</a></div></div>
<div class="ttc" id="aclass_server_html_a79e42d429f816514a89b11c729875797"><div class="ttname"><a href="class_server.html#a79e42d429f816514a89b11c729875797">Server::findTargetResource</a></div><div class="ttdeci">void findTargetResource(Connection &amp;connection, HTTPRequest &amp;request)</div><div class="ttdoc">Wrapper function to TargetResourceHandler::execute.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00387">Server.cpp:387</a></div></div>
<div class="ttc" id="astruct_connection_html_afff86c74740618d83bab5af4f34d10af"><div class="ttname"><a href="struct_connection.html#afff86c74740618d83bab5af4f34d10af">Connection::location</a></div><div class="ttdeci">std::vector&lt; Location &gt;::const_iterator location</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00037">Connection.hpp:37</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_a67c428c2e03ff5e9e3fc4403ba9377a9"><div class="ttname"><a href="struct_h_t_t_p_request.html#a67c428c2e03ff5e9e3fc4403ba9377a9">HTTPRequest::method</a></div><div class="ttdeci">Method method</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00022">HTTPRequest.hpp:22</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_a7f295acd62075df13848bd3103c89bbf"><div class="ttname"><a href="struct_h_t_t_p_request.html#a7f295acd62075df13848bd3103c89bbf">HTTPRequest::headers</a></div><div class="ttdeci">std::map&lt; std::string, std::string &gt; headers</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00025">HTTPRequest.hpp:25</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_ab3f30f449eb8a8b6df63cd67986961ff"><div class="ttname"><a href="struct_h_t_t_p_request.html#ab3f30f449eb8a8b6df63cd67986961ff">HTTPRequest::hasBody</a></div><div class="ttdeci">bool hasBody</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00029">HTTPRequest.hpp:29</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a83350eae81b96dd7b301d1238268ffdb_cgraph.svg" width="100%" height="505"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a83350eae81b96dd7b301d1238268ffdb_icgraph.svg" width="100%" height="404"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a3f930db051b00ade521e2633cee948bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f930db051b00ade521e2633cee948bd">&#9670;&nbsp;</a></span>connectionReceiveBody()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionReceiveBody </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receives the body of a connection. </p>
<p>This function is responsible for receiving the body of a connection from the client. It reads data from the socket and appends it to the connection's buffer. If the buffer size exceeds the maximum allowed client request body size, an error is logged and the connection's HTTP status is set to StatusRequestEntityTooLarge. If the complete request body is received, it is parsed and the connection's status is set to BuildResponse. If an exception occurs during parsing, an error is logged and the connection's status is set to BuildResponse.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client socket. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00882">882</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;{</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;ReceiveBody for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    std::vector&lt;char&gt;&amp; buffer = server.<a class="code" href="class_server.html#a2092f68016c0cfaff0c9c0e1862eb009">getClientBodyBuffer</a>();</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordflow">if</span> (buffer.capacity() &lt; <a class="code" href="class_server.html#a6209b5a55764d2e563be4825d1fcf84a">Server::s_clientBodyBufferSize</a>)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        buffer.resize(<a class="code" href="class_server.html#a6209b5a55764d2e563be4825d1fcf84a">Server::s_clientBodyBufferSize</a>);</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    buffer.clear();</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> bytesToRead = <a class="code" href="class_server.html#a6209b5a55764d2e563be4825d1fcf84a">Server::s_clientBodyBufferSize</a> - connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size();</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Bytes to read: &quot;</span> &lt;&lt; bytesToRead;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keyword">const</span> ssize_t bytesRead = server.<a class="code" href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423">readFromSocket</a>(clientFd, &amp;buffer[0], bytesToRead, 0);</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Bytes read: &quot;</span> &lt;&lt; bytesToRead;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keywordflow">if</span> (bytesRead == -1) {</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Internal server error while reading from socket: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bytesRead == 0) {</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Connection closed by client: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.append(buffer.begin(), buffer.begin() + bytesRead);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        connection.<a class="code" href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">m_timeSinceLastEvent</a> = std::time(0);</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a14a0c5a1227276017a19d9b52141c13a">isCompleteBody</a>(connection)) {</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received complete request body: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                server.<a class="code" href="class_server.html#ace46f4e07ab67db60e3790a32b2e8e0a">parseBody</a>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>, connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>);</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            } <span class="keywordflow">catch</span> (std::exception&amp; e) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; e.what();</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received partial request body: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> == <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424">StatusBadRequest</a>) {</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <a class="code" href="error_8hpp.html#a683508ef2f2400bcd0f5f5e02dfd85c5">ERR_CONTENT_LENGTH</a>;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size() == <a class="code" href="class_server.html#a794aa3ae836d313505706b951a7a02f0">Server::s_clientMaxBodySize</a>) {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Maximum allowed client request body size reached from &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa80247b37438ce9e27971aff9469049c6">StatusRequestEntityTooLarge</a>;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            }</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a14a0c5a1227276017a19d9b52141c13a"><div class="ttname"><a href="_server_8cpp.html#a14a0c5a1227276017a19d9b52141c13a">isCompleteBody</a></div><div class="ttdeci">bool isCompleteBody(Connection &amp;connection)</div><div class="ttdoc">Checks if the HTTP request body has been completely received.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00946">Server.cpp:946</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa80247b37438ce9e27971aff9469049c6"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa80247b37438ce9e27971aff9469049c6">StatusRequestEntityTooLarge</a></div><div class="ttdeci">@ StatusRequestEntityTooLarge</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00014">StatusCode.hpp:14</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424">StatusBadRequest</a></div><div class="ttdeci">@ StatusBadRequest</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00009">StatusCode.hpp:9</a></div></div>
<div class="ttc" id="aclass_server_html_a2092f68016c0cfaff0c9c0e1862eb009"><div class="ttname"><a href="class_server.html#a2092f68016c0cfaff0c9c0e1862eb009">Server::getClientBodyBuffer</a></div><div class="ttdeci">std::vector&lt; char &gt; &amp; getClientBodyBuffer()</div><div class="ttdoc">Getter for client body buffer.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00114">Server.cpp:114</a></div></div>
<div class="ttc" id="aclass_server_html_a6209b5a55764d2e563be4825d1fcf84a"><div class="ttname"><a href="class_server.html#a6209b5a55764d2e563be4825d1fcf84a">Server::s_clientBodyBufferSize</a></div><div class="ttdeci">static const std::size_t s_clientBodyBufferSize</div><div class="ttdef"><b>Definition:</b> <a href="_server_8hpp_source.html#l00054">Server.hpp:54</a></div></div>
<div class="ttc" id="aclass_server_html_a794aa3ae836d313505706b951a7a02f0"><div class="ttname"><a href="class_server.html#a794aa3ae836d313505706b951a7a02f0">Server::s_clientMaxBodySize</a></div><div class="ttdeci">static const std::size_t s_clientMaxBodySize</div><div class="ttdef"><b>Definition:</b> <a href="_server_8hpp_source.html#l00055">Server.hpp:55</a></div></div>
<div class="ttc" id="aclass_server_html_ace46f4e07ab67db60e3790a32b2e8e0a"><div class="ttname"><a href="class_server.html#ace46f4e07ab67db60e3790a32b2e8e0a">Server::parseBody</a></div><div class="ttdeci">void parseBody(const std::string &amp;bodyString, HTTPRequest &amp;request)</div><div class="ttdoc">Wrapper function to RequestParser::parseBody.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00350">Server.cpp:350</a></div></div>
<div class="ttc" id="aerror_8hpp_html_a683508ef2f2400bcd0f5f5e02dfd85c5"><div class="ttname"><a href="error_8hpp.html#a683508ef2f2400bcd0f5f5e02dfd85c5">ERR_CONTENT_LENGTH</a></div><div class="ttdeci">#define ERR_CONTENT_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="error_8hpp_source.html#l00039">error.hpp:39</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a3f930db051b00ade521e2633cee948bd_cgraph.svg" width="100%" height="480"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a3f930db051b00ade521e2633cee948bd_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a14a0c5a1227276017a19d9b52141c13a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14a0c5a1227276017a19d9b52141c13a">&#9670;&nbsp;</a></span>isCompleteBody()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isCompleteBody </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the HTTP request body has been completely received. </p>
<p>This function determines whether the HTTP request body in the given connection has been completely received. If the request is not chunked, it checks whether the content length matches the buffer size. In case the buffer size is larger than the content length, the request status is set to StatusBadRequest. If the request is chunked, it checks for the presence of the chunked transfer termination sequence ("0\r\n\r\n").</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">connection</td><td>A reference to the <a class="el" href="struct_connection.html" title="Represents a connection between a server and a client.">Connection</a> object representing the current HTTP connection. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the request body has been completely received, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00946">946</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;{</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">if</span> (!connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#ac894099e690bcad5b4c6423c00b75017">isChunked</a>) {</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> contentLength</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            = std::strtoul(connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a7f295acd62075df13848bd3103c89bbf">headers</a>.at(<span class="stringliteral">&quot;content-length&quot;</span>).c_str(), NULL, <a class="code" href="namespaceconstants.html#afe756195738c244eeace3037c5486edc">constants::g_decimalBase</a>);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="keywordflow">if</span> (contentLength &lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size()) {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424">StatusBadRequest</a>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        }</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordflow">if</span> (contentLength == connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size())</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    }</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keywordflow">return</span> connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.find(<span class="stringliteral">&quot;0\r\n\r\n&quot;</span>) != std::string::npos;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;}</div>
<div class="ttc" id="anamespaceconstants_html_afe756195738c244eeace3037c5486edc"><div class="ttname"><a href="namespaceconstants.html#afe756195738c244eeace3037c5486edc">constants::g_decimalBase</a></div><div class="ttdeci">const int g_decimalBase</div><div class="ttdef"><b>Definition:</b> <a href="constants_8cpp_source.html#l00005">constants.cpp:5</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_ac894099e690bcad5b4c6423c00b75017"><div class="ttname"><a href="struct_h_t_t_p_request.html#ac894099e690bcad5b4c6423c00b75017">HTTPRequest::isChunked</a></div><div class="ttdeci">bool isChunked</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00030">HTTPRequest.hpp:30</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a14a0c5a1227276017a19d9b52141c13a_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ac98878a19797a7f939c3a5ea1e028e56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac98878a19797a7f939c3a5ea1e028e56">&#9670;&nbsp;</a></span>connectionBuildResponse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionBuildResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Builds the response for a client connection. </p>
<p>Builds the response for a client connection by calling <a class="el" href="class_server.html#aaa1a16c8d18a7d0a4191adfeb65fdf82" title="Wrapper function to ResponseBuilder::buildResponse.">Server::buildResponse()</a>. The response is stored in the connection buffer. The connection status is set to SendResponse and the response is sent to the client by calling <a class="el" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f" title="Sends the response to a client connection.">connectionSendResponse()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to build the response for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00973">973</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;{</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;BuildResponse for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    server.<a class="code" href="class_server.html#aaa1a16c8d18a7d0a4191adfeb65fdf82">buildResponse</a>(connection);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.clear();</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a> = server.<a class="code" href="class_server.html#a718bf76e7c3f830abb2f7b0972cdaa63">getResponse</a>();</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a>;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <a class="code" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f">connectionSendResponse</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;}</div>
<div class="ttc" id="aclass_server_html_a718bf76e7c3f830abb2f7b0972cdaa63"><div class="ttname"><a href="class_server.html#a718bf76e7c3f830abb2f7b0972cdaa63">Server::getResponse</a></div><div class="ttdeci">std::string getResponse()</div><div class="ttdoc">Wrapper function to ResponseBuilder::getResponse.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00377">Server.cpp:377</a></div></div>
<div class="ttc" id="aclass_server_html_aaa1a16c8d18a7d0a4191adfeb65fdf82"><div class="ttname"><a href="class_server.html#aaa1a16c8d18a7d0a4191adfeb65fdf82">Server::buildResponse</a></div><div class="ttdeci">void buildResponse(Connection &amp;connection)</div><div class="ttdoc">Wrapper function to ResponseBuilder::buildResponse.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00367">Server.cpp:367</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_ac98878a19797a7f939c3a5ea1e028e56_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_ac98878a19797a7f939c3a5ea1e028e56_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="adcf8118ac987f6afae3aec0c54cc5f9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcf8118ac987f6afae3aec0c54cc5f9f">&#9670;&nbsp;</a></span>connectionSendResponse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionSendResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends the response to a client connection. </p>
<p>Sends the response to a client connection by calling <a class="el" href="class_server.html#a8bf2a41e8ddcccd54b5832b58211a283" title="Wrapper function to SocketPolicy::writeToSocket.">Server::writeToSocket()</a>. The amount of bytes to send is determined by the size of the connection buffer. If sent bytes == -1 it indicates an internal server error and the connection is closed. If the response is not completely sent, the bytes sent are removed from the buffer and timeSinceLastEvent is updated. If the response is completely sent and the connection is set to close, the client socket is closed and the connection status is set to Closed. If the response is completely sent and the connection is not set to close, the event is modified to listen to EPOLLIN and the connection is cleared. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to send the response for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01000">1000</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;{</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;SendResponse for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160; </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keyword">const</span> ssize_t bytesToSend = <span class="keyword">static_cast&lt;</span>ssize_t<span class="keyword">&gt;</span>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size());</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keyword">const</span> ssize_t sentBytes = server.<a class="code" href="class_server.html#a8bf2a41e8ddcccd54b5832b58211a283">writeToSocket</a>(clientFd, connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.c_str(), bytesToSend, 0);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">if</span> (sentBytes == -1) {</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Internal server error&quot;</span>;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    }</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="keywordflow">if</span> (sentBytes &lt; bytesToSend) {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Sent &quot;</span> &lt;&lt; sentBytes &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span>;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.erase(0, sentBytes);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        connection.<a class="code" href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">m_timeSinceLastEvent</a> = std::time(0);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    }</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#afc0f4c6d53b455a67ea264dbfc3be0e4">shallCloseConnection</a>) {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Closing connection&quot;</span>;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Connection alive&quot;</span>;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLIN);</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <a class="code" href="_connection_8hpp.html#a1787b72853fa3a6146cea621fa1d0d65">clearConnection</a>(connection, server.<a class="code" href="class_server.html#a54745950beb9e321d9a56084501c18e9">getServerConfigs</a>());</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;}</div>
<div class="ttc" id="a_connection_8hpp_html_a1787b72853fa3a6146cea621fa1d0d65"><div class="ttname"><a href="_connection_8hpp.html#a1787b72853fa3a6146cea621fa1d0d65">clearConnection</a></div><div class="ttdeci">bool clearConnection(Connection &amp;connection, const std::vector&lt; ConfigServer &gt; &amp;serverConfigs)</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8cpp_source.html#l00025">Connection.cpp:25</a></div></div>
<div class="ttc" id="aclass_server_html_a8bf2a41e8ddcccd54b5832b58211a283"><div class="ttname"><a href="class_server.html#a8bf2a41e8ddcccd54b5832b58211a283">Server::writeToSocket</a></div><div class="ttdeci">ssize_t writeToSocket(int sockfd, const char *buffer, size_t size, int flags) const</div><div class="ttdoc">Wrapper function to SocketPolicy::writeToSocket.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00324">Server.cpp:324</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_afc0f4c6d53b455a67ea264dbfc3be0e4"><div class="ttname"><a href="struct_h_t_t_p_request.html#afc0f4c6d53b455a67ea264dbfc3be0e4">HTTPRequest::shallCloseConnection</a></div><div class="ttdeci">bool shallCloseConnection</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00028">HTTPRequest.hpp:28</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_adcf8118ac987f6afae3aec0c54cc5f9f_cgraph.svg" width="100%" height="442"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_adcf8118ac987f6afae3aec0c54cc5f9f_icgraph.svg" width="100%" height="442"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="abb21ebec72f9526fbba446f7d566117e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb21ebec72f9526fbba446f7d566117e">&#9670;&nbsp;</a></span>connectionHandleTimeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionHandleTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles a timeout for a client connection. </p>
<p>Handles a timeout for a client connection by setting the request status to StatusRequestTimeout. Then it builds the error message by calling <a class="el" href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56" title="Builds the response for a client connection.">connectionBuildResponse()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to handle the timeout for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01041">1041</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;{</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Timeout for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#afc0f4c6d53b455a67ea264dbfc3be0e4">shallCloseConnection</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaacffa58a18c688740c290369c8bf13a3f">StatusRequestTimeout</a>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <a class="code" href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56">connectionBuildResponse</a>(server, clientFd, connection);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;}</div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaacffa58a18c688740c290369c8bf13a3f"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaacffa58a18c688740c290369c8bf13a3f">StatusRequestTimeout</a></div><div class="ttdeci">@ StatusRequestTimeout</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00013">StatusCode.hpp:13</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_abb21ebec72f9526fbba446f7d566117e_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_abb21ebec72f9526fbba446f7d566117e_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a28fd29ec48bd9459c678980cfccca4cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28fd29ec48bd9459c678980cfccca4cf">&#9670;&nbsp;</a></span>checkForTimeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkForTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterates through all connections and checks if any have timed out. </p>
<p>If the connection status is Closed, it is skipped. The time since last event is saved in a variable to print it to the log and check if it is greater than the timeout set for the server. If it is, the connection is modified to EPOLLOUT, and the state is set to Timeout. When the fd is ready to receive a message the timeout error will be send. </p>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01059">1059</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;{</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;int, Connection&gt;::iterator iter = server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().begin();</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;         iter != server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().end(); ++iter) {</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;second.m_status == <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>)</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <span class="keyword">const</span> time_t timeSinceLastEvent = std::time(0) - iter-&gt;second.m_timeSinceLastEvent;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; iter-&gt;second.m_clientSocket &lt;&lt; <span class="stringliteral">&quot;: Time since last event: &quot;</span> &lt;&lt; timeSinceLastEvent;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="keywordflow">if</span> (timeSinceLastEvent &gt; server.<a class="code" href="class_server.html#af8184a299847cca0789696048893bc48">getClientTimeout</a>()) {</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;            <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Connection timeout: &quot;</span> &lt;&lt; iter-&gt;second.m_clientSocket;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;            server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(iter-&gt;first, EPOLLOUT);</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            iter-&gt;second.m_status = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a>;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        }</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;}</div>
<div class="ttc" id="aclass_server_html_af8184a299847cca0789696048893bc48"><div class="ttname"><a href="class_server.html#af8184a299847cca0789696048893bc48">Server::getClientTimeout</a></div><div class="ttdeci">time_t getClientTimeout() const</div><div class="ttdoc">Const Getter for client timeout.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00100">Server.cpp:100</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a28fd29ec48bd9459c678980cfccca4cf_cgraph.svg" width="626" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a28fd29ec48bd9459c678980cfccca4cf_icgraph.svg" width="556" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a9e2693ba11e20b84de090bcdd0b665db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e2693ba11e20b84de090bcdd0b665db">&#9670;&nbsp;</a></span>cleanupClosedConnections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanupClosedConnections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterates through all connections and removes closed ones. </p>
<p>The for loop through the connections map has no increment statement because the iterator is incremented in the loop body. If .erase() is called on an iterator, it is invalidated.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to cleanup closed connections for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01086">1086</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;{</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;int, Connection&gt;::iterator iter = server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().begin();</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;         iter != server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().end();</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="comment">/* no iter*/</span>) {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;second.m_status == <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>)</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().erase(iter++);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            ++iter;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a9e2693ba11e20b84de090bcdd0b665db_cgraph.svg" width="430" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a9e2693ba11e20b84de090bcdd0b665db_icgraph.svg" width="619" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="af2feae308a0fa968c84525fcdfb19251"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2feae308a0fa968c84525fcdfb19251">&#9670;&nbsp;</a></span>cleanupIdleConnections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanupIdleConnections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterates through all connections, closes and removes idle ones. </p>
<p>The for loop through the connections map has no increment statement because the iterator is incremented in the loop body. If .erase() is called on an iterator, it is invalidated.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to cleanup idle connections for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01107">1107</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;{</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;int, Connection&gt;::iterator iter = server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().begin();</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;         iter != server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().end();</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="comment">/* no iter*/</span>) {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;second.m_status == <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a69ce01d1521944754fb16d9d2e59186c">Connection::Idle</a>) {</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            close(iter-&gt;first);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().erase(iter++);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            ++iter;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    }</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_af2feae308a0fa968c84525fcdfb19251_cgraph.svg" width="410" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_af2feae308a0fa968c84525fcdfb19251_icgraph.svg" width="599" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a115ecd76e344c1007bedc48b9bbdc0fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a115ecd76e344c1007bedc48b9bbdc0fa">&#9670;&nbsp;</a></span>shutdownServer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void shutdownServer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a graceful shutdown of the server. </p>
<p>Closes all virtual servers, cleans up idle and closed connections. Then enters another event loop with two conditions:</p><ol type="1">
<li>last signal received is SIGQUIT (which initiated graceful shutdown)</li>
<li>as long as active connections exist. This second loop always cleans up idle connections. It can also be interrupted with another signal, which aborts the graceful shutdown.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to shut down. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a href="https://pkg.go.dev/net/http#Server.Shutdown">https://pkg.go.dev/net/http#Server.Shutdown</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01133">1133</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;{</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Closing all virtual servers&quot;</span>;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;int, Socket&gt;::iterator iter = server.<a class="code" href="class_server.html#ad5228a2a917b01adff3b89007c036ec4">getVirtualServers</a>().begin();</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;         iter != server.<a class="code" href="class_server.html#ad5228a2a917b01adff3b89007c036ec4">getVirtualServers</a>().end(); ++iter) {</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        server.<a class="code" href="class_server.html#a3ea71b66d27b584d8c33eb5cb64813f1">removeEvent</a>(iter-&gt;first);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        close(iter-&gt;first);</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    }</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    server.<a class="code" href="class_server.html#ad5228a2a917b01adff3b89007c036ec4">getVirtualServers</a>().clear();</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160; </div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Cleanup idle connections&quot;</span>;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <a class="code" href="_server_8cpp.html#af2feae308a0fa968c84525fcdfb19251">cleanupIdleConnections</a>(server);</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <a class="code" href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">cleanupClosedConnections</a>(server);</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160; </div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Waiting for connections to finish&quot;</span>;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a> == SIGQUIT &amp;&amp; !server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().empty()) {</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> nfds = server.<a class="code" href="class_server.html#acbcbebe2c30446acc9a90f40f9986b62">waitForEvents</a>();</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160; </div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        <span class="keywordflow">for</span> (std::vector&lt;struct epoll_event&gt;::const_iterator iter = server.<a class="code" href="class_server.html#a1768b6e65ed7b3205141698ca459ffd8">eventsBegin</a>();</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;             iter != server.<a class="code" href="class_server.html#a1768b6e65ed7b3205141698ca459ffd8">eventsBegin</a>() + nfds; ++iter) {</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;            <a class="code" href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4">handleEvent</a>(server, *iter);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <a class="code" href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf">checkForTimeout</a>(server);</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <a class="code" href="_server_8cpp.html#af2feae308a0fa968c84525fcdfb19251">cleanupIdleConnections</a>(server);</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <a class="code" href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">cleanupClosedConnections</a>(server);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    }</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a> != SIGQUIT)</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Graceful shutdown interrupted with signal &quot;</span> &lt;&lt; <a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a>;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Server shutdown gracefully&quot;</span>;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_af2feae308a0fa968c84525fcdfb19251"><div class="ttname"><a href="_server_8cpp.html#af2feae308a0fa968c84525fcdfb19251">cleanupIdleConnections</a></div><div class="ttdeci">void cleanupIdleConnections(Server &amp;server)</div><div class="ttdoc">Iterates through all connections, closes and removes idle ones.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01107">Server.cpp:1107</a></div></div>
<div class="ttc" id="aclass_server_html_a3ea71b66d27b584d8c33eb5cb64813f1"><div class="ttname"><a href="class_server.html#a3ea71b66d27b584d8c33eb5cb64813f1">Server::removeEvent</a></div><div class="ttdeci">void removeEvent(int delfd) const</div><div class="ttdoc">Wrapper function to EpollWrapper::removeEvent.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00232">Server.cpp:232</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a115ecd76e344c1007bedc48b9bbdc0fa_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8hpp_a115ecd76e344c1007bedc48b9bbdc0fa_icgraph.svg" width="374" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_bfccd401955b95cf8c75461437045ac0.html">inc</a></li><li class="navelem"><a class="el" href="_server_8hpp.html">Server.hpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
