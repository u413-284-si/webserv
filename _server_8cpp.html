<!-- HTML header for doxygen 1.9.4-->
<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=11" />
	<meta name="generator" content="Doxygen 1.9.1" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>webserv: src/Server.cpp File Reference</title>
	<link href="tabs.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<link href="doxygen.css" rel="stylesheet" type="text/css" />
	<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
	<script type="text/javascript">
		DoxygenAwesomeDarkModeToggle.init()
	</script>
	<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
	<script type="text/javascript">
		DoxygenAwesomeFragmentCopyButton.init()
	</script>
	<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
	<script type="text/javascript">
		DoxygenAwesomeParagraphLink.init()
	</script>
</head>
<body>
		<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
			<div id="titlearea">
				<table cellspacing="0" cellpadding="0">
					<tbody>
						<tr id="projectrow">
							<td id="projectalign">
								<div id="projectname">webserv
								</div>
								<div id="projectbrief">This is when you finally understand why a URL starts with HTTP.</div>
							</td>
						</tr>
						<!--BEGIN FULL_SIDEBAR-->
						<tr>
							<td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
						</tr>
						<!--END FULL_SIDEBAR-->
					</tbody>
				</table>
			</div>
			<!-- end header part --><!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_server_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Server.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="_server_8hpp_source.html">Server.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_config_file_8hpp_source.html">ConfigFile.hpp</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for Server.cpp:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div>
<p><a href="_server_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a35359f61d42dbd6561a07c12009ca45a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a35359f61d42dbd6561a07c12009ca45a">initVirtualServers</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int backlog, const std::vector&lt; <a class="el" href="struct_config_server.html">ConfigServer</a> &gt; &amp;serverConfigs)</td></tr>
<tr class="memdesc:a35359f61d42dbd6561a07c12009ca45a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize virtual servers.  <a href="_server_8cpp.html#a35359f61d42dbd6561a07c12009ca45a">More...</a><br /></td></tr>
<tr class="separator:a35359f61d42dbd6561a07c12009ca45a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f6456b9a16154a6d320ae8b370285d6"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">isDuplicateServer</a> (const <a class="el" href="class_server.html">Server</a> &amp;server, const std::string &amp;host, const std::string &amp;port)</td></tr>
<tr class="memdesc:a4f6456b9a16154a6d320ae8b370285d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check for duplicate virtual servers.  <a href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">More...</a><br /></td></tr>
<tr class="separator:a4f6456b9a16154a6d320ae8b370285d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6ca6a0179cbb661c05aa6b2758f5389"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">createVirtualServer</a> (<a class="el" href="class_server.html">Server</a> &amp;server, const std::string &amp;host, int backlog, const std::string &amp;port)</td></tr>
<tr class="memdesc:aa6ca6a0179cbb661c05aa6b2758f5389"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a new virtual server and registers it with the server object.  <a href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">More...</a><br /></td></tr>
<tr class="separator:aa6ca6a0179cbb661c05aa6b2758f5389"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9f4479a6262c17deef89938118d27f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4">handleEvent</a> (<a class="el" href="class_server.html">Server</a> &amp;server, struct epoll_event event)</td></tr>
<tr class="memdesc:af9f4479a6262c17deef89938118d27f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accepts new connections or handles existing ones.  <a href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4">More...</a><br /></td></tr>
<tr class="separator:af9f4479a6262c17deef89938118d27f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb579f3d67061d752e882e6fb3ef6f18"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18">acceptConnections</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int serverFd, const <a class="el" href="struct_socket.html">Socket</a> &amp;serverSock, uint32_t eventMask)</td></tr>
<tr class="memdesc:adb579f3d67061d752e882e6fb3ef6f18"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accept new connections.  <a href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18">More...</a><br /></td></tr>
<tr class="separator:adb579f3d67061d752e882e6fb3ef6f18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a581dddd40d3728b6d22216003e2065b5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a581dddd40d3728b6d22216003e2065b5">handleConnection</a> (<a class="el" href="class_server.html">Server</a> &amp;server, const int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a581dddd40d3728b6d22216003e2065b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle a client connection.  <a href="_server_8cpp.html#a581dddd40d3728b6d22216003e2065b5">More...</a><br /></td></tr>
<tr class="separator:a581dddd40d3728b6d22216003e2065b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06d0cb066f08d5567ea6ba4ef2897927"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a06d0cb066f08d5567ea6ba4ef2897927">connectionReceiveHeader</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a06d0cb066f08d5567ea6ba4ef2897927"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive request header from a client.  <a href="_server_8cpp.html#a06d0cb066f08d5567ea6ba4ef2897927">More...</a><br /></td></tr>
<tr class="separator:a06d0cb066f08d5567ea6ba4ef2897927"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a172c400277e73261d212c33f66226090"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a172c400277e73261d212c33f66226090">isCompleteRequestHeader</a> (const std::string &amp;connectionBuffer)</td></tr>
<tr class="memdesc:a172c400277e73261d212c33f66226090"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the connection buffer contains a request header.  <a href="_server_8cpp.html#a172c400277e73261d212c33f66226090">More...</a><br /></td></tr>
<tr class="separator:a172c400277e73261d212c33f66226090"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f930db051b00ade521e2633cee948bd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a3f930db051b00ade521e2633cee948bd">connectionReceiveBody</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a3f930db051b00ade521e2633cee948bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receives the body of a connection.  <a href="_server_8cpp.html#a3f930db051b00ade521e2633cee948bd">More...</a><br /></td></tr>
<tr class="separator:a3f930db051b00ade521e2633cee948bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14a0c5a1227276017a19d9b52141c13a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a14a0c5a1227276017a19d9b52141c13a">isCompleteBody</a> (<a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a14a0c5a1227276017a19d9b52141c13a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the HTTP request body has been completely received.  <a href="_server_8cpp.html#a14a0c5a1227276017a19d9b52141c13a">More...</a><br /></td></tr>
<tr class="separator:a14a0c5a1227276017a19d9b52141c13a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac98878a19797a7f939c3a5ea1e028e56"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56">connectionBuildResponse</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:ac98878a19797a7f939c3a5ea1e028e56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Builds the response for a client connection.  <a href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56">More...</a><br /></td></tr>
<tr class="separator:ac98878a19797a7f939c3a5ea1e028e56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcf8118ac987f6afae3aec0c54cc5f9f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f">connectionSendResponse</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:adcf8118ac987f6afae3aec0c54cc5f9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the response to a client connection.  <a href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f">More...</a><br /></td></tr>
<tr class="separator:adcf8118ac987f6afae3aec0c54cc5f9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb21ebec72f9526fbba446f7d566117e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#abb21ebec72f9526fbba446f7d566117e">connectionHandleTimeout</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:abb21ebec72f9526fbba446f7d566117e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a timeout for a client connection.  <a href="_server_8cpp.html#abb21ebec72f9526fbba446f7d566117e">More...</a><br /></td></tr>
<tr class="separator:abb21ebec72f9526fbba446f7d566117e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28fd29ec48bd9459c678980cfccca4cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf">checkForTimeout</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:a28fd29ec48bd9459c678980cfccca4cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterates through all connections and checks if any have timed out.  <a href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf">More...</a><br /></td></tr>
<tr class="separator:a28fd29ec48bd9459c678980cfccca4cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e2693ba11e20b84de090bcdd0b665db"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">cleanupClosedConnections</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:a9e2693ba11e20b84de090bcdd0b665db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterates through all connections and removes closed ones.  <a href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">More...</a><br /></td></tr>
<tr class="separator:a9e2693ba11e20b84de090bcdd0b665db"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a35359f61d42dbd6561a07c12009ca45a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35359f61d42dbd6561a07c12009ca45a">&#9670;&nbsp;</a></span>initVirtualServers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool initVirtualServers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>backlog</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="struct_config_server.html">ConfigServer</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>serverConfigs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize virtual servers. </p>
<p>Initializes virtual servers by iterating through the serverConfigs vector in the configuration file and opening a socket for each virtual server. It checks for duplicate servers using <a class="el" href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6" title="Check for duplicate virtual servers.">isDuplicateServer()</a> and skips opening the socket server if it already exists.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to initialize virtual servers for. </td></tr>
    <tr><td class="paramname">backlog</td><td>The maximum length to which the queue of pending connections for the virtual server may grow. </td></tr>
    <tr><td class="paramname">serverConfigs</td><td>The vector of server configurations from the configuration file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if at least one virtual server was added, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00351">351</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;{</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Initializing virtual servers&quot;</span>;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">for</span> (std::vector&lt;ConfigServer&gt;::const_iterator iter = serverConfigs.begin(); iter != serverConfigs.end(); ++iter) {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Adding virtual server: &quot;</span> &lt;&lt; iter-&gt;serverName &lt;&lt; <span class="stringliteral">&quot; on &quot;</span> &lt;&lt; iter-&gt;host &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; iter-&gt;port;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">isDuplicateServer</a>(server, iter-&gt;host, <a class="code" href="namespacewebutils.html#afd1710fd588c15830d10aef146da8ddb">webutils::toString</a>(iter-&gt;port)))</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">createVirtualServer</a>(server, iter-&gt;host, backlog, <a class="code" href="namespacewebutils.html#afd1710fd588c15830d10aef146da8ddb">webutils::toString</a>(iter-&gt;port)))</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Failed to add virtual server: &quot;</span> &lt;&lt; iter-&gt;serverName;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> (server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().empty())</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Finished setting up virtual servers&quot;</span>;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div>
<div class="ttc" id="a_log_8hpp_html_a6ff63e8955665c4a58b1598f2b07c51a"><div class="ttname"><a href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a></div><div class="ttdeci">#define LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="_log_8hpp_source.html#l00010">Log.hpp:10</a></div></div>
<div class="ttc" id="a_log_8hpp_html_aeb4f36db01bd128c7afeac5889dac311"><div class="ttname"><a href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a></div><div class="ttdeci">#define LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="_log_8hpp_source.html#l00011">Log.hpp:11</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a4f6456b9a16154a6d320ae8b370285d6"><div class="ttname"><a href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">isDuplicateServer</a></div><div class="ttdeci">bool isDuplicateServer(const Server &amp;server, const std::string &amp;host, const std::string &amp;port)</div><div class="ttdoc">Check for duplicate virtual servers.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00385">Server.cpp:385</a></div></div>
<div class="ttc" id="a_server_8cpp_html_aa6ca6a0179cbb661c05aa6b2758f5389"><div class="ttname"><a href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">createVirtualServer</a></div><div class="ttdeci">bool createVirtualServer(Server &amp;server, const std::string &amp;host, int backlog, const std::string &amp;port)</div><div class="ttdoc">Creates a new virtual server and registers it with the server object.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00425">Server.cpp:425</a></div></div>
<div class="ttc" id="aclass_server_html_a878b0cc2f9bc228dd12b250d95d61a75"><div class="ttname"><a href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">Server::getVirtualServers</a></div><div class="ttdeci">const std::map&lt; int, Socket &gt; &amp; getVirtualServers() const</div><div class="ttdoc">Const Getter for virtual servers.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00090">Server.cpp:90</a></div></div>
<div class="ttc" id="anamespacewebutils_html_afd1710fd588c15830d10aef146da8ddb"><div class="ttname"><a href="namespacewebutils.html#afd1710fd588c15830d10aef146da8ddb">webutils::toString</a></div><div class="ttdeci">std::string toString(const Type &amp;type)</div><div class="ttdoc">Convert a type to a string.</div><div class="ttdef"><b>Definition:</b> <a href="utilities_8hpp_source.html#l00037">utilities.hpp:37</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a35359f61d42dbd6561a07c12009ca45a_cgraph.svg" width="100%" height="542"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a35359f61d42dbd6561a07c12009ca45a_icgraph.svg" width="263" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a4f6456b9a16154a6d320ae8b370285d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f6456b9a16154a6d320ae8b370285d6">&#9670;&nbsp;</a></span>isDuplicateServer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isDuplicateServer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check for duplicate virtual servers. </p>
<p>Checks if a virtual server with the provided host and port already exists in the virtual servers map. If the host is "localhost", it checks for a virtual server with the host address "127.0.0.1" or "::1".</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to check for duplicate virtual servers. </td></tr>
    <tr><td class="paramname">host</td><td>The host address of the virtual server. </td></tr>
    <tr><td class="paramname">port</td><td>The port number of the virtual server.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if a duplicate virtual server exists, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00385">385</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;{</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">if</span> (host == <span class="stringliteral">&quot;localhost&quot;</span>) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">for</span> (std::map&lt;int, Socket&gt;::const_iterator iter = server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().begin();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;             iter != server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().end(); ++iter) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="keywordflow">if</span> ((iter-&gt;second.host == <span class="stringliteral">&quot;127.0.0.1&quot;</span> || iter-&gt;second.host == <span class="stringliteral">&quot;::1&quot;</span>) &amp;&amp; iter-&gt;second.port == port) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Virtual server already exists: &quot;</span> &lt;&lt; iter-&gt;second;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            }</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordflow">for</span> (std::map&lt;int, Socket&gt;::const_iterator iter = server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().begin();</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;             iter != server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().end(); ++iter) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keywordflow">if</span> (iter-&gt;second.host == host &amp;&amp; iter-&gt;second.port == port) {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Virtual server already exists: &quot;</span> &lt;&lt; iter-&gt;second;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a4f6456b9a16154a6d320ae8b370285d6_cgraph.svg" width="382" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a4f6456b9a16154a6d320ae8b370285d6_icgraph.svg" width="448" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aa6ca6a0179cbb661c05aa6b2758f5389"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6ca6a0179cbb661c05aa6b2758f5389">&#9670;&nbsp;</a></span>createVirtualServer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool createVirtualServer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>backlog</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a new virtual server and registers it with the server object. </p>
<p>Creates a listening socket for a virtual server using the provided host, port, and backlog and adds it to the virtual servers map. Uses <a class="el" href="class_server.html#abf1dc68ec7f88650ad80e93f56e14e5c" title="Wrapper function to SocketPolicy::resolveListeningAddresses.">Server::resolveListeningAddresses()</a> to get a list of address information for the provided host and port. It then tries to create a listening socket for each value in the list using <a class="el" href="class_server.html#a64115bbffcd050870e5380768033c560" title="Wrapper function to SocketPolicy::createListeningSocket.">Server::createListeningSocket()</a>. If succesful calls <a class="el" href="class_server.html#a4915bdc5e654a3319fddc120c8656019" title="Wrapper function to SocketPolicy::retrieveSocketInfo.">Server::retrieveSocketInfo()</a> and registers the virtual server using <a class="el" href="class_server.html#aae8cc5a8fc07a6ce97d468d94cd08a6e" title="Register a virtual server.">Server::registerVirtualServer()</a>. If any step fails, it continues to the next value in the list. After the loop, the created address list is freed. If no valid socket was created, it logs an error and returns false.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to add the virtual server to. </td></tr>
    <tr><td class="paramname">host</td><td>host address for the virtual server. </td></tr>
    <tr><td class="paramname">backlog</td><td>maximum length to which the queue of pending connections for the virtual server may grow. </td></tr>
    <tr><td class="paramname">port</td><td>port number for the virtual server.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the virtual server was successfully added, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00425">425</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;{</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keyword">struct </span>addrinfo* list = server.<a class="code" href="class_server.html#abf1dc68ec7f88650ad80e93f56e14e5c">resolveListeningAddresses</a>(host, port);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span> (list == NULL)</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordtype">size_t</span> successfulSock = 0;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordtype">size_t</span> countTryCreateSocket = 1;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">struct</span> addrinfo* curr = list; curr != NULL; curr = curr-&gt;ai_next) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; countTryCreateSocket &lt;&lt; <span class="stringliteral">&quot;. try to create listening socket&quot;</span>;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> newFd = server.<a class="code" href="class_server.html#a64115bbffcd050870e5380768033c560">createListeningSocket</a>(*curr, backlog);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">if</span> (newFd == -1)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keyword">const</span> <a class="code" href="struct_socket.html">Socket</a> serverSock = server.<a class="code" href="class_server.html#a4915bdc5e654a3319fddc120c8656019">retrieveSocketInfo</a>(*curr-&gt;ai_addr, curr-&gt;ai_addrlen);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">if</span> (serverSock.<a class="code" href="struct_socket.html#a986f7cf6e2d3334e9ad91a35681c1f80">host</a>.empty() &amp;&amp; serverSock.<a class="code" href="struct_socket.html#af75711bf9c0f0788d7767f836a97c5e6">port</a>.empty()) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            close(newFd);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">if</span> (!server.<a class="code" href="class_server.html#aae8cc5a8fc07a6ce97d468d94cd08a6e">registerVirtualServer</a>(newFd, serverSock))</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        ++successfulSock;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    freeaddrinfo(list);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">if</span> (successfulSock == 0) {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Cannot bind to a valid socket.&quot;</span>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;}</div>
<div class="ttc" id="a_log_8hpp_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="_log_8hpp_source.html#l00013">Log.hpp:13</a></div></div>
<div class="ttc" id="aclass_server_html_a4915bdc5e654a3319fddc120c8656019"><div class="ttname"><a href="class_server.html#a4915bdc5e654a3319fddc120c8656019">Server::retrieveSocketInfo</a></div><div class="ttdeci">Socket retrieveSocketInfo(struct sockaddr &amp;sockaddr, socklen_t socklen) const</div><div class="ttdoc">Wrapper function to SocketPolicy::retrieveSocketInfo.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00244">Server.cpp:244</a></div></div>
<div class="ttc" id="aclass_server_html_a64115bbffcd050870e5380768033c560"><div class="ttname"><a href="class_server.html#a64115bbffcd050870e5380768033c560">Server::createListeningSocket</a></div><div class="ttdeci">int createListeningSocket(const struct addrinfo &amp;addrinfo, int backlog) const</div><div class="ttdoc">Wrapper function to SocketPolicy::createListeningSocket.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00232">Server.cpp:232</a></div></div>
<div class="ttc" id="aclass_server_html_aae8cc5a8fc07a6ce97d468d94cd08a6e"><div class="ttname"><a href="class_server.html#aae8cc5a8fc07a6ce97d468d94cd08a6e">Server::registerVirtualServer</a></div><div class="ttdeci">bool registerVirtualServer(int serverFd, const Socket &amp;serverSock)</div><div class="ttdoc">Register a virtual server.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00136">Server.cpp:136</a></div></div>
<div class="ttc" id="aclass_server_html_abf1dc68ec7f88650ad80e93f56e14e5c"><div class="ttname"><a href="class_server.html#abf1dc68ec7f88650ad80e93f56e14e5c">Server::resolveListeningAddresses</a></div><div class="ttdeci">struct addrinfo * resolveListeningAddresses(const std::string &amp;host, const std::string &amp;port) const</div><div class="ttdoc">Wrapper function to SocketPolicy::resolveListeningAddresses.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00220">Server.cpp:220</a></div></div>
<div class="ttc" id="astruct_socket_html"><div class="ttname"><a href="struct_socket.html">Socket</a></div><div class="ttdoc">Represent a socket connection.</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8hpp_source.html#l00008">Socket.hpp:8</a></div></div>
<div class="ttc" id="astruct_socket_html_a986f7cf6e2d3334e9ad91a35681c1f80"><div class="ttname"><a href="struct_socket.html#a986f7cf6e2d3334e9ad91a35681c1f80">Socket::host</a></div><div class="ttdeci">std::string host</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8hpp_source.html#l00009">Socket.hpp:9</a></div></div>
<div class="ttc" id="astruct_socket_html_af75711bf9c0f0788d7767f836a97c5e6"><div class="ttname"><a href="struct_socket.html#af75711bf9c0f0788d7767f836a97c5e6">Socket::port</a></div><div class="ttdeci">std::string port</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8hpp_source.html#l00010">Socket.hpp:10</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_aa6ca6a0179cbb661c05aa6b2758f5389_cgraph.svg" width="100%" height="466"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_aa6ca6a0179cbb661c05aa6b2758f5389_icgraph.svg" width="459" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="af9f4479a6262c17deef89938118d27f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9f4479a6262c17deef89938118d27f4">&#9670;&nbsp;</a></span>handleEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleEvent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct epoll_event&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accepts new connections or handles existing ones. </p>
<p>This function acts as a general dispatcher for handling events. Checks if the event file descriptor is in the virtual servers map. If it is, it calls <a class="el" href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18" title="Accept new connections.">acceptConnections()</a>. If the event mask contains EPOLLERR, it logs an error and closes the virtual server.</p>
<p>If it is not in the virtual servers map, then it is a connection event. If the event mask contains EPOLLERR or EPOLLHUP, the event mask is set to EPOLLIN. This is done to handle errors and hangups that may occur during the processing of the connection. The <a class="el" href="class_server.html" title="Main class of the HTTP server.">Server</a> could then try to recv(), which will return 0 in case of EPOLLHUP or -1 in case of EPOLLERR, resulting in a connection close. </p><dl class="section see"><dt>See also</dt><dd><a href="https://stackoverflow.com/a/29206631">https://stackoverflow.com/a/29206631</a></dd></dl>
<p>handleConnections() is called with the connection from the connections map. A connection should exist in the connections map, therefore it is not checked if the file descriptor is in the connections map.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>The epoll event to handle. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00483">483</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;{</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    uint32_t eventMask = <span class="keyword">event</span>.events;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    std::map&lt;int, Socket&gt;::const_iterator iter = server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().find(event.data.fd);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">if</span> (iter != server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().end()) {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordflow">if</span> ((eventMask &amp; EPOLLERR) != 0) {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Error condition happened on the associated file descriptor of &quot;</span> &lt;&lt; iter-&gt;second;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            close(event.data.fd);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <a class="code" href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18">acceptConnections</a>(server, iter-&gt;first, iter-&gt;second, eventMask);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">if</span> ((eventMask &amp; EPOLLERR) != 0) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;epoll_wait: EPOLLERR&quot;</span>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            eventMask = EPOLLIN;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((eventMask &amp; EPOLLHUP) != 0) {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;epoll_wait: EPOLLHUP&quot;</span>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            eventMask = EPOLLIN;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        }</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <a class="code" href="_server_8cpp.html#a581dddd40d3728b6d22216003e2065b5">handleConnection</a>(server, event.data.fd, server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().at(event.data.fd));</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a581dddd40d3728b6d22216003e2065b5"><div class="ttname"><a href="_server_8cpp.html#a581dddd40d3728b6d22216003e2065b5">handleConnection</a></div><div class="ttdeci">void handleConnection(Server &amp;server, const int clientFd, Connection &amp;connection)</div><div class="ttdoc">Handle a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00585">Server.cpp:585</a></div></div>
<div class="ttc" id="a_server_8cpp_html_adb579f3d67061d752e882e6fb3ef6f18"><div class="ttname"><a href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18">acceptConnections</a></div><div class="ttdeci">void acceptConnections(Server &amp;server, int serverFd, const Socket &amp;serverSock, uint32_t eventMask)</div><div class="ttdoc">Accept new connections.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00528">Server.cpp:528</a></div></div>
<div class="ttc" id="aclass_server_html_aab1a7e57f49a0c7b7f1cea147d8bf9aa"><div class="ttname"><a href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">Server::getConnections</a></div><div class="ttdeci">std::map&lt; int, Connection &gt; &amp; getConnections()</div><div class="ttdoc">Getter for connections.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00097">Server.cpp:97</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_af9f4479a6262c17deef89938118d27f4_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_af9f4479a6262c17deef89938118d27f4_icgraph.svg" width="358" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="adb579f3d67061d752e882e6fb3ef6f18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb579f3d67061d752e882e6fb3ef6f18">&#9670;&nbsp;</a></span>acceptConnections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void acceptConnections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>serverFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_socket.html">Socket</a> &amp;&#160;</td>
          <td class="paramname"><em>serverSock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>eventMask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accept new connections. </p>
<p>If the event mask does not contain <code>EPOLLIN</code>, it logs an error and returns. A server socket should always receive a read event.</p>
<p>In a loop, calls <a class="el" href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865" title="Wrapper function to SocketPolicy::acceptSingleConnection().">Server::acceptSingleConnection()</a> to accept new connections on the server socket. When <a class="el" href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865" title="Wrapper function to SocketPolicy::acceptSingleConnection().">Server::acceptSingleConnection()</a> is successful, information of the client socket is retrieved with <a class="el" href="class_server.html#a4915bdc5e654a3319fddc120c8656019" title="Wrapper function to SocketPolicy::retrieveSocketInfo.">Server::retrieveSocketInfo()</a>. This new client socket is then registered with <a class="el" href="class_server.html#ac145e9f668db85b10a66829bd2677746" title="Register a connection.">Server::registerConnection()</a>.</p>
<p>The while-loop allows for multiple connections to be accepted in one call of this function. It is broken when accept() sets errno to EAGAIN or EWOULDBLOCK (equivalent error codes indicating that a non-blocking operation would normally block), meaning that no more connections are pending. If another errno is returned logs an error and continues to the next iteration of the loop. This is because the server sockets are in EPOLLET mode. If only one connection would be accepted the same server fd would not be reported again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to accept connections for. </td></tr>
    <tr><td class="paramname">serverFd</td><td>File descriptor of the server socket. </td></tr>
    <tr><td class="paramname">serverSock</td><td><a class="el" href="class_server.html" title="Main class of the HTTP server.">Server</a> socket which reported an event. </td></tr>
    <tr><td class="paramname">eventMask</td><td>Event mask of the reported event. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00528">528</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;{</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Accept connections on: &quot;</span> &lt;&lt; serverSock;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">if</span> ((eventMask &amp; EPOLLIN) == 0) {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Received unknown event:&quot;</span> &lt;&lt; eventMask;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160; </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keyword">struct </span>sockaddr_storage clientAddr = {};</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        socklen_t clientLen = <span class="keyword">sizeof</span>(clientAddr);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="comment">// NOLINTNEXTLINE: we need to use reinterpret_cast to convert sockaddr_storage to sockaddr</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keyword">struct </span>sockaddr* addrCast = <span class="keyword">reinterpret_cast&lt;</span>struct sockaddr*<span class="keyword">&gt;</span>(&amp;clientAddr);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> clientFd = server.<a class="code" href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865">acceptSingleConnection</a>(serverFd, addrCast, &amp;clientLen);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">if</span> (clientFd == -2)</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <span class="keywordflow">return</span>; <span class="comment">// No more pending connections</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="keywordflow">if</span> (clientFd == -1)</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="keywordflow">continue</span>; <span class="comment">// Error accepting connection</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keyword">const</span> <a class="code" href="struct_socket.html">Socket</a> clientSock = server.<a class="code" href="class_server.html#a4915bdc5e654a3319fddc120c8656019">retrieveSocketInfo</a>(*addrCast, clientLen);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="keywordflow">if</span> (clientSock.<a class="code" href="struct_socket.html#a986f7cf6e2d3334e9ad91a35681c1f80">host</a>.empty() &amp;&amp; clientSock.<a class="code" href="struct_socket.html#af75711bf9c0f0788d7767f836a97c5e6">port</a>.empty()) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            close(clientFd);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keywordflow">if</span> (!server.<a class="code" href="class_server.html#ac145e9f668db85b10a66829bd2677746">registerConnection</a>(serverSock, clientFd, clientSock))</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;}</div>
<div class="ttc" id="aclass_server_html_ac145e9f668db85b10a66829bd2677746"><div class="ttname"><a href="class_server.html#ac145e9f668db85b10a66829bd2677746">Server::registerConnection</a></div><div class="ttdeci">bool registerConnection(const Socket &amp;serverSock, int clientFd, const Socket &amp;clientSock)</div><div class="ttdoc">Register a connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00163">Server.cpp:163</a></div></div>
<div class="ttc" id="aclass_server_html_ad8823ad2d9c9a94cfafb40e8e0653865"><div class="ttname"><a href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865">Server::acceptSingleConnection</a></div><div class="ttdeci">int acceptSingleConnection(int sockfd, struct sockaddr *addr, socklen_t *addrlen) const</div><div class="ttdoc">Wrapper function to SocketPolicy::acceptSingleConnection().</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00257">Server.cpp:257</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_adb579f3d67061d752e882e6fb3ef6f18_cgraph.svg" width="100%" height="416"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_adb579f3d67061d752e882e6fb3ef6f18_icgraph.svg" width="551" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a581dddd40d3728b6d22216003e2065b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a581dddd40d3728b6d22216003e2065b5">&#9670;&nbsp;</a></span>handleConnection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleConnection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle a client connection. </p>
<p>After epoll reports an event on a client socket, this function is called to handle the connection. The event from the client can either be incoming (EPOLLIN) or outgoing (EPOLLOUT). This function dispatches to the correct subfunction depending on the connection state:</p><ol type="1">
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a> (in): every new connection starts in this state. <a class="el" href="_server_8cpp.html#a06d0cb066f08d5567ea6ba4ef2897927" title="Receive request header from a client.">connectionReceiveHeader()</a> reads the request header from the client and parses it. If the request header is complete, it changes the state to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a> or <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a> (in): if the request header indicates a body, <a class="el" href="_server_8cpp.html#a3f930db051b00ade521e2633cee948bd" title="Receives the body of a connection.">connectionReceiveBody()</a> reads the body from the client. If the body is complete, it changes the state to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a> (out): after a complete request (header and optional body) is received <a class="el" href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56" title="Builds the response for a client connection.">connectionBuildResponse()</a> builds the response for the client. It then changes the state to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a> and also calls <a class="el" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f" title="Sends the response to a client connection.">connectionSendResponse()</a> to try to immediatly send the response to the client.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a> (out): <a class="el" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f" title="Sends the response to a client connection.">connectionSendResponse()</a> sends the response to the client. This dispatch happens only if the response is not completely sent the first time.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a> (out): if the connection has timed out, <a class="el" href="_server_8cpp.html#abb21ebec72f9526fbba446f7d566117e" title="Handles a timeout for a client connection.">connectionHandleTimeout()</a> sets the request status to timeout. Then it calls <a class="el" href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56" title="Builds the response for a client connection.">connectionBuildResponse()</a> to build the error message, which then gets sent with <a class="el" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f" title="Sends the response to a client connection.">connectionSendResponse()</a>.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to handle the connection for. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to handle. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00585">585</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;{</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Handling connection: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a> &lt;&lt; <span class="stringliteral">&quot; for server: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#ae9c64be721ccc3676197f3ebbb58fe18">m_serverSocket</a>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">switch</span> (connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a>) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a>):</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <a class="code" href="_server_8cpp.html#a06d0cb066f08d5567ea6ba4ef2897927">connectionReceiveHeader</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a>):</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <a class="code" href="_server_8cpp.html#a3f930db051b00ade521e2633cee948bd">connectionReceiveBody</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>):</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <a class="code" href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56">connectionBuildResponse</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a>):</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <a class="code" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f">connectionSendResponse</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a>):</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <a class="code" href="_server_8cpp.html#abb21ebec72f9526fbba446f7d566117e">connectionHandleTimeout</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>):</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a06d0cb066f08d5567ea6ba4ef2897927"><div class="ttname"><a href="_server_8cpp.html#a06d0cb066f08d5567ea6ba4ef2897927">connectionReceiveHeader</a></div><div class="ttdeci">void connectionReceiveHeader(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Receive request header from a client.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00634">Server.cpp:634</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a3f930db051b00ade521e2633cee948bd"><div class="ttname"><a href="_server_8cpp.html#a3f930db051b00ade521e2633cee948bd">connectionReceiveBody</a></div><div class="ttdeci">void connectionReceiveBody(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Receives the body of a connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00711">Server.cpp:711</a></div></div>
<div class="ttc" id="a_server_8cpp_html_abb21ebec72f9526fbba446f7d566117e"><div class="ttname"><a href="_server_8cpp.html#abb21ebec72f9526fbba446f7d566117e">connectionHandleTimeout</a></div><div class="ttdeci">void connectionHandleTimeout(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Handles a timeout for a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00865">Server.cpp:865</a></div></div>
<div class="ttc" id="a_server_8cpp_html_ac98878a19797a7f939c3a5ea1e028e56"><div class="ttname"><a href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56">connectionBuildResponse</a></div><div class="ttdeci">void connectionBuildResponse(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Builds the response for a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00798">Server.cpp:798</a></div></div>
<div class="ttc" id="a_server_8cpp_html_adcf8118ac987f6afae3aec0c54cc5f9f"><div class="ttname"><a href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f">connectionSendResponse</a></div><div class="ttdeci">void connectionSendResponse(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Sends the response to a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00824">Server.cpp:824</a></div></div>
<div class="ttc" id="astruct_connection_html_a244c1b9870181fb1c847758d21e2c8b3"><div class="ttname"><a href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">Connection::m_clientSocket</a></div><div class="ttdeci">Socket m_clientSocket</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00022">Connection.hpp:22</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a></div><div class="ttdeci">@ ReceiveBody</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00019">Connection.hpp:19</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a></div><div class="ttdeci">@ Closed</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00019">Connection.hpp:19</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a></div><div class="ttdeci">@ BuildResponse</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00019">Connection.hpp:19</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a></div><div class="ttdeci">@ ReceiveHeader</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00019">Connection.hpp:19</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a></div><div class="ttdeci">@ Timeout</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00019">Connection.hpp:19</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a></div><div class="ttdeci">@ SendResponse</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00019">Connection.hpp:19</a></div></div>
<div class="ttc" id="astruct_connection_html_ae9c64be721ccc3676197f3ebbb58fe18"><div class="ttname"><a href="struct_connection.html#ae9c64be721ccc3676197f3ebbb58fe18">Connection::m_serverSocket</a></div><div class="ttdeci">Socket m_serverSocket</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00021">Connection.hpp:21</a></div></div>
<div class="ttc" id="astruct_connection_html_af433353beabb6990235b13b24c8b6bbe"><div class="ttname"><a href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">Connection::m_status</a></div><div class="ttdeci">ConnectionStatus m_status</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00024">Connection.hpp:24</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a581dddd40d3728b6d22216003e2065b5_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a581dddd40d3728b6d22216003e2065b5_icgraph.svg" width="544" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a06d0cb066f08d5567ea6ba4ef2897927"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06d0cb066f08d5567ea6ba4ef2897927">&#9670;&nbsp;</a></span>connectionReceiveHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionReceiveHeader </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive request header from a client. </p>
<p>This function reads data from the client socket using <a class="el" href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423" title="Wrapper function to SocketPolicy::readFromSocket.">Server::readFromSocket()</a>. The amount of bytes to read from the socket is determined by the bytes already received from the client. It can never be bigger than the buffer size.</p><ul>
<li>If bytes read is -1, it indicates an internal server error</li>
<li>If bytes read is 0, it indicates that the connection has been closed by the client In both cases the clientFd is closed and the connection status is set to Closed. If bytes read is greater than 0, the bytes received are added to the connection buffer and the bytes received of the connection are updated. If the buffer contains a complete request, it parses the request. Then the request is removed from the client buffer, the connection is set to BuildResponse state and the event is modified to listen to EPOLLOUT. If no complete request was received and the received bytes match the buffer size, sets HTTP status code to 413 Request Header Fields Too Large and status to BuildResponse, since the request header was too big.</li>
</ul>
<p>In any case the time since the last event is updated to the current time.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to receive the request for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000010">Todo:</a></b></dt><dd><p class="startdd">Implement body handling. </p>
<p class="enddd">make clientHeaderBufferSize configurable. </p>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00634">634</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;{</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Receive Request Header for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordtype">char</span> buffer[<a class="code" href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a>] = {};</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> bytesToRead = <a class="code" href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a> - connection.<a class="code" href="struct_connection.html#a2510358c7ff2b930584453c33a2f4791">m_bytesReceived</a>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keyword">const</span> ssize_t bytesRead = server.<a class="code" href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423">readFromSocket</a>(clientFd, buffer, bytesToRead, 0);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span> (bytesRead == -1) {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Internal server error while reading from socket: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bytesRead == 0) {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Connection closed by client: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        connection.<a class="code" href="struct_connection.html#a2510358c7ff2b930584453c33a2f4791">m_bytesReceived</a> += bytesRead;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a> += buffer;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a172c400277e73261d212c33f66226090">isCompleteRequestHeader</a>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>)) {</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received complete request header: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                server.<a class="code" href="class_server.html#a34bc61299318fe1918293b1d656ee5f9">parseHeader</a>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>, connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            } <span class="keywordflow">catch</span> (std::exception&amp; e) {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; e.what();</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.erase(0, connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.find(<span class="stringliteral">&quot;\r\n\r\n&quot;</span>) + 4);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                connection.<a class="code" href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">m_timeSinceLastEvent</a> = std::time(0);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#ab3f30f449eb8a8b6df63cd67986961ff">hasBody</a>)</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a>;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            }</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.erase(0, connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.find(<span class="stringliteral">&quot;\r\n\r\n&quot;</span>) + 4);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received partial request header: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#a2510358c7ff2b930584453c33a2f4791">m_bytesReceived</a> == <a class="code" href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a>) {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Buffer full, didn&#39;t receive complete request header from &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa934528334c51781e546b5808ef678212">StatusRequestHeaderFieldsTooLarge</a>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            }</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    connection.<a class="code" href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">m_timeSinceLastEvent</a> = std::time(0);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a172c400277e73261d212c33f66226090"><div class="ttname"><a href="_server_8cpp.html#a172c400277e73261d212c33f66226090">isCompleteRequestHeader</a></div><div class="ttdeci">bool isCompleteRequestHeader(const std::string &amp;connectionBuffer)</div><div class="ttdoc">Checks if the connection buffer contains a request header.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00692">Server.cpp:692</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa934528334c51781e546b5808ef678212"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa934528334c51781e546b5808ef678212">StatusRequestHeaderFieldsTooLarge</a></div><div class="ttdeci">@ StatusRequestHeaderFieldsTooLarge</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00014">StatusCode.hpp:14</a></div></div>
<div class="ttc" id="aclass_server_html_a043a3f346d803051483a0321fc5c98db"><div class="ttname"><a href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a></div><div class="ttdeci">static const std::size_t s_clientHeaderBufferSize</div><div class="ttdef"><b>Definition:</b> <a href="_server_8hpp_source.html#l00049">Server.hpp:49</a></div></div>
<div class="ttc" id="aclass_server_html_a34bc61299318fe1918293b1d656ee5f9"><div class="ttname"><a href="class_server.html#a34bc61299318fe1918293b1d656ee5f9">Server::parseHeader</a></div><div class="ttdeci">void parseHeader(const std::string &amp;requestString, HTTPRequest &amp;request)</div><div class="ttdoc">Wrapper function to RequestParser::parseHeader.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00298">Server.cpp:298</a></div></div>
<div class="ttc" id="aclass_server_html_ae94e3d4b5743580a6fbe3228d58af423"><div class="ttname"><a href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423">Server::readFromSocket</a></div><div class="ttdeci">ssize_t readFromSocket(int sockfd, char *buffer, size_t size, int flags) const</div><div class="ttdoc">Wrapper function to SocketPolicy::readFromSocket.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00271">Server.cpp:271</a></div></div>
<div class="ttc" id="aclass_server_html_afab1a4ec9e524b0dae8f60080642e7fe"><div class="ttname"><a href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">Server::modifyEvent</a></div><div class="ttdeci">bool modifyEvent(int modfd, uint32_t eventMask) const</div><div class="ttdoc">Wrapper function to EpollWrapper::modifyEvent.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00202">Server.cpp:202</a></div></div>
<div class="ttc" id="astruct_connection_html_a2510358c7ff2b930584453c33a2f4791"><div class="ttname"><a href="struct_connection.html#a2510358c7ff2b930584453c33a2f4791">Connection::m_bytesReceived</a></div><div class="ttdeci">ssize_t m_bytesReceived</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00026">Connection.hpp:26</a></div></div>
<div class="ttc" id="astruct_connection_html_a4157497e77aed0e8b399a47eba498683"><div class="ttname"><a href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">Connection::m_buffer</a></div><div class="ttdeci">std::string m_buffer</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00025">Connection.hpp:25</a></div></div>
<div class="ttc" id="astruct_connection_html_a8038f77baa0072e5aa044efa5ab47625"><div class="ttname"><a href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">Connection::m_timeSinceLastEvent</a></div><div class="ttdeci">time_t m_timeSinceLastEvent</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00023">Connection.hpp:23</a></div></div>
<div class="ttc" id="astruct_connection_html_ae94a8a88f07c64cf17ada17c7e670ada"><div class="ttname"><a href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">Connection::m_request</a></div><div class="ttdeci">HTTPRequest m_request</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00027">Connection.hpp:27</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_a4ab3aefab7679eeb2b4e97f7043bdff3"><div class="ttname"><a href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">HTTPRequest::httpStatus</a></div><div class="ttdeci">statusCode httpStatus</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00025">HTTPRequest.hpp:25</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_ab3f30f449eb8a8b6df63cd67986961ff"><div class="ttname"><a href="struct_h_t_t_p_request.html#ab3f30f449eb8a8b6df63cd67986961ff">HTTPRequest::hasBody</a></div><div class="ttdeci">bool hasBody</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00027">HTTPRequest.hpp:27</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a06d0cb066f08d5567ea6ba4ef2897927_cgraph.svg" width="100%" height="442"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a06d0cb066f08d5567ea6ba4ef2897927_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a172c400277e73261d212c33f66226090"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a172c400277e73261d212c33f66226090">&#9670;&nbsp;</a></span>isCompleteRequestHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isCompleteRequestHeader </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>connectionBuffer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the connection buffer contains a request header. </p>
<p>A request header is defined as a string that ends with "\r\n\r\n". </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">connectionBuffer</td><td>The buffer to check for a complete request. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the buffer contains a complete request, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00692">692</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;{</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordflow">return</span> (connectionBuffer.find(<span class="stringliteral">&quot;\r\n\r\n&quot;</span>) != std::string::npos);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a172c400277e73261d212c33f66226090_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a3f930db051b00ade521e2633cee948bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f930db051b00ade521e2633cee948bd">&#9670;&nbsp;</a></span>connectionReceiveBody()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionReceiveBody </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receives the body of a connection. </p>
<p>This function is responsible for receiving the body of a connection from the client. It reads data from the socket and appends it to the connection's buffer. If the buffer size exceeds the maximum allowed client request body size, an error is logged and the connection's HTTP status is set to StatusRequestEntityTooLarge. If the complete request body is received, it is parsed and the connection's status is set to BuildResponse. If an exception occurs during parsing, an error is logged and the connection's status is set to BuildResponse.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client socket. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00711">711</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;{</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;ReceiveBody for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordtype">char</span> buffer[<a class="code" href="class_server.html#a6209b5a55764d2e563be4825d1fcf84a">Server::s_clientBodyBufferSize</a>] = {};</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160; </div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keyword">const</span> ssize_t bytesRead = server.<a class="code" href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423">readFromSocket</a>(clientFd, buffer, <span class="keyword">sizeof</span>(buffer), 0);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">if</span> (bytesRead == -1) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Internal server error while reading from socket: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bytesRead == 0) {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Connection closed by client: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a> += buffer;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size() &gt;= <a class="code" href="class_server.html#a794aa3ae836d313505706b951a7a02f0">Server::s_clientMaxBodySize</a>) {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Maximum allowed client request body size reached from &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa80247b37438ce9e27971aff9469049c6">StatusRequestEntityTooLarge</a>;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            connection.<a class="code" href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">m_timeSinceLastEvent</a> = std::time(0);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        }</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a14a0c5a1227276017a19d9b52141c13a">isCompleteBody</a>(connection)) {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received complete request body: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                server.<a class="code" href="class_server.html#ace46f4e07ab67db60e3790a32b2e8e0a">parseBody</a>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>, connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            } <span class="keywordflow">catch</span> (std::exception&amp; e) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; e.what();</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.erase(0);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received partial request body: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> == <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424">StatusBadRequest</a>) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <a class="code" href="error_8hpp.html#a683508ef2f2400bcd0f5f5e02dfd85c5">ERR_CONTENT_LENGTH</a>;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    connection.<a class="code" href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">m_timeSinceLastEvent</a> = std::time(0);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a14a0c5a1227276017a19d9b52141c13a"><div class="ttname"><a href="_server_8cpp.html#a14a0c5a1227276017a19d9b52141c13a">isCompleteBody</a></div><div class="ttdeci">bool isCompleteBody(Connection &amp;connection)</div><div class="ttdoc">Checks if the HTTP request body has been completely received.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00771">Server.cpp:771</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa80247b37438ce9e27971aff9469049c6"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa80247b37438ce9e27971aff9469049c6">StatusRequestEntityTooLarge</a></div><div class="ttdeci">@ StatusRequestEntityTooLarge</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00013">StatusCode.hpp:13</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424">StatusBadRequest</a></div><div class="ttdeci">@ StatusBadRequest</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00008">StatusCode.hpp:8</a></div></div>
<div class="ttc" id="aclass_server_html_a6209b5a55764d2e563be4825d1fcf84a"><div class="ttname"><a href="class_server.html#a6209b5a55764d2e563be4825d1fcf84a">Server::s_clientBodyBufferSize</a></div><div class="ttdeci">static const std::size_t s_clientBodyBufferSize</div><div class="ttdef"><b>Definition:</b> <a href="_server_8hpp_source.html#l00050">Server.hpp:50</a></div></div>
<div class="ttc" id="aclass_server_html_a794aa3ae836d313505706b951a7a02f0"><div class="ttname"><a href="class_server.html#a794aa3ae836d313505706b951a7a02f0">Server::s_clientMaxBodySize</a></div><div class="ttdeci">static const std::size_t s_clientMaxBodySize</div><div class="ttdef"><b>Definition:</b> <a href="_server_8hpp_source.html#l00051">Server.hpp:51</a></div></div>
<div class="ttc" id="aclass_server_html_ace46f4e07ab67db60e3790a32b2e8e0a"><div class="ttname"><a href="class_server.html#ace46f4e07ab67db60e3790a32b2e8e0a">Server::parseBody</a></div><div class="ttdeci">void parseBody(const std::string &amp;bodyString, HTTPRequest &amp;request)</div><div class="ttdoc">Wrapper function to RequestParser::parseBody.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00309">Server.cpp:309</a></div></div>
<div class="ttc" id="aerror_8hpp_html_a683508ef2f2400bcd0f5f5e02dfd85c5"><div class="ttname"><a href="error_8hpp.html#a683508ef2f2400bcd0f5f5e02dfd85c5">ERR_CONTENT_LENGTH</a></div><div class="ttdeci">#define ERR_CONTENT_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="error_8hpp_source.html#l00033">error.hpp:33</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a3f930db051b00ade521e2633cee948bd_cgraph.svg" width="100%" height="442"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a3f930db051b00ade521e2633cee948bd_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a14a0c5a1227276017a19d9b52141c13a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14a0c5a1227276017a19d9b52141c13a">&#9670;&nbsp;</a></span>isCompleteBody()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isCompleteBody </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the HTTP request body has been completely received. </p>
<p>This function determines whether the HTTP request body in the given connection has been completely received. If the request is not chunked, it checks whether the content length matches the buffer size. In case the buffer size is larger than the content length, the request status is set to StatusBadRequest. If the request is chunked, it checks for the presence of the chunked transfer termination sequence ("0\r\n\r\n").</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">connection</td><td>A reference to the <a class="el" href="struct_connection.html" title="Represents a connection between a server and a client.">Connection</a> object representing the current HTTP connection. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the request body has been completely received, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00771">771</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;{</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">if</span> (!connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#ac894099e690bcad5b4c6423c00b75017">isChunked</a>) {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> contentLength</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            = std::strtoul(connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a7f295acd62075df13848bd3103c89bbf">headers</a>.at(<span class="stringliteral">&quot;Content-Length&quot;</span>).c_str(), NULL, <a class="code" href="_request_parser_8hpp.html#aff72947139a61565b6d3a05d25233a5e">decimalBase</a>);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keywordflow">if</span> (contentLength &lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size()) {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424">StatusBadRequest</a>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="keywordflow">if</span> (contentLength == connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size())</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    }</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">return</span> connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.find(<span class="stringliteral">&quot;0\r\n\r\n&quot;</span>) != std::string::npos;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;}</div>
<div class="ttc" id="a_request_parser_8hpp_html_aff72947139a61565b6d3a05d25233a5e"><div class="ttname"><a href="_request_parser_8hpp.html#aff72947139a61565b6d3a05d25233a5e">decimalBase</a></div><div class="ttdeci">const int decimalBase</div><div class="ttdef"><b>Definition:</b> <a href="_request_parser_8hpp_source.html#l00023">RequestParser.hpp:23</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_a7f295acd62075df13848bd3103c89bbf"><div class="ttname"><a href="struct_h_t_t_p_request.html#a7f295acd62075df13848bd3103c89bbf">HTTPRequest::headers</a></div><div class="ttdeci">std::map&lt; std::string, std::string &gt; headers</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00023">HTTPRequest.hpp:23</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_ac894099e690bcad5b4c6423c00b75017"><div class="ttname"><a href="struct_h_t_t_p_request.html#ac894099e690bcad5b4c6423c00b75017">HTTPRequest::isChunked</a></div><div class="ttdeci">bool isChunked</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00028">HTTPRequest.hpp:28</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a14a0c5a1227276017a19d9b52141c13a_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ac98878a19797a7f939c3a5ea1e028e56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac98878a19797a7f939c3a5ea1e028e56">&#9670;&nbsp;</a></span>connectionBuildResponse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionBuildResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Builds the response for a client connection. </p>
<p>Builds the response for a client connection by calling <a class="el" href="class_server.html#a54550078a1a4dfdc827a1f39c01ca4e4" title="Wrapper function to ResponseBuilder::buildResponse.">Server::buildResponse()</a>. The response is stored in the connection buffer. The connection status is set to SendResponse and the response is sent to the client by calling <a class="el" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f" title="Sends the response to a client connection.">connectionSendResponse()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to build the response for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00798">798</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;{</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;BuildResponse for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    server.<a class="code" href="class_server.html#a54550078a1a4dfdc827a1f39c01ca4e4">buildResponse</a>(connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a> = server.<a class="code" href="class_server.html#a718bf76e7c3f830abb2f7b0972cdaa63">getResponse</a>();</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a>;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <a class="code" href="_server_8cpp.html#adcf8118ac987f6afae3aec0c54cc5f9f">connectionSendResponse</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;}</div>
<div class="ttc" id="aclass_server_html_a54550078a1a4dfdc827a1f39c01ca4e4"><div class="ttname"><a href="class_server.html#a54550078a1a4dfdc827a1f39c01ca4e4">Server::buildResponse</a></div><div class="ttdeci">void buildResponse(const HTTPRequest &amp;request)</div><div class="ttdoc">Wrapper function to ResponseBuilder::buildResponse.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00326">Server.cpp:326</a></div></div>
<div class="ttc" id="aclass_server_html_a718bf76e7c3f830abb2f7b0972cdaa63"><div class="ttname"><a href="class_server.html#a718bf76e7c3f830abb2f7b0972cdaa63">Server::getResponse</a></div><div class="ttdeci">std::string getResponse()</div><div class="ttdoc">Wrapper function to ResponseBuilder::getResponse.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00333">Server.cpp:333</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_ac98878a19797a7f939c3a5ea1e028e56_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_ac98878a19797a7f939c3a5ea1e028e56_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="adcf8118ac987f6afae3aec0c54cc5f9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcf8118ac987f6afae3aec0c54cc5f9f">&#9670;&nbsp;</a></span>connectionSendResponse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionSendResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends the response to a client connection. </p>
<p>Sends the response to a client connection by calling <a class="el" href="class_server.html#a8bf2a41e8ddcccd54b5832b58211a283" title="Wrapper function to SocketPolicy::writeToSocket.">Server::writeToSocket()</a>. The amount of bytes to send is determined by the size of the connection buffer. If sent bytes == -1 it indicates an internal server error and the connection is closed. If the response is not completely sent, the bytes sent are removed from the buffer and timeSinceLastEvent is updated. If the response is completely sent and the connection is set to close, the client socket is closed and the connection status is set to Closed. If the response is completely sent and the connection is not set to close, the event is modified to listen to EPOLLIN and the connection is cleared. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to send the response for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00824">824</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;{</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;SendResponse for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keyword">const</span> ssize_t bytesToSend = <span class="keyword">static_cast&lt;</span>ssize_t<span class="keyword">&gt;</span>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size());</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keyword">const</span> ssize_t sentBytes = server.<a class="code" href="class_server.html#a8bf2a41e8ddcccd54b5832b58211a283">writeToSocket</a>(clientFd, connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.c_str(), bytesToSend, 0);</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordflow">if</span> (sentBytes == -1) {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Internal server error&quot;</span>;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordflow">if</span> (sentBytes &lt; bytesToSend) {</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Sent &quot;</span> &lt;&lt; sentBytes &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span>;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.erase(0, sentBytes);</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        connection.<a class="code" href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">m_timeSinceLastEvent</a> = std::time(0);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#afc0f4c6d53b455a67ea264dbfc3be0e4">shallCloseConnection</a>) {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Closing connection&quot;</span>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        close(clientFd);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Connection alive&quot;</span>;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLIN);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <a class="code" href="_connection_8hpp.html#a5cde791aba7932d764243fd191c0d1bb">clearConnection</a>(connection);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;}</div>
<div class="ttc" id="a_connection_8hpp_html_a5cde791aba7932d764243fd191c0d1bb"><div class="ttname"><a href="_connection_8hpp.html#a5cde791aba7932d764243fd191c0d1bb">clearConnection</a></div><div class="ttdeci">void clearConnection(Connection &amp;connection)</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8cpp_source.html#l00047">Connection.cpp:47</a></div></div>
<div class="ttc" id="aclass_server_html_a8bf2a41e8ddcccd54b5832b58211a283"><div class="ttname"><a href="class_server.html#a8bf2a41e8ddcccd54b5832b58211a283">Server::writeToSocket</a></div><div class="ttdeci">ssize_t writeToSocket(int sockfd, const char *buffer, size_t size, int flags) const</div><div class="ttdoc">Wrapper function to SocketPolicy::writeToSocket.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00285">Server.cpp:285</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_afc0f4c6d53b455a67ea264dbfc3be0e4"><div class="ttname"><a href="struct_h_t_t_p_request.html#afc0f4c6d53b455a67ea264dbfc3be0e4">HTTPRequest::shallCloseConnection</a></div><div class="ttdeci">bool shallCloseConnection</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00026">HTTPRequest.hpp:26</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_adcf8118ac987f6afae3aec0c54cc5f9f_cgraph.svg" width="659" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_adcf8118ac987f6afae3aec0c54cc5f9f_icgraph.svg" width="100%" height="442"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="abb21ebec72f9526fbba446f7d566117e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb21ebec72f9526fbba446f7d566117e">&#9670;&nbsp;</a></span>connectionHandleTimeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionHandleTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles a timeout for a client connection. </p>
<p>Handles a timeout for a client connection by setting the request status to StatusRequestTimeout. Then it builds the error message by calling <a class="el" href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56" title="Builds the response for a client connection.">connectionBuildResponse()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">clientFd</td><td>The file descriptor of the client. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to handle the timeout for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00865">865</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;{</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Timeout for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#afc0f4c6d53b455a67ea264dbfc3be0e4">shallCloseConnection</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaacffa58a18c688740c290369c8bf13a3f">StatusRequestTimeout</a>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <a class="code" href="_server_8cpp.html#ac98878a19797a7f939c3a5ea1e028e56">connectionBuildResponse</a>(server, clientFd, connection);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;}</div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaacffa58a18c688740c290369c8bf13a3f"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaacffa58a18c688740c290369c8bf13a3f">StatusRequestTimeout</a></div><div class="ttdeci">@ StatusRequestTimeout</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00012">StatusCode.hpp:12</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_abb21ebec72f9526fbba446f7d566117e_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_abb21ebec72f9526fbba446f7d566117e_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a28fd29ec48bd9459c678980cfccca4cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28fd29ec48bd9459c678980cfccca4cf">&#9670;&nbsp;</a></span>checkForTimeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkForTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterates through all connections and checks if any have timed out. </p>
<p>If the connection status is Closed, it is skipped. The time since last event is saved in a variable to print it to the log and check if it is greater than the timeout set for the server. If it is, the connection is modified to EPOLLOUT, and the state is set to Timeout. When the fd is ready to receive a message the timeout error will be send. </p>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00883">883</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;{</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;int, Connection&gt;::iterator iter = server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().begin();</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;         iter != server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().end(); ++iter) {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;second.m_status == <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="keyword">const</span> time_t timeSinceLastEvent = std::time(0) - iter-&gt;second.m_timeSinceLastEvent;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; iter-&gt;second.m_clientSocket &lt;&lt; <span class="stringliteral">&quot;: Time since last event: &quot;</span> &lt;&lt; timeSinceLastEvent;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="keywordflow">if</span> (timeSinceLastEvent &gt; server.<a class="code" href="class_server.html#af8184a299847cca0789696048893bc48">getClientTimeout</a>()) {</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Connection timeout: &quot;</span> &lt;&lt; iter-&gt;second.m_clientSocket;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(iter-&gt;first, EPOLLOUT);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            iter-&gt;second.m_status = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        }</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    }</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;}</div>
<div class="ttc" id="aclass_server_html_af8184a299847cca0789696048893bc48"><div class="ttname"><a href="class_server.html#af8184a299847cca0789696048893bc48">Server::getClientTimeout</a></div><div class="ttdeci">time_t getClientTimeout() const</div><div class="ttdoc">Const Getter for client timeout.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00120">Server.cpp:120</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a28fd29ec48bd9459c678980cfccca4cf_cgraph.svg" width="626" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a28fd29ec48bd9459c678980cfccca4cf_icgraph.svg" width="390" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a9e2693ba11e20b84de090bcdd0b665db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e2693ba11e20b84de090bcdd0b665db">&#9670;&nbsp;</a></span>cleanupClosedConnections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanupClosedConnections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterates through all connections and removes closed ones. </p>
<p>The for loop through the connections map has no increment statement because the iterator is incremented in the loop body. If .erase() is called on an iterator, it is invalidated.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to cleanup closed connections for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00910">910</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;{</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;int, Connection&gt;::iterator iter = server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().begin();</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;         iter != server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().end();</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <span class="comment">/* no iter*/</span>) {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;second.m_status == <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>)</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            server.<a class="code" href="class_server.html#aab1a7e57f49a0c7b7f1cea147d8bf9aa">getConnections</a>().erase(iter++);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            ++iter;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    }</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a9e2693ba11e20b84de090bcdd0b665db_cgraph.svg" width="430" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a9e2693ba11e20b84de090bcdd0b665db_icgraph.svg" width="452" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="_server_8cpp.html">Server.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
