<!-- HTML header for doxygen 1.9.4-->
<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=11" />
	<meta name="generator" content="Doxygen 1.9.1" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>webserv: src/Server.cpp File Reference</title>
	<link href="tabs.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<link href="doxygen.css" rel="stylesheet" type="text/css" />
	<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
	<script type="text/javascript">
		DoxygenAwesomeDarkModeToggle.init()
	</script>
	<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
	<script type="text/javascript">
		DoxygenAwesomeFragmentCopyButton.init()
	</script>
	<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
	<script type="text/javascript">
		DoxygenAwesomeParagraphLink.init()
	</script>
</head>
<body>
		<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
			<div id="titlearea">
				<table cellspacing="0" cellpadding="0">
					<tbody>
						<tr id="projectrow">
							<td id="projectalign">
								<div id="projectname">webserv
								</div>
								<div id="projectbrief">This is when you finally understand why a URL starts with HTTP.</div>
							</td>
						</tr>
						<!--BEGIN FULL_SIDEBAR-->
						<tr>
							<td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
						</tr>
						<!--END FULL_SIDEBAR-->
					</tbody>
				</table>
			</div>
			<!-- end header part --><!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_server_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Server.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="_server_8hpp_source.html">Server.hpp</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for Server.cpp:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div>
<p><a href="_server_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a35359f61d42dbd6561a07c12009ca45a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a35359f61d42dbd6561a07c12009ca45a">initVirtualServers</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int backlog, const std::vector&lt; <a class="el" href="struct_config_server.html">ConfigServer</a> &gt; &amp;serverConfigs)</td></tr>
<tr class="memdesc:a35359f61d42dbd6561a07c12009ca45a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize virtual servers.  <a href="_server_8cpp.html#a35359f61d42dbd6561a07c12009ca45a">More...</a><br /></td></tr>
<tr class="separator:a35359f61d42dbd6561a07c12009ca45a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f6456b9a16154a6d320ae8b370285d6"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">isDuplicateServer</a> (const <a class="el" href="class_server.html">Server</a> &amp;server, const std::string &amp;host, const std::string &amp;port)</td></tr>
<tr class="memdesc:a4f6456b9a16154a6d320ae8b370285d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check for duplicate virtual servers.  <a href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">More...</a><br /></td></tr>
<tr class="separator:a4f6456b9a16154a6d320ae8b370285d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6ca6a0179cbb661c05aa6b2758f5389"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">createVirtualServer</a> (<a class="el" href="class_server.html">Server</a> &amp;server, const std::string &amp;host, int backlog, const std::string &amp;port)</td></tr>
<tr class="memdesc:aa6ca6a0179cbb661c05aa6b2758f5389"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a new virtual server and registers it with the server object.  <a href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">More...</a><br /></td></tr>
<tr class="separator:aa6ca6a0179cbb661c05aa6b2758f5389"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab66b27c2186daacb15a6b13dd43be31b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#ab66b27c2186daacb15a6b13dd43be31b">runServer</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:ab66b27c2186daacb15a6b13dd43be31b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Runs the main event loop with a server object.  <a href="_server_8cpp.html#ab66b27c2186daacb15a6b13dd43be31b">More...</a><br /></td></tr>
<tr class="separator:ab66b27c2186daacb15a6b13dd43be31b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9f4479a6262c17deef89938118d27f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4">handleEvent</a> (<a class="el" href="class_server.html">Server</a> &amp;server, struct epoll_event event)</td></tr>
<tr class="memdesc:af9f4479a6262c17deef89938118d27f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accepts new connections or handles existing ones.  <a href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4">More...</a><br /></td></tr>
<tr class="separator:af9f4479a6262c17deef89938118d27f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb579f3d67061d752e882e6fb3ef6f18"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18">acceptConnections</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int serverFd, const <a class="el" href="struct_socket.html">Socket</a> &amp;serverSock, uint32_t eventMask)</td></tr>
<tr class="memdesc:adb579f3d67061d752e882e6fb3ef6f18"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accept new connections.  <a href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18">More...</a><br /></td></tr>
<tr class="separator:adb579f3d67061d752e882e6fb3ef6f18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb62203471d9a64b23d0267d5a4a261a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#afb62203471d9a64b23d0267d5a4a261a">handleConnection</a> (<a class="el" href="class_server.html">Server</a> &amp;server, const int activeFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:afb62203471d9a64b23d0267d5a4a261a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle a client connection.  <a href="_server_8cpp.html#afb62203471d9a64b23d0267d5a4a261a">More...</a><br /></td></tr>
<tr class="separator:afb62203471d9a64b23d0267d5a4a261a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa45d6529fd7be9b7adf788a9679ae34b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#aa45d6529fd7be9b7adf788a9679ae34b">connectionReceiveHeader</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int activeFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:aa45d6529fd7be9b7adf788a9679ae34b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive request header from a client.  <a href="_server_8cpp.html#aa45d6529fd7be9b7adf788a9679ae34b">More...</a><br /></td></tr>
<tr class="separator:aa45d6529fd7be9b7adf788a9679ae34b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83350eae81b96dd7b301d1238268ffdb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a83350eae81b96dd7b301d1238268ffdb">handleCompleteRequestHeader</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int clientFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a83350eae81b96dd7b301d1238268ffdb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the complete request header received from a client.  <a href="_server_8cpp.html#a83350eae81b96dd7b301d1238268ffdb">More...</a><br /></td></tr>
<tr class="separator:a83350eae81b96dd7b301d1238268ffdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a172c400277e73261d212c33f66226090"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a172c400277e73261d212c33f66226090">isCompleteRequestHeader</a> (const std::string &amp;connectionBuffer)</td></tr>
<tr class="memdesc:a172c400277e73261d212c33f66226090"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the connection buffer contains a request header.  <a href="_server_8cpp.html#a172c400277e73261d212c33f66226090">More...</a><br /></td></tr>
<tr class="separator:a172c400277e73261d212c33f66226090"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92411155dbfc5d7f43c3f1ac0fe54548"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a92411155dbfc5d7f43c3f1ac0fe54548">isCGIRequested</a> (<a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a92411155dbfc5d7f43c3f1ac0fe54548"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if a CGI request is made based on the connection details.  <a href="_server_8cpp.html#a92411155dbfc5d7f43c3f1ac0fe54548">More...</a><br /></td></tr>
<tr class="separator:a92411155dbfc5d7f43c3f1ac0fe54548"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e07b970ffa58c9315b38673aff94f84"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a3e07b970ffa58c9315b38673aff94f84">connectionReceiveBody</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int activeFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a3e07b970ffa58c9315b38673aff94f84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the reception of the request body from a client connection.  <a href="_server_8cpp.html#a3e07b970ffa58c9315b38673aff94f84">More...</a><br /></td></tr>
<tr class="separator:a3e07b970ffa58c9315b38673aff94f84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14a0c5a1227276017a19d9b52141c13a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a14a0c5a1227276017a19d9b52141c13a">isCompleteBody</a> (<a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a14a0c5a1227276017a19d9b52141c13a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the HTTP request body has been completely received.  <a href="_server_8cpp.html#a14a0c5a1227276017a19d9b52141c13a">More...</a><br /></td></tr>
<tr class="separator:a14a0c5a1227276017a19d9b52141c13a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa67430205b6049aa70bad4682a7442b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#aa67430205b6049aa70bad4682a7442b8">connectionSendToCGI</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int activeFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:aa67430205b6049aa70bad4682a7442b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the request body to the CGI process.  <a href="_server_8cpp.html#aa67430205b6049aa70bad4682a7442b8">More...</a><br /></td></tr>
<tr class="separator:aa67430205b6049aa70bad4682a7442b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a735bf6535f62b5907ea2d5f0e1abf3c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a735bf6535f62b5907ea2d5f0e1abf3c7">connectionReceiveFromCGI</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int activeFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a735bf6535f62b5907ea2d5f0e1abf3c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles receiving data from a CGI script and processes it accordingly.  <a href="_server_8cpp.html#a735bf6535f62b5907ea2d5f0e1abf3c7">More...</a><br /></td></tr>
<tr class="separator:a735bf6535f62b5907ea2d5f0e1abf3c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b6964fe44b1605c00c0f211a7f42896"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a9b6964fe44b1605c00c0f211a7f42896">connectionBuildResponse</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int activeFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a9b6964fe44b1605c00c0f211a7f42896"><td class="mdescLeft">&#160;</td><td class="mdescRight">Builds the response for a client connection.  <a href="_server_8cpp.html#a9b6964fe44b1605c00c0f211a7f42896">More...</a><br /></td></tr>
<tr class="separator:a9b6964fe44b1605c00c0f211a7f42896"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43e9e764c97aacfc12f233b33ffa3342"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a43e9e764c97aacfc12f233b33ffa3342">connectionSendResponse</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int activeFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:a43e9e764c97aacfc12f233b33ffa3342"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the response to a client connection.  <a href="_server_8cpp.html#a43e9e764c97aacfc12f233b33ffa3342">More...</a><br /></td></tr>
<tr class="separator:a43e9e764c97aacfc12f233b33ffa3342"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad132a77471376bd48681070a795df914"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#ad132a77471376bd48681070a795df914">connectionHandleTimeout</a> (<a class="el" href="class_server.html">Server</a> &amp;server, int activeFd, <a class="el" href="struct_connection.html">Connection</a> &amp;connection)</td></tr>
<tr class="memdesc:ad132a77471376bd48681070a795df914"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles a timeout for a client connection.  <a href="_server_8cpp.html#ad132a77471376bd48681070a795df914">More...</a><br /></td></tr>
<tr class="separator:ad132a77471376bd48681070a795df914"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28fd29ec48bd9459c678980cfccca4cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf">checkForTimeout</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:a28fd29ec48bd9459c678980cfccca4cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterates through all connections and checks if any have timed out.  <a href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf">More...</a><br /></td></tr>
<tr class="separator:a28fd29ec48bd9459c678980cfccca4cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e2693ba11e20b84de090bcdd0b665db"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">cleanupClosedConnections</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:a9e2693ba11e20b84de090bcdd0b665db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterates through all connections and removes closed ones.  <a href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">More...</a><br /></td></tr>
<tr class="separator:a9e2693ba11e20b84de090bcdd0b665db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2feae308a0fa968c84525fcdfb19251"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#af2feae308a0fa968c84525fcdfb19251">cleanupIdleConnections</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:af2feae308a0fa968c84525fcdfb19251"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterates through all connections, closes and removes idle ones.  <a href="_server_8cpp.html#af2feae308a0fa968c84525fcdfb19251">More...</a><br /></td></tr>
<tr class="separator:af2feae308a0fa968c84525fcdfb19251"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a115ecd76e344c1007bedc48b9bbdc0fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_server_8cpp.html#a115ecd76e344c1007bedc48b9bbdc0fa">shutdownServer</a> (<a class="el" href="class_server.html">Server</a> &amp;server)</td></tr>
<tr class="memdesc:a115ecd76e344c1007bedc48b9bbdc0fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs a graceful shutdown of the server.  <a href="_server_8cpp.html#a115ecd76e344c1007bedc48b9bbdc0fa">More...</a><br /></td></tr>
<tr class="separator:a115ecd76e344c1007bedc48b9bbdc0fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a35359f61d42dbd6561a07c12009ca45a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35359f61d42dbd6561a07c12009ca45a">&#9670;&nbsp;</a></span>initVirtualServers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool initVirtualServers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>backlog</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="struct_config_server.html">ConfigServer</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>serverConfigs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize virtual servers. </p>
<p>First initializes all wildcard servers (0.0.0.0) in the configuration file by opening a socket for them. They need to be initialized first because any already initialized socket on the same port would block the wildcard server. Then initializes the remaining virtual servers. It checks for duplicate servers using <a class="el" href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6" title="Check for duplicate virtual servers.">isDuplicateServer()</a> and skips opening the socket server if it already exists.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to initialize virtual servers for. </td></tr>
    <tr><td class="paramname">backlog</td><td>The maximum length to which the queue of pending connections for the virtual server may grow. </td></tr>
    <tr><td class="paramname">serverConfigs</td><td>The vector of server configurations from the configuration file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if at least one virtual server was added, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00523">523</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;{</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Initializing virtual servers&quot;</span>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Check for wildcard servers&quot;</span>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keyword">const</span> std::string wildcard = <span class="stringliteral">&quot;0.0.0.0&quot;</span>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">for</span> (std::vector&lt;ConfigServer&gt;::const_iterator iter = serverConfigs.begin(); iter != serverConfigs.end(); ++iter) {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;host == wildcard) {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Adding virtual server: &quot;</span> &lt;&lt; iter-&gt;host &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; iter-&gt;port;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">isDuplicateServer</a>(server, iter-&gt;host, iter-&gt;port))</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">createVirtualServer</a>(server, iter-&gt;host, backlog, iter-&gt;port))</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Failed to add virtual server: &quot;</span> &lt;&lt; iter-&gt;host &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; iter-&gt;port;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Add remaining virtual servers&quot;</span>;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">for</span> (std::vector&lt;ConfigServer&gt;::const_iterator iter = serverConfigs.begin(); iter != serverConfigs.end(); ++iter) {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Adding virtual server: &quot;</span> &lt;&lt; iter-&gt;host &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; iter-&gt;port;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">isDuplicateServer</a>(server, iter-&gt;host, iter-&gt;port))</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">createVirtualServer</a>(server, iter-&gt;host, backlog, iter-&gt;port))</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Failed to add virtual server: &quot;</span> &lt;&lt; iter-&gt;serverName;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">if</span> (server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().empty())</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Finished setting up virtual servers&quot;</span>;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;}</div>
<div class="ttc" id="a_log_8hpp_html_a6ff63e8955665c4a58b1598f2b07c51a"><div class="ttname"><a href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a></div><div class="ttdeci">#define LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="_log_8hpp_source.html#l00010">Log.hpp:10</a></div></div>
<div class="ttc" id="a_log_8hpp_html_aeb4f36db01bd128c7afeac5889dac311"><div class="ttname"><a href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a></div><div class="ttdeci">#define LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="_log_8hpp_source.html#l00011">Log.hpp:11</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a4f6456b9a16154a6d320ae8b370285d6"><div class="ttname"><a href="_server_8cpp.html#a4f6456b9a16154a6d320ae8b370285d6">isDuplicateServer</a></div><div class="ttdeci">bool isDuplicateServer(const Server &amp;server, const std::string &amp;host, const std::string &amp;port)</div><div class="ttdoc">Check for duplicate virtual servers.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00576">Server.cpp:576</a></div></div>
<div class="ttc" id="a_server_8cpp_html_aa6ca6a0179cbb661c05aa6b2758f5389"><div class="ttname"><a href="_server_8cpp.html#aa6ca6a0179cbb661c05aa6b2758f5389">createVirtualServer</a></div><div class="ttdeci">bool createVirtualServer(Server &amp;server, const std::string &amp;host, int backlog, const std::string &amp;port)</div><div class="ttdoc">Creates a new virtual server and registers it with the server object.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00619">Server.cpp:619</a></div></div>
<div class="ttc" id="aclass_server_html_a878b0cc2f9bc228dd12b250d95d61a75"><div class="ttname"><a href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">Server::getVirtualServers</a></div><div class="ttdeci">const std::map&lt; int, Socket &gt; &amp; getVirtualServers() const</div><div class="ttdoc">Const Getter for virtual servers.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00079">Server.cpp:79</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a35359f61d42dbd6561a07c12009ca45a_cgraph.svg" width="100%" height="504"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a35359f61d42dbd6561a07c12009ca45a_icgraph.svg" width="263" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a4f6456b9a16154a6d320ae8b370285d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f6456b9a16154a6d320ae8b370285d6">&#9670;&nbsp;</a></span>isDuplicateServer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isDuplicateServer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check for duplicate virtual servers. </p>
<p>Checks if a virtual server with the provided host and port already exists in the virtual servers map. If the host is "localhost", it checks for a virtual server with the host address "127.0.0.1" or "::1". If the existing server is a wildcard server (0.0.0.0) only the port needs to match.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to check for duplicate virtual servers. </td></tr>
    <tr><td class="paramname">host</td><td>The host address of the virtual server. </td></tr>
    <tr><td class="paramname">port</td><td>The port number of the virtual server.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if a duplicate virtual server exists, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00576">576</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;{</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keyword">const</span> std::string wildcard = <span class="stringliteral">&quot;0.0.0.0&quot;</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">if</span> (host == <span class="stringliteral">&quot;localhost&quot;</span>) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keywordflow">for</span> (std::map&lt;int, Socket&gt;::const_iterator iter = server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().begin();</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;             iter != server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().end(); ++iter) {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="keywordflow">if</span> ((iter-&gt;second.host == wildcard || iter-&gt;second.host == <span class="stringliteral">&quot;127.0.0.1&quot;</span> || iter-&gt;second.host == <span class="stringliteral">&quot;::1&quot;</span>)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                &amp;&amp; iter-&gt;second.port == port) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Virtual server already exists: &quot;</span> &lt;&lt; iter-&gt;second;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="keywordflow">for</span> (std::map&lt;int, Socket&gt;::const_iterator iter = server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().begin();</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;             iter != server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().end(); ++iter) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            <span class="keywordflow">if</span> ((iter-&gt;second.host == wildcard || iter-&gt;second.host == host) &amp;&amp; iter-&gt;second.port == port) {</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Virtual server already exists: &quot;</span> &lt;&lt; iter-&gt;second;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a4f6456b9a16154a6d320ae8b370285d6_cgraph.svg" width="382" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a4f6456b9a16154a6d320ae8b370285d6_icgraph.svg" width="448" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aa6ca6a0179cbb661c05aa6b2758f5389"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6ca6a0179cbb661c05aa6b2758f5389">&#9670;&nbsp;</a></span>createVirtualServer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool createVirtualServer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>backlog</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a new virtual server and registers it with the server object. </p>
<p>Creates a listening socket for a virtual server using the provided host, port, and backlog and adds it to the virtual servers map. Uses <a class="el" href="class_server.html#abf1dc68ec7f88650ad80e93f56e14e5c" title="Wrapper function to SocketPolicy::resolveListeningAddresses.">Server::resolveListeningAddresses()</a> to get a list of address information for the provided host and port. It then tries to create a listening socket for each value in the list using <a class="el" href="class_server.html#a4e98a13498a791a2f3639e67e5b849e0" title="Wrapper function to SocketPolicy::createListeningSocket.">Server::createListeningSocket()</a>. If succesful calls <a class="el" href="class_server.html#ae4900f55d072ebbe26a92c14b17de396" title="Wrapper function to SocketPolicy::retrieveSocketInfo.">Server::retrieveSocketInfo()</a> and registers the virtual server using <a class="el" href="class_server.html#aae8cc5a8fc07a6ce97d468d94cd08a6e" title="Register a virtual server.">Server::registerVirtualServer()</a>. If any step fails, it continues to the next value in the list. After the loop, the created address list is freed. If no valid socket was created, it logs an error and returns false.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to add the virtual server to. </td></tr>
    <tr><td class="paramname">host</td><td>host address for the virtual server. </td></tr>
    <tr><td class="paramname">backlog</td><td>maximum length to which the queue of pending connections for the virtual server may grow. </td></tr>
    <tr><td class="paramname">port</td><td>port number for the virtual server.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the virtual server was successfully added, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00619">619</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;{</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keyword">struct </span>addrinfo* list = server.<a class="code" href="class_server.html#abf1dc68ec7f88650ad80e93f56e14e5c">resolveListeningAddresses</a>(host, port);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">if</span> (list == NULL)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordtype">size_t</span> successfulSock = 0;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordtype">size_t</span> countTryCreateSocket = 1;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">struct</span> addrinfo* curr = list; curr != NULL; curr = curr-&gt;ai_next) {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; countTryCreateSocket &lt;&lt; <span class="stringliteral">&quot;. try to create listening socket&quot;</span>;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> newFd = server.<a class="code" href="class_server.html#a4e98a13498a791a2f3639e67e5b849e0">createListeningSocket</a>(curr, backlog);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="keywordflow">if</span> (newFd == -1)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keyword">const</span> <a class="code" href="struct_socket.html">Socket</a> serverSock = server.<a class="code" href="class_server.html#ae4900f55d072ebbe26a92c14b17de396">retrieveSocketInfo</a>(curr-&gt;ai_addr);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">if</span> (serverSock.<a class="code" href="struct_socket.html#a986f7cf6e2d3334e9ad91a35681c1f80">host</a>.empty() &amp;&amp; serverSock.<a class="code" href="struct_socket.html#af75711bf9c0f0788d7767f836a97c5e6">port</a>.empty()) {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            close(newFd);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <span class="keywordflow">if</span> (!server.<a class="code" href="class_server.html#aae8cc5a8fc07a6ce97d468d94cd08a6e">registerVirtualServer</a>(newFd, serverSock))</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        ++successfulSock;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    freeaddrinfo(list);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">if</span> (successfulSock == 0) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Cannot bind to a valid socket.&quot;</span>;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;}</div>
<div class="ttc" id="a_log_8hpp_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="_log_8hpp_source.html#l00013">Log.hpp:13</a></div></div>
<div class="ttc" id="aclass_server_html_a4e98a13498a791a2f3639e67e5b849e0"><div class="ttname"><a href="class_server.html#a4e98a13498a791a2f3639e67e5b849e0">Server::createListeningSocket</a></div><div class="ttdeci">int createListeningSocket(const struct addrinfo *addrinfo, int backlog) const</div><div class="ttdoc">Wrapper function to SocketPolicy::createListeningSocket.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00338">Server.cpp:338</a></div></div>
<div class="ttc" id="aclass_server_html_aae8cc5a8fc07a6ce97d468d94cd08a6e"><div class="ttname"><a href="class_server.html#aae8cc5a8fc07a6ce97d468d94cd08a6e">Server::registerVirtualServer</a></div><div class="ttdeci">bool registerVirtualServer(int serverFd, const Socket &amp;serverSock)</div><div class="ttdoc">Register a virtual server.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00153">Server.cpp:153</a></div></div>
<div class="ttc" id="aclass_server_html_abf1dc68ec7f88650ad80e93f56e14e5c"><div class="ttname"><a href="class_server.html#abf1dc68ec7f88650ad80e93f56e14e5c">Server::resolveListeningAddresses</a></div><div class="ttdeci">struct addrinfo * resolveListeningAddresses(const std::string &amp;host, const std::string &amp;port) const</div><div class="ttdoc">Wrapper function to SocketPolicy::resolveListeningAddresses.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00326">Server.cpp:326</a></div></div>
<div class="ttc" id="aclass_server_html_ae4900f55d072ebbe26a92c14b17de396"><div class="ttname"><a href="class_server.html#ae4900f55d072ebbe26a92c14b17de396">Server::retrieveSocketInfo</a></div><div class="ttdeci">Socket retrieveSocketInfo(struct sockaddr *sockaddr) const</div><div class="ttdoc">Wrapper function to SocketPolicy::retrieveSocketInfo.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00351">Server.cpp:351</a></div></div>
<div class="ttc" id="astruct_socket_html"><div class="ttname"><a href="struct_socket.html">Socket</a></div><div class="ttdoc">Represent a socket connection.</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8hpp_source.html#l00008">Socket.hpp:8</a></div></div>
<div class="ttc" id="astruct_socket_html_a986f7cf6e2d3334e9ad91a35681c1f80"><div class="ttname"><a href="struct_socket.html#a986f7cf6e2d3334e9ad91a35681c1f80">Socket::host</a></div><div class="ttdeci">std::string host</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8hpp_source.html#l00009">Socket.hpp:9</a></div></div>
<div class="ttc" id="astruct_socket_html_af75711bf9c0f0788d7767f836a97c5e6"><div class="ttname"><a href="struct_socket.html#af75711bf9c0f0788d7767f836a97c5e6">Socket::port</a></div><div class="ttdeci">std::string port</div><div class="ttdef"><b>Definition:</b> <a href="_socket_8hpp_source.html#l00010">Socket.hpp:10</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_aa6ca6a0179cbb661c05aa6b2758f5389_cgraph.svg" width="100%" height="466"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_aa6ca6a0179cbb661c05aa6b2758f5389_icgraph.svg" width="459" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab66b27c2186daacb15a6b13dd43be31b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab66b27c2186daacb15a6b13dd43be31b">&#9670;&nbsp;</a></span>runServer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void runServer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Runs the main event loop with a server object. </p>
<p>This functions enters a continuous loop to handle incoming events == connections. It waits for events with the <a class="el" href="class_epoll_wrapper.html" title="Wrapper class for epoll instance.">EpollWrapper</a>. If a vector of events is returned it processes all of them via <a class="el" href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4" title="Accepts new connections or handles existing ones.">handleEvent()</a>. When events are processed or the server.waitForEvents() timeout happens checks for connection timeouts with <a class="el" href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf" title="Iterates through all connections and checks if any have timed out.">checkForTimeout()</a>. Then cleans up closed connections with <a class="el" href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db" title="Iterates through all connections and removes closed ones.">cleanupClosedConnections()</a>. The loop continues until a signal is received and saved in g_SignalStatus. It then logs the signal. If the signal is SIGQUIT it performs a graceful shutdown with <a class="el" href="_server_8cpp.html#a115ecd76e344c1007bedc48b9bbdc0fa" title="Performs a graceful shutdown of the server.">shutdownServer()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to run the event loop for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">std::runtime_error</td><td>if waitForEvents() encounters an error. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00671">671</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;{</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Server started&quot;</span>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a> == 0) {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> nfds = server.<a class="code" href="class_server.html#acbcbebe2c30446acc9a90f40f9986b62">waitForEvents</a>();</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordflow">for</span> (std::vector&lt;struct epoll_event&gt;::const_iterator iter = server.<a class="code" href="class_server.html#a1768b6e65ed7b3205141698ca459ffd8">eventsBegin</a>();</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;             iter != server.<a class="code" href="class_server.html#a1768b6e65ed7b3205141698ca459ffd8">eventsBegin</a>() + nfds; ++iter) {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            <a class="code" href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4">handleEvent</a>(server, *iter);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <a class="code" href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf">checkForTimeout</a>(server);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <a class="code" href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">cleanupClosedConnections</a>(server);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Received signal &quot;</span> &lt;&lt; <a class="code" href="signal_handler_8hpp.html#adc4193659d5893030190dca46c276ac7">signalNumToName</a>(<a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a>);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a> == SIGQUIT)</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <a class="code" href="_server_8cpp.html#a115ecd76e344c1007bedc48b9bbdc0fa">shutdownServer</a>(server);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a115ecd76e344c1007bedc48b9bbdc0fa"><div class="ttname"><a href="_server_8cpp.html#a115ecd76e344c1007bedc48b9bbdc0fa">shutdownServer</a></div><div class="ttdeci">void shutdownServer(Server &amp;server)</div><div class="ttdoc">Performs a graceful shutdown of the server.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01479">Server.cpp:1479</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a28fd29ec48bd9459c678980cfccca4cf"><div class="ttname"><a href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf">checkForTimeout</a></div><div class="ttdeci">void checkForTimeout(Server &amp;server)</div><div class="ttdoc">Iterates through all connections and checks if any have timed out.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01405">Server.cpp:1405</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a9e2693ba11e20b84de090bcdd0b665db"><div class="ttname"><a href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">cleanupClosedConnections</a></div><div class="ttdeci">void cleanupClosedConnections(Server &amp;server)</div><div class="ttdoc">Iterates through all connections and removes closed ones.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01432">Server.cpp:1432</a></div></div>
<div class="ttc" id="a_server_8cpp_html_af9f4479a6262c17deef89938118d27f4"><div class="ttname"><a href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4">handleEvent</a></div><div class="ttdeci">void handleEvent(Server &amp;server, struct epoll_event event)</div><div class="ttdoc">Accepts new connections or handles existing ones.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00712">Server.cpp:712</a></div></div>
<div class="ttc" id="aclass_server_html_a1768b6e65ed7b3205141698ca459ffd8"><div class="ttname"><a href="class_server.html#a1768b6e65ed7b3205141698ca459ffd8">Server::eventsBegin</a></div><div class="ttdeci">std::vector&lt; struct epoll_event &gt;::const_iterator eventsBegin() const</div><div class="ttdoc">Wrapper function to EpollWrapper::eventsBegin.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00283">Server.cpp:283</a></div></div>
<div class="ttc" id="aclass_server_html_acbcbebe2c30446acc9a90f40f9986b62"><div class="ttname"><a href="class_server.html#acbcbebe2c30446acc9a90f40f9986b62">Server::waitForEvents</a></div><div class="ttdeci">int waitForEvents()</div><div class="ttdoc">Wrapper function to EpollWrapper::waitForEvents.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00276">Server.cpp:276</a></div></div>
<div class="ttc" id="asignal_handler_8hpp_html_a8dcc1e48e0bf890094e11efb58edafa1"><div class="ttname"><a href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a></div><div class="ttdeci">volatile std::sig_atomic_t g_signalStatus</div><div class="ttdef"><b>Definition:</b> <a href="signal_handler_8cpp_source.html#l00005">signalHandler.cpp:5</a></div></div>
<div class="ttc" id="asignal_handler_8hpp_html_adc4193659d5893030190dca46c276ac7"><div class="ttname"><a href="signal_handler_8hpp.html#adc4193659d5893030190dca46c276ac7">signalNumToName</a></div><div class="ttdeci">std::string signalNumToName(int signum)</div><div class="ttdoc">Converts a signal number to its name.</div><div class="ttdef"><b>Definition:</b> <a href="signal_handler_8cpp_source.html#l00020">signalHandler.cpp:20</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_ab66b27c2186daacb15a6b13dd43be31b_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_ab66b27c2186daacb15a6b13dd43be31b_icgraph.svg" width="199" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="af9f4479a6262c17deef89938118d27f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9f4479a6262c17deef89938118d27f4">&#9670;&nbsp;</a></span>handleEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleEvent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct epoll_event&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accepts new connections or handles existing ones. </p>
<p>This function acts as a general dispatcher for handling events. Checks if the event file descriptor is in the virtual servers map. If it is, it calls <a class="el" href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18" title="Accept new connections.">acceptConnections()</a>. If the event mask contains EPOLLERR, it logs an error and closes the virtual server.</p>
<p>If the event file descriptor is in the CGI connections map, it calls <a class="el" href="_server_8cpp.html#afb62203471d9a64b23d0267d5a4a261a" title="Handle a client connection.">handleConnection()</a> with the associated referenced connection.</p>
<p>Otherwise, it calls <a class="el" href="_server_8cpp.html#afb62203471d9a64b23d0267d5a4a261a" title="Handle a client connection.">handleConnection()</a> with the associated connection from the connections map. If the event mask contains EPOLLERR or EPOLLHUP, the event mask is set to EPOLLIN. This is done to handle errors and hangups that may occur during the processing of the connection. The <a class="el" href="class_server.html" title="Main class of the HTTP server.">Server</a> could then try to recv(), which will return 0 in case of EPOLLHUP or -1 in case of EPOLLERR, resulting in a connection close. </p><dl class="section see"><dt>See also</dt><dd><a href="https://stackoverflow.com/a/29206631">https://stackoverflow.com/a/29206631</a></dd></dl>
<p>A connection should exist in the connections map, therefore it is not checked if the file descriptor is in the connections map.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>The epoll event to handle. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00712">712</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;{</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    uint32_t eventMask = <span class="keyword">event</span>.events;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    std::map&lt;int, Socket&gt;::const_iterator iter = server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().find(event.data.fd);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    std::map&lt;int, Connection*&gt;::iterator cgiIter = server.<a class="code" href="class_server.html#aad2be3b48155c6eb508bca4b1af3db97">getCGIConnections</a>().find(event.data.fd);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">if</span> (iter != server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().end()) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">if</span> ((eventMask &amp; EPOLLERR) != 0) {</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Error condition happened on the associated file descriptor of &quot;</span> &lt;&lt; iter-&gt;second;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            close(event.data.fd);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        }</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <a class="code" href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18">acceptConnections</a>(server, iter-&gt;first, iter-&gt;second, eventMask);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cgiIter != server.<a class="code" href="class_server.html#aad2be3b48155c6eb508bca4b1af3db97">getCGIConnections</a>().end()) {</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <a class="code" href="_server_8cpp.html#afb62203471d9a64b23d0267d5a4a261a">handleConnection</a>(server, cgiIter-&gt;first, *cgiIter-&gt;second);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="keywordflow">if</span> ((eventMask &amp; EPOLLERR) != 0) {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;epoll_wait: EPOLLERR&quot;</span>;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            eventMask = EPOLLIN;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((eventMask &amp; EPOLLHUP) != 0) {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;epoll_wait: EPOLLHUP&quot;</span>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            eventMask = EPOLLIN;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        }</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <a class="code" href="_server_8cpp.html#afb62203471d9a64b23d0267d5a4a261a">handleConnection</a>(server, event.data.fd, server.<a class="code" href="class_server.html#a1f8929bed093f869374cb81da4d97505">getConnections</a>().at(event.data.fd));</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    }</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_adb579f3d67061d752e882e6fb3ef6f18"><div class="ttname"><a href="_server_8cpp.html#adb579f3d67061d752e882e6fb3ef6f18">acceptConnections</a></div><div class="ttdeci">void acceptConnections(Server &amp;server, int serverFd, const Socket &amp;serverSock, uint32_t eventMask)</div><div class="ttdoc">Accept new connections.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00760">Server.cpp:760</a></div></div>
<div class="ttc" id="a_server_8cpp_html_afb62203471d9a64b23d0267d5a4a261a"><div class="ttname"><a href="_server_8cpp.html#afb62203471d9a64b23d0267d5a4a261a">handleConnection</a></div><div class="ttdeci">void handleConnection(Server &amp;server, const int activeFd, Connection &amp;connection)</div><div class="ttdoc">Handle a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00833">Server.cpp:833</a></div></div>
<div class="ttc" id="aclass_server_html_a1f8929bed093f869374cb81da4d97505"><div class="ttname"><a href="class_server.html#a1f8929bed093f869374cb81da4d97505">Server::getConnections</a></div><div class="ttdeci">const std::map&lt; int, Connection &gt; &amp; getConnections() const</div><div class="ttdoc">Const Getter for connections.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00100">Server.cpp:100</a></div></div>
<div class="ttc" id="aclass_server_html_aad2be3b48155c6eb508bca4b1af3db97"><div class="ttname"><a href="class_server.html#aad2be3b48155c6eb508bca4b1af3db97">Server::getCGIConnections</a></div><div class="ttdeci">std::map&lt; int, Connection * &gt; &amp; getCGIConnections()</div><div class="ttdoc">Getter for cgiConnections.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00093">Server.cpp:93</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_af9f4479a6262c17deef89938118d27f4_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_af9f4479a6262c17deef89938118d27f4_icgraph.svg" width="524" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="adb579f3d67061d752e882e6fb3ef6f18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb579f3d67061d752e882e6fb3ef6f18">&#9670;&nbsp;</a></span>acceptConnections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void acceptConnections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>serverFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_socket.html">Socket</a> &amp;&#160;</td>
          <td class="paramname"><em>serverSock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>eventMask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accept new connections. </p>
<p>If the event mask does not contain <code>EPOLLIN</code>, it logs an error and returns. A server socket should always receive a read event.</p>
<p>In a loop, calls <a class="el" href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865" title="Wrapper function to SocketPolicy::acceptSingleConnection().">Server::acceptSingleConnection()</a> to accept new connections on the server socket. When <a class="el" href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865" title="Wrapper function to SocketPolicy::acceptSingleConnection().">Server::acceptSingleConnection()</a> is successful, information of the client socket is retrieved with <a class="el" href="class_server.html#ae4900f55d072ebbe26a92c14b17de396" title="Wrapper function to SocketPolicy::retrieveSocketInfo.">Server::retrieveSocketInfo()</a>. This new client socket is then registered with <a class="el" href="class_server.html#ac145e9f668db85b10a66829bd2677746" title="Register a connection.">Server::registerConnection()</a>.</p>
<p>The while-loop allows for multiple connections to be accepted in one call of this function. It is broken when accept() sets errno to EAGAIN or EWOULDBLOCK (equivalent error codes indicating that a non-blocking operation would normally block), meaning that no more connections are pending. If another errno is returned logs an error and continues to the next iteration of the loop. This is because the server sockets are in EPOLLET mode. If only one connection would be accepted the same server fd would not be reported again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to accept connections for. </td></tr>
    <tr><td class="paramname">serverFd</td><td>File descriptor of the server socket. </td></tr>
    <tr><td class="paramname">serverSock</td><td><a class="el" href="class_server.html" title="Main class of the HTTP server.">Server</a> socket which reported an event. </td></tr>
    <tr><td class="paramname">eventMask</td><td>Event mask of the reported event. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00760">760</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;{</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Accept connections on: &quot;</span> &lt;&lt; serverSock;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">if</span> ((eventMask &amp; EPOLLIN) == 0) {</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Received unknown event:&quot;</span> &lt;&lt; eventMask;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> isWildcardServer = (serverSock.host == <span class="stringliteral">&quot;0.0.0.0&quot;</span>);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="keyword">struct </span>sockaddr_storage clientAddr = {};</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        socklen_t clientLen = <span class="keyword">sizeof</span>(clientAddr);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160; </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="comment">// NOLINTNEXTLINE: we need to use reinterpret_cast to convert sockaddr_storage to sockaddr</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keyword">struct </span>sockaddr* addrCast = <span class="keyword">reinterpret_cast&lt;</span>struct sockaddr*<span class="keyword">&gt;</span>(&amp;clientAddr);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160; </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> clientFd = server.<a class="code" href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865">acceptSingleConnection</a>(serverFd, addrCast, &amp;clientLen);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">if</span> (clientFd == -2)</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="keywordflow">return</span>; <span class="comment">// No more pending connections</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <span class="keywordflow">if</span> (clientFd == -1)</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <span class="keywordflow">continue</span>; <span class="comment">// Error accepting connection</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; </div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keyword">const</span> <a class="code" href="struct_socket.html">Socket</a> clientSock = server.<a class="code" href="class_server.html#ae4900f55d072ebbe26a92c14b17de396">retrieveSocketInfo</a>(addrCast);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="keywordflow">if</span> (clientSock.<a class="code" href="struct_socket.html#a986f7cf6e2d3334e9ad91a35681c1f80">host</a>.empty() &amp;&amp; clientSock.<a class="code" href="struct_socket.html#af75711bf9c0f0788d7767f836a97c5e6">port</a>.empty()) {</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            close(clientFd);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="keyword">const</span> <a class="code" href="struct_socket.html">Socket</a> boundSock = isWildcardServer ? server.<a class="code" href="class_server.html#a65c2f3dc363bdb70a98895686826e5e8">retrieveBoundSocketInfo</a>(clientFd) : serverSock;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="keywordflow">if</span> (boundSock.<a class="code" href="struct_socket.html#a986f7cf6e2d3334e9ad91a35681c1f80">host</a>.empty() &amp;&amp; boundSock.<a class="code" href="struct_socket.html#af75711bf9c0f0788d7767f836a97c5e6">port</a>.empty()) {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            close(clientFd);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordflow">if</span> (!server.<a class="code" href="class_server.html#ac145e9f668db85b10a66829bd2677746">registerConnection</a>(boundSock, clientFd, clientSock))</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;}</div>
<div class="ttc" id="aclass_server_html_a65c2f3dc363bdb70a98895686826e5e8"><div class="ttname"><a href="class_server.html#a65c2f3dc363bdb70a98895686826e5e8">Server::retrieveBoundSocketInfo</a></div><div class="ttdeci">Socket retrieveBoundSocketInfo(int sockfd) const</div><div class="ttdoc">Wrapper function to SocketPolicy::retrieveBoundSocketInfo.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00364">Server.cpp:364</a></div></div>
<div class="ttc" id="aclass_server_html_ac145e9f668db85b10a66829bd2677746"><div class="ttname"><a href="class_server.html#ac145e9f668db85b10a66829bd2677746">Server::registerConnection</a></div><div class="ttdeci">bool registerConnection(const Socket &amp;serverSock, int clientFd, const Socket &amp;clientSock)</div><div class="ttdoc">Register a connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00181">Server.cpp:181</a></div></div>
<div class="ttc" id="aclass_server_html_ad8823ad2d9c9a94cfafb40e8e0653865"><div class="ttname"><a href="class_server.html#ad8823ad2d9c9a94cfafb40e8e0653865">Server::acceptSingleConnection</a></div><div class="ttdeci">int acceptSingleConnection(int sockfd, struct sockaddr *addr, socklen_t *addrlen) const</div><div class="ttdoc">Wrapper function to SocketPolicy::acceptSingleConnection().</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00374">Server.cpp:374</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_adb579f3d67061d752e882e6fb3ef6f18_cgraph.svg" width="100%" height="466"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_adb579f3d67061d752e882e6fb3ef6f18_icgraph.svg" width="100%" height="385"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="afb62203471d9a64b23d0267d5a4a261a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb62203471d9a64b23d0267d5a4a261a">&#9670;&nbsp;</a></span>handleConnection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleConnection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>activeFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle a client connection. </p>
<p>After epoll reports an event on a client socket, this function is called to handle the connection. The event from the client can either be incoming (EPOLLIN) or outgoing (EPOLLOUT). This function dispatches to the correct subfunction depending on the connection state:</p><ol type="1">
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a69ce01d1521944754fb16d9d2e59186c">Connection::Idle</a> (in): every new connection starts in this state after it connects. Also if the connection is kept alive, it is in this state. When the client wants to send a request it changes the state to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a>.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a> (in): when the connection wants to send a request. <a class="el" href="_server_8cpp.html#aa45d6529fd7be9b7adf788a9679ae34b" title="Receive request header from a client.">connectionReceiveHeader()</a> reads the request header from the client and parses it. If the request header is complete, it changes the state to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a>, <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a517f78d58ea061e41bb21d4afc53d638">Connection::ReceiveFromCGI</a> or <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>.</li>
</ol>
<ol type="1">
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a> (in): if the request header indicates a body, <a class="el" href="_server_8cpp.html#a3e07b970ffa58c9315b38673aff94f84" title="Handles the reception of the request body from a client connection.">connectionReceiveBody()</a> reads the body from the client. If the body is complete, it changes the state to either <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ae4dc47b21ee9ccbf06de49701c65e548">Connection::SendToCGI</a> or <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ae4dc47b21ee9ccbf06de49701c65e548">Connection::SendToCGI</a> (out): no action is taken to send data to the CGI process in this function.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a517f78d58ea061e41bb21d4afc53d638">Connection::ReceiveFromCGI</a> (in): no action is taken to receive data from the CGI process in this function.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a> (out): after a complete request (header and optional body) and optionally the body generated by a CGI process is received <a class="el" href="_server_8cpp.html#a9b6964fe44b1605c00c0f211a7f42896" title="Builds the response for a client connection.">connectionBuildResponse()</a> builds the response for the client. It then changes the state to <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a> and also calls <a class="el" href="_server_8cpp.html#a43e9e764c97aacfc12f233b33ffa3342" title="Sends the response to a client connection.">connectionSendResponse()</a> to try to immediatly send the response to the client.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a> (out): <a class="el" href="_server_8cpp.html#a43e9e764c97aacfc12f233b33ffa3342" title="Sends the response to a client connection.">connectionSendResponse()</a> sends the response to the client. This dispatch happens only if the response is not completely sent the first time.</li>
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a> (out): if the connection has timed out, <a class="el" href="_server_8cpp.html#ad132a77471376bd48681070a795df914" title="Handles a timeout for a client connection.">connectionHandleTimeout()</a> sets the request status to timeout. Then it calls <a class="el" href="_server_8cpp.html#a9b6964fe44b1605c00c0f211a7f42896" title="Builds the response for a client connection.">connectionBuildResponse()</a> to build the error message, which then gets sent with <a class="el" href="_server_8cpp.html#a43e9e764c97aacfc12f233b33ffa3342" title="Sends the response to a client connection.">connectionSendResponse()</a>.</li>
</ol>
<ol type="1">
<li><a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a> (not reached): the connection is closed and can be cleaned. This case should not be reached.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to handle the connection for. </td></tr>
    <tr><td class="paramname">activeFd</td><td>The file descriptor being handled. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to handle. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00833">833</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;{</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Handling connection: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a> &lt;&lt; <span class="stringliteral">&quot; on fd: &quot;</span> &lt;&lt; activeFd</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; for server: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#ae9c64be721ccc3676197f3ebbb58fe18">m_serverSocket</a>;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">switch</span> (connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a>) {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a69ce01d1521944754fb16d9d2e59186c">Connection::Idle</a>):</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a>;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <a class="code" href="_server_8cpp.html#aa45d6529fd7be9b7adf788a9679ae34b">connectionReceiveHeader</a>(server, activeFd, connection);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a>):</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <a class="code" href="_server_8cpp.html#aa45d6529fd7be9b7adf788a9679ae34b">connectionReceiveHeader</a>(server, activeFd, connection);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a>):</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <a class="code" href="_server_8cpp.html#a3e07b970ffa58c9315b38673aff94f84">connectionReceiveBody</a>(server, activeFd, connection);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ae4dc47b21ee9ccbf06de49701c65e548">Connection::SendToCGI</a>):</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <a class="code" href="_server_8cpp.html#aa67430205b6049aa70bad4682a7442b8">connectionSendToCGI</a>(server, activeFd, connection);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a517f78d58ea061e41bb21d4afc53d638">Connection::ReceiveFromCGI</a>):</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <a class="code" href="_server_8cpp.html#a735bf6535f62b5907ea2d5f0e1abf3c7">connectionReceiveFromCGI</a>(server, activeFd, connection);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>):</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <a class="code" href="_server_8cpp.html#a9b6964fe44b1605c00c0f211a7f42896">connectionBuildResponse</a>(server, activeFd, connection);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a>):</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <a class="code" href="_server_8cpp.html#a43e9e764c97aacfc12f233b33ffa3342">connectionSendResponse</a>(server, activeFd, connection);</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a>):</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <a class="code" href="_server_8cpp.html#ad132a77471376bd48681070a795df914">connectionHandleTimeout</a>(server, activeFd, connection);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>):</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    }</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a3e07b970ffa58c9315b38673aff94f84"><div class="ttname"><a href="_server_8cpp.html#a3e07b970ffa58c9315b38673aff94f84">connectionReceiveBody</a></div><div class="ttdeci">void connectionReceiveBody(Server &amp;server, int activeFd, Connection &amp;connection)</div><div class="ttdoc">Handles the reception of the request body from a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01075">Server.cpp:1075</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a43e9e764c97aacfc12f233b33ffa3342"><div class="ttname"><a href="_server_8cpp.html#a43e9e764c97aacfc12f233b33ffa3342">connectionSendResponse</a></div><div class="ttdeci">void connectionSendResponse(Server &amp;server, int activeFd, Connection &amp;connection)</div><div class="ttdoc">Sends the response to a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01340">Server.cpp:1340</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a735bf6535f62b5907ea2d5f0e1abf3c7"><div class="ttname"><a href="_server_8cpp.html#a735bf6535f62b5907ea2d5f0e1abf3c7">connectionReceiveFromCGI</a></div><div class="ttdeci">void connectionReceiveFromCGI(Server &amp;server, int activeFd, Connection &amp;connection)</div><div class="ttdoc">Handles receiving data from a CGI script and processes it accordingly.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01240">Server.cpp:1240</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a9b6964fe44b1605c00c0f211a7f42896"><div class="ttname"><a href="_server_8cpp.html#a9b6964fe44b1605c00c0f211a7f42896">connectionBuildResponse</a></div><div class="ttdeci">void connectionBuildResponse(Server &amp;server, int activeFd, Connection &amp;connection)</div><div class="ttdoc">Builds the response for a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01310">Server.cpp:1310</a></div></div>
<div class="ttc" id="a_server_8cpp_html_aa45d6529fd7be9b7adf788a9679ae34b"><div class="ttname"><a href="_server_8cpp.html#aa45d6529fd7be9b7adf788a9679ae34b">connectionReceiveHeader</a></div><div class="ttdeci">void connectionReceiveHeader(Server &amp;server, int activeFd, Connection &amp;connection)</div><div class="ttdoc">Receive request header from a client.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00890">Server.cpp:890</a></div></div>
<div class="ttc" id="a_server_8cpp_html_aa67430205b6049aa70bad4682a7442b8"><div class="ttname"><a href="_server_8cpp.html#aa67430205b6049aa70bad4682a7442b8">connectionSendToCGI</a></div><div class="ttdeci">void connectionSendToCGI(Server &amp;server, int activeFd, Connection &amp;connection)</div><div class="ttdoc">Sends the request body to the CGI process.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01187">Server.cpp:1187</a></div></div>
<div class="ttc" id="a_server_8cpp_html_ad132a77471376bd48681070a795df914"><div class="ttname"><a href="_server_8cpp.html#ad132a77471376bd48681070a795df914">connectionHandleTimeout</a></div><div class="ttdeci">void connectionHandleTimeout(Server &amp;server, int activeFd, Connection &amp;connection)</div><div class="ttdoc">Handles a timeout for a client connection.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01384">Server.cpp:1384</a></div></div>
<div class="ttc" id="astruct_connection_html_a244c1b9870181fb1c847758d21e2c8b3"><div class="ttname"><a href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">Connection::m_clientSocket</a></div><div class="ttdeci">Socket m_clientSocket</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00034">Connection.hpp:34</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a></div><div class="ttdeci">@ ReceiveBody</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00024">Connection.hpp:24</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a></div><div class="ttdeci">@ Closed</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00031">Connection.hpp:30</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a></div><div class="ttdeci">@ BuildResponse</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00027">Connection.hpp:27</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a517f78d58ea061e41bb21d4afc53d638"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a517f78d58ea061e41bb21d4afc53d638">Connection::ReceiveFromCGI</a></div><div class="ttdeci">@ ReceiveFromCGI</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00026">Connection.hpp:26</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a5aada94de3a51958f8b11699c9924fd4">Connection::ReceiveHeader</a></div><div class="ttdeci">@ ReceiveHeader</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00023">Connection.hpp:23</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7a69ce01d1521944754fb16d9d2e59186c"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a69ce01d1521944754fb16d9d2e59186c">Connection::Idle</a></div><div class="ttdeci">@ Idle</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00022">Connection.hpp:22</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a></div><div class="ttdeci">@ Timeout</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00029">Connection.hpp:29</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7ae4dc47b21ee9ccbf06de49701c65e548"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ae4dc47b21ee9ccbf06de49701c65e548">Connection::SendToCGI</a></div><div class="ttdeci">@ SendToCGI</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00025">Connection.hpp:25</a></div></div>
<div class="ttc" id="astruct_connection_html_a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7"><div class="ttname"><a href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a></div><div class="ttdeci">@ SendResponse</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00028">Connection.hpp:28</a></div></div>
<div class="ttc" id="astruct_connection_html_ae9c64be721ccc3676197f3ebbb58fe18"><div class="ttname"><a href="struct_connection.html#ae9c64be721ccc3676197f3ebbb58fe18">Connection::m_serverSocket</a></div><div class="ttdeci">Socket m_serverSocket</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00033">Connection.hpp:33</a></div></div>
<div class="ttc" id="astruct_connection_html_af433353beabb6990235b13b24c8b6bbe"><div class="ttname"><a href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">Connection::m_status</a></div><div class="ttdeci">ConnectionStatus m_status</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00037">Connection.hpp:37</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_afb62203471d9a64b23d0267d5a4a261a_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_afb62203471d9a64b23d0267d5a4a261a_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aa45d6529fd7be9b7adf788a9679ae34b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa45d6529fd7be9b7adf788a9679ae34b">&#9670;&nbsp;</a></span>connectionReceiveHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionReceiveHeader </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>activeFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive request header from a client. </p>
<p>This function reads data from the client socket using <a class="el" href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423" title="Wrapper function to SocketPolicy::readFromSocket.">Server::readFromSocket()</a>. The amount of bytes to read from the socket is determined by the bytes already received from the client. It can never be bigger than the buffer size.</p><ul>
<li>If bytes read is -1, it indicates an internal server error</li>
<li>If bytes read is 0, it indicates that the connection has been closed by the client In both cases the clientFd is closed and the connection status is set to Closed. If bytes read is greater than 0, the bytes received are added to the connection buffer and the bytes received of the connection are updated as well as time since the last event is updated to the current time. If the buffer contains a complete request header, the function <a class="el" href="_server_8cpp.html#a83350eae81b96dd7b301d1238268ffdb" title="Handles the complete request header received from a client.">handleCompleteRequestHeader()</a> is called. If no complete request was received and the received bytes match the buffer size, sets HTTP status code to 413 Request Header Fields Too Large and status to BuildResponse, since the request header was too big.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">activeFd</td><td>The file descriptor being handled. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to receive the request for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd><p class="startdd">Implement body handling. </p>
<p class="enddd">make clientHeaderBufferSize configurable. </p>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00890">890</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;{</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">if</span> (activeFd != connection.<a class="code" href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">m_clientFd</a>)</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Receive Request Header for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    std::vector&lt;char&gt;&amp; buffer = server.<a class="code" href="class_server.html#a45f1691489d81cdd6acc640d96d5046b">getClientHeaderBuffer</a>();</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keywordflow">if</span> (buffer.capacity() &lt; <a class="code" href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a>)</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        buffer.resize(<a class="code" href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a>);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    buffer.clear();</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> bytesToRead = <a class="code" href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a> - connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size();</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Bytes to read: &quot;</span> &lt;&lt; bytesToRead;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keyword">const</span> ssize_t bytesRead = server.<a class="code" href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423">readFromSocket</a>(activeFd, &amp;buffer[0], bytesToRead, 0);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Bytes read: &quot;</span> &lt;&lt; bytesRead;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160; </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">if</span> (bytesRead == -1) {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Internal server error while reading from socket: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        close(activeFd);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    }</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keywordflow">if</span> (bytesRead == 0) {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Connection closed by client: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        close(activeFd);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.append(buffer.begin(), buffer.begin() + bytesRead);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    connection.<a class="code" href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">m_timeSinceLastEvent</a> = std::time(0);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a172c400277e73261d212c33f66226090">isCompleteRequestHeader</a>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>)) {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <a class="code" href="_server_8cpp.html#a83350eae81b96dd7b301d1238268ffdb">handleCompleteRequestHeader</a>(server, activeFd, connection);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received partial request header: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size() == <a class="code" href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a>) {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Buffer full, didn&#39;t receive complete request header from &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa934528334c51781e546b5808ef678212">StatusRequestHeaderFieldsTooLarge</a>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(activeFd, EPOLLOUT);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a172c400277e73261d212c33f66226090"><div class="ttname"><a href="_server_8cpp.html#a172c400277e73261d212c33f66226090">isCompleteRequestHeader</a></div><div class="ttdeci">bool isCompleteRequestHeader(const std::string &amp;connectionBuffer)</div><div class="ttdoc">Checks if the connection buffer contains a request header.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01028">Server.cpp:1028</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a83350eae81b96dd7b301d1238268ffdb"><div class="ttname"><a href="_server_8cpp.html#a83350eae81b96dd7b301d1238268ffdb">handleCompleteRequestHeader</a></div><div class="ttdeci">void handleCompleteRequestHeader(Server &amp;server, int clientFd, Connection &amp;connection)</div><div class="ttdoc">Handles the complete request header received from a client.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00964">Server.cpp:964</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa934528334c51781e546b5808ef678212"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa934528334c51781e546b5808ef678212">StatusRequestHeaderFieldsTooLarge</a></div><div class="ttdeci">@ StatusRequestHeaderFieldsTooLarge</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00015">StatusCode.hpp:15</a></div></div>
<div class="ttc" id="aclass_server_html_a043a3f346d803051483a0321fc5c98db"><div class="ttname"><a href="class_server.html#a043a3f346d803051483a0321fc5c98db">Server::s_clientHeaderBufferSize</a></div><div class="ttdeci">static const std::size_t s_clientHeaderBufferSize</div><div class="ttdef"><b>Definition:</b> <a href="_server_8hpp_source.html#l00056">Server.hpp:56</a></div></div>
<div class="ttc" id="aclass_server_html_a45f1691489d81cdd6acc640d96d5046b"><div class="ttname"><a href="class_server.html#a45f1691489d81cdd6acc640d96d5046b">Server::getClientHeaderBuffer</a></div><div class="ttdeci">std::vector&lt; char &gt; &amp; getClientHeaderBuffer()</div><div class="ttdoc">Getter for client header buffer.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00123">Server.cpp:123</a></div></div>
<div class="ttc" id="aclass_server_html_ae94e3d4b5743580a6fbe3228d58af423"><div class="ttname"><a href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423">Server::readFromSocket</a></div><div class="ttdeci">ssize_t readFromSocket(int sockfd, char *buffer, size_t size, int flags) const</div><div class="ttdoc">Wrapper function to SocketPolicy::readFromSocket.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00391">Server.cpp:391</a></div></div>
<div class="ttc" id="aclass_server_html_afab1a4ec9e524b0dae8f60080642e7fe"><div class="ttname"><a href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">Server::modifyEvent</a></div><div class="ttdeci">bool modifyEvent(int modfd, uint32_t eventMask) const</div><div class="ttdoc">Wrapper function to EpollWrapper::modifyEvent.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00301">Server.cpp:301</a></div></div>
<div class="ttc" id="astruct_connection_html_a07f7eaa4b84226772eb4a88c37e5c9fd"><div class="ttname"><a href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">Connection::m_clientFd</a></div><div class="ttdeci">int m_clientFd</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00035">Connection.hpp:35</a></div></div>
<div class="ttc" id="astruct_connection_html_a4157497e77aed0e8b399a47eba498683"><div class="ttname"><a href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">Connection::m_buffer</a></div><div class="ttdeci">std::string m_buffer</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00038">Connection.hpp:38</a></div></div>
<div class="ttc" id="astruct_connection_html_a8038f77baa0072e5aa044efa5ab47625"><div class="ttname"><a href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">Connection::m_timeSinceLastEvent</a></div><div class="ttdeci">time_t m_timeSinceLastEvent</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00036">Connection.hpp:36</a></div></div>
<div class="ttc" id="astruct_connection_html_ae94a8a88f07c64cf17ada17c7e670ada"><div class="ttname"><a href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">Connection::m_request</a></div><div class="ttdeci">HTTPRequest m_request</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00039">Connection.hpp:39</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_a4ab3aefab7679eeb2b4e97f7043bdff3"><div class="ttname"><a href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">HTTPRequest::httpStatus</a></div><div class="ttdeci">statusCode httpStatus</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00027">HTTPRequest.hpp:27</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_aa45d6529fd7be9b7adf788a9679ae34b_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_aa45d6529fd7be9b7adf788a9679ae34b_icgraph.svg" width="100%" height="385"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a83350eae81b96dd7b301d1238268ffdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83350eae81b96dd7b301d1238268ffdb">&#9670;&nbsp;</a></span>handleCompleteRequestHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleCompleteRequestHeader </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>clientFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles the complete request header received from a client. </p>
<p>This function processes the complete request header received from a client, parses the header, sets the active server configuration, and determines the next steps based on the request type (e.g., CGI request, request with body).</p>
<p>The function performs the following steps:</p><ul>
<li>Logs the received request header.</li>
<li>Parses the request header.</li>
<li>Sets the active server configuration based on the "Host" header.</li>
<li>Finds the target resource for the request.</li>
<li>Handles CGI requests if applicable.</li>
<li>Determines the next connection status based on the request type.</li>
</ul>
<p>If an error occurs during header parsing, the function logs the error, sets the connection status to BuildResponse, and modifies the event to EPOLLOUT.</p>
<p>If the request is a CGI request, the function initializes and executes the CGI handler, and registers the CGI file descriptors for EPOLLOUT and EPOLLIN events.</p>
<p>Depending on the request type, the function updates the connection status to ReceiveBody, ReceiveFromCGI, or BuildResponse, and modifies the event to EPOLLOUT if necessary. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>Reference to the <a class="el" href="class_server.html" title="Main class of the HTTP server.">Server</a> instance handling the request. </td></tr>
    <tr><td class="paramname">clientFd</td><td>File descriptor of the client connection. </td></tr>
    <tr><td class="paramname">connection</td><td>Reference to the <a class="el" href="struct_connection.html" title="Represents a connection between a server and a client.">Connection</a> instance representing the client connection. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l00964">964</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;{</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received complete request header: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        server.<a class="code" href="class_server.html#a34bc61299318fe1918293b1d656ee5f9">parseHeader</a>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>, connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>);</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    } <span class="keywordflow">catch</span> (std::exception&amp; e) {</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; e.what();</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    }</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    std::map&lt;std::string, std::string&gt;::iterator iter = connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a7f295acd62075df13848bd3103c89bbf">headers</a>.find(<span class="stringliteral">&quot;host&quot;</span>);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordflow">if</span> (iter != connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a7f295acd62075df13848bd3103c89bbf">headers</a>.end()) {</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="_connection_8hpp.html#a354192f8dd87ca049cf8b7e6de9000da">hasValidServerConfig</a>(connection, server.<a class="code" href="class_server.html#a54745950beb9e321d9a56084501c18e9">getServerConfigs</a>(), iter-&gt;second)) {</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Failed to set active server for &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            close(clientFd);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    }</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160; </div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    server.<a class="code" href="class_server.html#a002dd2fd1e6f0f4290568b4d94f39594">findTargetResource</a>(connection);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="comment">// bool array and method are scoped with enum Method</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="comment">// NOLINTNEXTLINE(cppcoreguidelines-pro-bounds-constant-array-index)</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordflow">if</span> (!connection.<a class="code" href="struct_connection.html#afff86c74740618d83bab5af4f34d10af">location</a>-&gt;allowedMethods[connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a67c428c2e03ff5e9e3fc4403ba9377a9">method</a>])</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa3a2f8b3e6cff3c3161d55afc45abe018">StatusMethodNotAllowed</a>;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a92411155dbfc5d7f43c3f1ac0fe54548">isCGIRequested</a>(connection)) {</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#abea0de9c98e8420ef93a90354fbdec48">hasCGI</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <a class="code" href="class_process_ops.html">ProcessOps</a> processOps;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <a class="code" href="class_c_g_i_handler.html">CGIHandler</a> cgiHandler(connection, processOps);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> == <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9a10085fda0665e4093f44aff66484bc">StatusInternalServerError</a>) {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        }</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        cgiHandler.execute(server.<a class="code" href="class_server.html#a058d2c0df13f61b3e755f412ea56947d">getEpollFd</a>(), server.<a class="code" href="class_server.html#a1f8929bed093f869374cb81da4d97505">getConnections</a>(), server.<a class="code" href="class_server.html#aad2be3b48155c6eb508bca4b1af3db97">getCGIConnections</a>());</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="keywordflow">if</span> ((connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a67c428c2e03ff5e9e3fc4403ba9377a9">method</a> == <a class="code" href="_method_8hpp.html#a2a3c0067e44c5ef3210a256d06c16b0fa81232731cae6bc0dd9cf041d9c91a926">MethodPost</a> &amp;&amp; !server.<a class="code" href="class_server.html#abcfb45414689863da69c2e72ac8fc946">registerCGIFileDescriptor</a>(connection.<a class="code" href="struct_connection.html#ac318cf734aa441020ffb03ec67564985">m_pipeToCGIWriteEnd</a>, EPOLLOUT, connection))</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            || !server.<a class="code" href="class_server.html#abcfb45414689863da69c2e72ac8fc946">registerCGIFileDescriptor</a>(connection.<a class="code" href="struct_connection.html#aef664543be678acdc3121965feadc51b">m_pipeFromCGIReadEnd</a>, EPOLLIN, connection)) {</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#abea0de9c98e8420ef93a90354fbdec48">hasCGI</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9a10085fda0665e4093f44aff66484bc">StatusInternalServerError</a>;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        }</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    }</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> == <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaac2100e382b4b426b38bf06e5f738a080">StatusOK</a> &amp;&amp; connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#ab3f30f449eb8a8b6df63cd67986961ff">hasBody</a>) {</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a08badf2e0cb2478178b4a30242109251">Connection::ReceiveBody</a>;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.erase(0, connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.find(<span class="stringliteral">&quot;\r\n\r\n&quot;</span>) + 4);</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#abea0de9c98e8420ef93a90354fbdec48">hasCGI</a>)</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a517f78d58ea061e41bb21d4afc53d638">Connection::ReceiveFromCGI</a>;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(clientFd, EPOLLOUT);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    }</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;}</div>
<div class="ttc" id="a_connection_8hpp_html_a354192f8dd87ca049cf8b7e6de9000da"><div class="ttname"><a href="_connection_8hpp.html#a354192f8dd87ca049cf8b7e6de9000da">hasValidServerConfig</a></div><div class="ttdeci">bool hasValidServerConfig(Connection &amp;connection, const std::vector&lt; ConfigServer &gt; &amp;serverConfigs)</div><div class="ttdoc">Selects the server configuration for a connection.</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8cpp_source.html#l00105">Connection.cpp:105</a></div></div>
<div class="ttc" id="a_method_8hpp_html_a2a3c0067e44c5ef3210a256d06c16b0fa81232731cae6bc0dd9cf041d9c91a926"><div class="ttname"><a href="_method_8hpp.html#a2a3c0067e44c5ef3210a256d06c16b0fa81232731cae6bc0dd9cf041d9c91a926">MethodPost</a></div><div class="ttdeci">@ MethodPost</div><div class="ttdef"><b>Definition:</b> <a href="_method_8hpp_source.html#l00003">Method.hpp:3</a></div></div>
<div class="ttc" id="a_server_8cpp_html_a92411155dbfc5d7f43c3f1ac0fe54548"><div class="ttname"><a href="_server_8cpp.html#a92411155dbfc5d7f43c3f1ac0fe54548">isCGIRequested</a></div><div class="ttdeci">bool isCGIRequested(Connection &amp;connection)</div><div class="ttdoc">Checks if a CGI request is made based on the connection details.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01043">Server.cpp:1043</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa3a2f8b3e6cff3c3161d55afc45abe018"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa3a2f8b3e6cff3c3161d55afc45abe018">StatusMethodNotAllowed</a></div><div class="ttdeci">@ StatusMethodNotAllowed</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00012">StatusCode.hpp:12</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa9a10085fda0665e4093f44aff66484bc"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9a10085fda0665e4093f44aff66484bc">StatusInternalServerError</a></div><div class="ttdeci">@ StatusInternalServerError</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00016">StatusCode.hpp:16</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaac2100e382b4b426b38bf06e5f738a080"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaac2100e382b4b426b38bf06e5f738a080">StatusOK</a></div><div class="ttdeci">@ StatusOK</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00006">StatusCode.hpp:6</a></div></div>
<div class="ttc" id="aclass_c_g_i_handler_html"><div class="ttname"><a href="class_c_g_i_handler.html">CGIHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="_c_g_i_handler_8hpp_source.html#l00026">CGIHandler.hpp:26</a></div></div>
<div class="ttc" id="aclass_process_ops_html"><div class="ttname"><a href="class_process_ops.html">ProcessOps</a></div><div class="ttdoc">Wrapper class for process-related functions.</div><div class="ttdef"><b>Definition:</b> <a href="_process_ops_8hpp_source.html#l00019">ProcessOps.hpp:19</a></div></div>
<div class="ttc" id="aclass_server_html_a002dd2fd1e6f0f4290568b4d94f39594"><div class="ttname"><a href="class_server.html#a002dd2fd1e6f0f4290568b4d94f39594">Server::findTargetResource</a></div><div class="ttdeci">void findTargetResource(Connection &amp;connection)</div><div class="ttdoc">Wrapper function to TargetResourceHandler::execute.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00502">Server.cpp:502</a></div></div>
<div class="ttc" id="aclass_server_html_a058d2c0df13f61b3e755f412ea56947d"><div class="ttname"><a href="class_server.html#a058d2c0df13f61b3e755f412ea56947d">Server::getEpollFd</a></div><div class="ttdeci">int getEpollFd() const</div><div class="ttdoc">Wrapper function to EpollWrapper::getEpollFd.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00315">Server.cpp:315</a></div></div>
<div class="ttc" id="aclass_server_html_a34bc61299318fe1918293b1d656ee5f9"><div class="ttname"><a href="class_server.html#a34bc61299318fe1918293b1d656ee5f9">Server::parseHeader</a></div><div class="ttdeci">void parseHeader(const std::string &amp;requestString, HTTPRequest &amp;request)</div><div class="ttdoc">Wrapper function to RequestParser::parseHeader.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00455">Server.cpp:455</a></div></div>
<div class="ttc" id="aclass_server_html_a54745950beb9e321d9a56084501c18e9"><div class="ttname"><a href="class_server.html#a54745950beb9e321d9a56084501c18e9">Server::getServerConfigs</a></div><div class="ttdeci">const std::vector&lt; ConfigServer &gt; &amp; getServerConfigs() const</div><div class="ttdoc">Const Getter for server configs.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00109">Server.cpp:109</a></div></div>
<div class="ttc" id="aclass_server_html_abcfb45414689863da69c2e72ac8fc946"><div class="ttname"><a href="class_server.html#abcfb45414689863da69c2e72ac8fc946">Server::registerCGIFileDescriptor</a></div><div class="ttdeci">bool registerCGIFileDescriptor(int pipeFd, uint32_t eventMask, Connection &amp;connection)</div><div class="ttdoc">Register a CGI file descriptor.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00222">Server.cpp:222</a></div></div>
<div class="ttc" id="astruct_connection_html_ac318cf734aa441020ffb03ec67564985"><div class="ttname"><a href="struct_connection.html#ac318cf734aa441020ffb03ec67564985">Connection::m_pipeToCGIWriteEnd</a></div><div class="ttdeci">int m_pipeToCGIWriteEnd</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00042">Connection.hpp:42</a></div></div>
<div class="ttc" id="astruct_connection_html_aef664543be678acdc3121965feadc51b"><div class="ttname"><a href="struct_connection.html#aef664543be678acdc3121965feadc51b">Connection::m_pipeFromCGIReadEnd</a></div><div class="ttdeci">int m_pipeFromCGIReadEnd</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00043">Connection.hpp:43</a></div></div>
<div class="ttc" id="astruct_connection_html_afff86c74740618d83bab5af4f34d10af"><div class="ttname"><a href="struct_connection.html#afff86c74740618d83bab5af4f34d10af">Connection::location</a></div><div class="ttdeci">std::vector&lt; Location &gt;::const_iterator location</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00041">Connection.hpp:41</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_a67c428c2e03ff5e9e3fc4403ba9377a9"><div class="ttname"><a href="struct_h_t_t_p_request.html#a67c428c2e03ff5e9e3fc4403ba9377a9">HTTPRequest::method</a></div><div class="ttdeci">Method method</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00022">HTTPRequest.hpp:22</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_a7f295acd62075df13848bd3103c89bbf"><div class="ttname"><a href="struct_h_t_t_p_request.html#a7f295acd62075df13848bd3103c89bbf">HTTPRequest::headers</a></div><div class="ttdeci">std::map&lt; std::string, std::string &gt; headers</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00025">HTTPRequest.hpp:25</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_ab3f30f449eb8a8b6df63cd67986961ff"><div class="ttname"><a href="struct_h_t_t_p_request.html#ab3f30f449eb8a8b6df63cd67986961ff">HTTPRequest::hasBody</a></div><div class="ttdeci">bool hasBody</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00029">HTTPRequest.hpp:29</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_abea0de9c98e8420ef93a90354fbdec48"><div class="ttname"><a href="struct_h_t_t_p_request.html#abea0de9c98e8420ef93a90354fbdec48">HTTPRequest::hasCGI</a></div><div class="ttdeci">bool hasCGI</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00033">HTTPRequest.hpp:33</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a83350eae81b96dd7b301d1238268ffdb_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a83350eae81b96dd7b301d1238268ffdb_icgraph.svg" width="100%" height="404"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a172c400277e73261d212c33f66226090"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a172c400277e73261d212c33f66226090">&#9670;&nbsp;</a></span>isCompleteRequestHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isCompleteRequestHeader </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>connectionBuffer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the connection buffer contains a request header. </p>
<p>A request header is defined as a string that ends with "\r\n\r\n". </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">connectionBuffer</td><td>The buffer to check for a complete request. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the buffer contains a complete request, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01028">1028</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;{</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordflow">return</span> (connectionBuffer.find(<span class="stringliteral">&quot;\r\n\r\n&quot;</span>) != std::string::npos);</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a172c400277e73261d212c33f66226090_icgraph.svg" width="100%" height="385"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a92411155dbfc5d7f43c3f1ac0fe54548"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92411155dbfc5d7f43c3f1ac0fe54548">&#9670;&nbsp;</a></span>isCGIRequested()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isCGIRequested </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if a CGI request is made based on the connection details. </p>
<p>This function determines if a CGI request is being made by examining the <a class="el" href="struct_u_r_i.html">URI</a> path of the request and comparing it with the CGI path and extension specified in the connection's location.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">connection</td><td>The connection object containing request and location details. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if a CGI request is identified, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01043">1043</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;{</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="comment">// FIXME: May need to iterate through multiple paths and extensions</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#afff86c74740618d83bab5af4f34d10af">location</a>-&gt;cgiPath.empty() || connection.<a class="code" href="struct_connection.html#afff86c74740618d83bab5af4f34d10af">location</a>-&gt;cgiExt.empty())</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="keywordtype">size_t</span> extPos = connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a8f0516b557f9a1dee237d00e48aaac69">uri</a>.<a class="code" href="struct_u_r_i.html#a18b7b6f3328197824e58dc4cf46301df">path</a>.find(connection.<a class="code" href="struct_connection.html#afff86c74740618d83bab5af4f34d10af">location</a>-&gt;cgiExt);</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="comment">// If extension is found and is at the end of the path or followed by a slash</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">return</span> (extPos != std::string::npos</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        &amp;&amp; (extPos + connection.<a class="code" href="struct_connection.html#afff86c74740618d83bab5af4f34d10af">location</a>-&gt;cgiExt.size() == connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a8f0516b557f9a1dee237d00e48aaac69">uri</a>.<a class="code" href="struct_u_r_i.html#a18b7b6f3328197824e58dc4cf46301df">path</a>.size()</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            || connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a8f0516b557f9a1dee237d00e48aaac69">uri</a>.<a class="code" href="struct_u_r_i.html#a18b7b6f3328197824e58dc4cf46301df">path</a>.at(extPos + connection.<a class="code" href="struct_connection.html#afff86c74740618d83bab5af4f34d10af">location</a>-&gt;cgiExt.size()) == <span class="charliteral">&#39;/&#39;</span>));</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;}</div>
<div class="ttc" id="astruct_h_t_t_p_request_html_a8f0516b557f9a1dee237d00e48aaac69"><div class="ttname"><a href="struct_h_t_t_p_request.html#a8f0516b557f9a1dee237d00e48aaac69">HTTPRequest::uri</a></div><div class="ttdeci">URI uri</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00023">HTTPRequest.hpp:23</a></div></div>
<div class="ttc" id="astruct_u_r_i_html_a18b7b6f3328197824e58dc4cf46301df"><div class="ttname"><a href="struct_u_r_i.html#a18b7b6f3328197824e58dc4cf46301df">URI::path</a></div><div class="ttdeci">std::string path</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00014">HTTPRequest.hpp:14</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a92411155dbfc5d7f43c3f1ac0fe54548_icgraph.svg" width="100%" height="404"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a3e07b970ffa58c9315b38673aff94f84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e07b970ffa58c9315b38673aff94f84">&#9670;&nbsp;</a></span>connectionReceiveBody()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionReceiveBody </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>activeFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles the reception of the request body from a client connection. </p>
<p>This function reads data from the client socket and appends it to the connection's buffer. It checks for various conditions such as errors during reading, client disconnection, maximum body size limit, and completeness of the request body. Depending on these conditions, it updates the connection status and modifies the event for the client socket.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>Reference to the <a class="el" href="class_server.html" title="Main class of the HTTP server.">Server</a> instance handling the connection. </td></tr>
    <tr><td class="paramname">activeFd</td><td>The file descriptor being handled. </td></tr>
    <tr><td class="paramname">connection</td><td>Reference to the <a class="el" href="struct_connection.html" title="Represents a connection between a server and a client.">Connection</a> instance representing the client connection.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>If an error occurs while reading from the socket, the client connection is closed. </dd>
<dd>
If the buffer size exceeds the maximum allowed client request body size, an error is logged and the connection's HTTP status is set to StatusRequestEntityTooLarge. </dd>
<dd>
If the request body is complete, it is parsed and the connection status is updated either to <a class="el" href="struct_connection.html" title="Represents a connection between a server and a client.">Connection</a>:SendToCGI or <a class="el" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01075">1075</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;{</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordflow">if</span> (activeFd != connection.<a class="code" href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">m_clientFd</a>)</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Receive Body for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    std::vector&lt;char&gt;&amp; buffer = server.<a class="code" href="class_server.html#a2092f68016c0cfaff0c9c0e1862eb009">getClientBodyBuffer</a>();</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="keywordflow">if</span> (buffer.capacity() &lt; <a class="code" href="class_server.html#a6209b5a55764d2e563be4825d1fcf84a">Server::s_clientBodyBufferSize</a>)</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        buffer.resize(<a class="code" href="class_server.html#a6209b5a55764d2e563be4825d1fcf84a">Server::s_clientBodyBufferSize</a>);</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    buffer.clear();</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> bytesToRead = <a class="code" href="class_server.html#a6209b5a55764d2e563be4825d1fcf84a">Server::s_clientBodyBufferSize</a> - connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size();</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Bytes to read: &quot;</span> &lt;&lt; bytesToRead;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keyword">const</span> ssize_t bytesRead = server.<a class="code" href="class_server.html#ae94e3d4b5743580a6fbe3228d58af423">readFromSocket</a>(activeFd, &amp;buffer[0], bytesToRead, 0);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Bytes read: &quot;</span> &lt;&lt; bytesRead;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160; </div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keywordflow">if</span> (bytesRead == -1) {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Internal server error while reading from socket: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        close(activeFd);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="keywordflow">if</span> (bytesRead == 0) {</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Connection closed by client: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        close(activeFd);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    }</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.append(buffer.begin(), buffer.begin() + bytesRead);</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    connection.<a class="code" href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">m_timeSinceLastEvent</a> = std::time(0);</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_server_8cpp.html#a14a0c5a1227276017a19d9b52141c13a">isCompleteBody</a>(connection)) {</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received complete request body: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            server.<a class="code" href="class_server.html#ace46f4e07ab67db60e3790a32b2e8e0a">parseBody</a>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>, connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>);</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        } <span class="keywordflow">catch</span> (std::exception&amp; e) {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; e.what();</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#abea0de9c98e8420ef93a90354fbdec48">hasCGI</a>)</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ae4dc47b21ee9ccbf06de49701c65e548">Connection::SendToCGI</a>;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;            connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(activeFd, EPOLLOUT);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Received partial request body: &quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> == <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424">StatusBadRequest</a>) {</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <a class="code" href="error_8hpp.html#a683508ef2f2400bcd0f5f5e02dfd85c5">ERR_CONTENT_LENGTH</a>;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(activeFd, EPOLLOUT);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size() == <a class="code" href="class_server.html#a794aa3ae836d313505706b951a7a02f0">Server::s_clientMaxBodySize</a>) {</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Maximum allowed client request body size reached from &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa80247b37438ce9e27971aff9469049c6">StatusRequestEntityTooLarge</a>;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;            connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;            server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(activeFd, EPOLLOUT);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        }</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    }</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_a14a0c5a1227276017a19d9b52141c13a"><div class="ttname"><a href="_server_8cpp.html#a14a0c5a1227276017a19d9b52141c13a">isCompleteBody</a></div><div class="ttdeci">bool isCompleteBody(Connection &amp;connection)</div><div class="ttdoc">Checks if the HTTP request body has been completely received.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01147">Server.cpp:1147</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa80247b37438ce9e27971aff9469049c6"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa80247b37438ce9e27971aff9469049c6">StatusRequestEntityTooLarge</a></div><div class="ttdeci">@ StatusRequestEntityTooLarge</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00014">StatusCode.hpp:14</a></div></div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424">StatusBadRequest</a></div><div class="ttdeci">@ StatusBadRequest</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00009">StatusCode.hpp:9</a></div></div>
<div class="ttc" id="aclass_server_html_a2092f68016c0cfaff0c9c0e1862eb009"><div class="ttname"><a href="class_server.html#a2092f68016c0cfaff0c9c0e1862eb009">Server::getClientBodyBuffer</a></div><div class="ttdeci">std::vector&lt; char &gt; &amp; getClientBodyBuffer()</div><div class="ttdoc">Getter for client body buffer.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00130">Server.cpp:130</a></div></div>
<div class="ttc" id="aclass_server_html_a6209b5a55764d2e563be4825d1fcf84a"><div class="ttname"><a href="class_server.html#a6209b5a55764d2e563be4825d1fcf84a">Server::s_clientBodyBufferSize</a></div><div class="ttdeci">static const std::size_t s_clientBodyBufferSize</div><div class="ttdef"><b>Definition:</b> <a href="_server_8hpp_source.html#l00057">Server.hpp:57</a></div></div>
<div class="ttc" id="aclass_server_html_a794aa3ae836d313505706b951a7a02f0"><div class="ttname"><a href="class_server.html#a794aa3ae836d313505706b951a7a02f0">Server::s_clientMaxBodySize</a></div><div class="ttdeci">static const std::size_t s_clientMaxBodySize</div><div class="ttdef"><b>Definition:</b> <a href="_server_8hpp_source.html#l00058">Server.hpp:58</a></div></div>
<div class="ttc" id="aclass_server_html_ace46f4e07ab67db60e3790a32b2e8e0a"><div class="ttname"><a href="class_server.html#ace46f4e07ab67db60e3790a32b2e8e0a">Server::parseBody</a></div><div class="ttdeci">void parseBody(const std::string &amp;bodyString, HTTPRequest &amp;request)</div><div class="ttdoc">Wrapper function to RequestParser::parseBody.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00466">Server.cpp:466</a></div></div>
<div class="ttc" id="aerror_8hpp_html_a683508ef2f2400bcd0f5f5e02dfd85c5"><div class="ttname"><a href="error_8hpp.html#a683508ef2f2400bcd0f5f5e02dfd85c5">ERR_CONTENT_LENGTH</a></div><div class="ttdeci">#define ERR_CONTENT_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="error_8hpp_source.html#l00039">error.hpp:39</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a3e07b970ffa58c9315b38673aff94f84_cgraph.svg" width="100%" height="480"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a3e07b970ffa58c9315b38673aff94f84_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a14a0c5a1227276017a19d9b52141c13a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14a0c5a1227276017a19d9b52141c13a">&#9670;&nbsp;</a></span>isCompleteBody()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isCompleteBody </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the HTTP request body has been completely received. </p>
<p>This function determines whether the HTTP request body in the given connection has been completely received. If the request is not chunked, it checks whether the content length matches the buffer size. In case the buffer size is larger than the content length, the request status is set to StatusBadRequest. If the request is chunked, it checks for the presence of the chunked transfer termination sequence ("0\r\n\r\n").</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">connection</td><td>A reference to the <a class="el" href="struct_connection.html" title="Represents a connection between a server and a client.">Connection</a> object representing the current HTTP connection. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the request body has been completely received, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01147">1147</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;{</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="keywordflow">if</span> (!connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#ac894099e690bcad5b4c6423c00b75017">isChunked</a>) {</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> contentLength</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            = std::strtoul(connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a7f295acd62075df13848bd3103c89bbf">headers</a>.at(<span class="stringliteral">&quot;content-length&quot;</span>).c_str(), NULL, <a class="code" href="namespaceconstants.html#afe756195738c244eeace3037c5486edc">constants::g_decimalBase</a>);</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <span class="keywordflow">if</span> (contentLength &lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size()) {</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <a class="code" href="error_8hpp.html#a683508ef2f2400bcd0f5f5e02dfd85c5">ERR_CONTENT_LENGTH</a>;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Content-Length: &quot;</span> &lt;&lt; contentLength &lt;&lt; <span class="stringliteral">&quot;, Buffer size: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size();</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;            connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9c4d4211ed914ad3f1ef5cbfcbd7e424">StatusBadRequest</a>;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        <span class="keywordflow">if</span> (contentLength == connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size())</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordflow">return</span> connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.find(<span class="stringliteral">&quot;0\r\n\r\n&quot;</span>) != std::string::npos;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;}</div>
<div class="ttc" id="anamespaceconstants_html_afe756195738c244eeace3037c5486edc"><div class="ttname"><a href="namespaceconstants.html#afe756195738c244eeace3037c5486edc">constants::g_decimalBase</a></div><div class="ttdeci">const int g_decimalBase</div><div class="ttdef"><b>Definition:</b> <a href="constants_8cpp_source.html#l00005">constants.cpp:5</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_ac894099e690bcad5b4c6423c00b75017"><div class="ttname"><a href="struct_h_t_t_p_request.html#ac894099e690bcad5b4c6423c00b75017">HTTPRequest::isChunked</a></div><div class="ttdeci">bool isChunked</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00030">HTTPRequest.hpp:30</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a14a0c5a1227276017a19d9b52141c13a_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aa67430205b6049aa70bad4682a7442b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa67430205b6049aa70bad4682a7442b8">&#9670;&nbsp;</a></span>connectionSendToCGI()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionSendToCGI </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>activeFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends the request body to the CGI process. </p>
<p>This function handles sending the request body from the connection to the CGI process. If the request body is empty, it logs an error, sets the HTTP status to internal server error, updates the connection status to build response, modifies the event to EPOLLOUT, and removes the CGI file descriptors from the server.</p>
<p>If the request body is not empty, it attempts to write the body to the CGI process. If the write operation fails, it logs an error, sets the HTTP status to internal server error, updates the connection status to build response, modifies the event to EPOLLOUT, and removes the CGI file descriptors from the server.</p>
<p>If the entire body is successfully written to the CGI process, it logs a debug message, updates the connection status to receive from CGI, clears the request body, and removes the write end of the CGI pipe from the server.</p>
<p>If only part of the body is written, it updates the request body to contain the remaining data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>Reference to the <a class="el" href="class_server.html" title="Main class of the HTTP server.">Server</a> object. </td></tr>
    <tr><td class="paramname">activeFd</td><td>The file descriptor being handled. </td></tr>
    <tr><td class="paramname">connection</td><td>Reference to the <a class="el" href="struct_connection.html" title="Represents a connection between a server and a client.">Connection</a> object. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01187">1187</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;{</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">if</span> (activeFd == connection.<a class="code" href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">m_clientFd</a>)</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160; </div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Send to CGI for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; </div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#aca4c75c911f0de6d36648d3c519d396b">body</a>.empty()) {</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;empty body: can&#39;t send to CGI&quot;</span>;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9a10085fda0665e4093f44aff66484bc">StatusInternalServerError</a>;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(connection.<a class="code" href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">m_clientFd</a>, EPOLLOUT);</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        server.<a class="code" href="class_server.html#ab4a0ae2ec5d126062a7c5d4a2f78160a">removeCGIFileDescriptor</a>(connection.<a class="code" href="struct_connection.html#aef664543be678acdc3121965feadc51b">m_pipeFromCGIReadEnd</a>);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        server.<a class="code" href="class_server.html#ab4a0ae2ec5d126062a7c5d4a2f78160a">removeCGIFileDescriptor</a>(connection.<a class="code" href="struct_connection.html#ac318cf734aa441020ffb03ec67564985">m_pipeToCGIWriteEnd</a>);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    }</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160; </div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="keyword">const</span> ssize_t bytesSent = server.<a class="code" href="class_server.html#a8fec2a00e7d106bf35f19d2d7f61fd0b">writeProcess</a>(</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        connection.<a class="code" href="struct_connection.html#ac318cf734aa441020ffb03ec67564985">m_pipeToCGIWriteEnd</a>, connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#aca4c75c911f0de6d36648d3c519d396b">body</a>.c_str(), connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#aca4c75c911f0de6d36648d3c519d396b">body</a>.size());</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Bytes sent to CGI: &quot;</span> &lt;&lt; bytesSent;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160; </div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="keywordflow">if</span> (bytesSent == -1) {</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;write(): can&#39;t send to CGI: &quot;</span> &lt;&lt; std::strerror(errno);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9a10085fda0665e4093f44aff66484bc">StatusInternalServerError</a>;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(connection.<a class="code" href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">m_clientFd</a>, EPOLLOUT);</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        server.<a class="code" href="class_server.html#ab4a0ae2ec5d126062a7c5d4a2f78160a">removeCGIFileDescriptor</a>(connection.<a class="code" href="struct_connection.html#aef664543be678acdc3121965feadc51b">m_pipeFromCGIReadEnd</a>);</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        server.<a class="code" href="class_server.html#ab4a0ae2ec5d126062a7c5d4a2f78160a">removeCGIFileDescriptor</a>(connection.<a class="code" href="struct_connection.html#ac318cf734aa441020ffb03ec67564985">m_pipeToCGIWriteEnd</a>);</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    }</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="keywordflow">if</span> (bytesSent == <span class="keyword">static_cast&lt;</span>ssize_t<span class="keyword">&gt;</span>(connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#aca4c75c911f0de6d36648d3c519d396b">body</a>.size())) {</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;CGI: Full body sent&quot;</span>;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a517f78d58ea061e41bb21d4afc53d638">Connection::ReceiveFromCGI</a>;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#aca4c75c911f0de6d36648d3c519d396b">body</a>.clear();</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        server.<a class="code" href="class_server.html#ab4a0ae2ec5d126062a7c5d4a2f78160a">removeCGIFileDescriptor</a>(connection.<a class="code" href="struct_connection.html#ac318cf734aa441020ffb03ec67564985">m_pipeToCGIWriteEnd</a>);</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    }</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#aca4c75c911f0de6d36648d3c519d396b">body</a>.erase(0, bytesSent);</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;}</div>
<div class="ttc" id="aclass_server_html_a8fec2a00e7d106bf35f19d2d7f61fd0b"><div class="ttname"><a href="class_server.html#a8fec2a00e7d106bf35f19d2d7f61fd0b">Server::writeProcess</a></div><div class="ttdeci">ssize_t writeProcess(int fileDescriptor, const char *buffer, size_t size) const</div><div class="ttdoc">Wrapper function to ProcessOps::writeProcess.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00442">Server.cpp:442</a></div></div>
<div class="ttc" id="aclass_server_html_ab4a0ae2ec5d126062a7c5d4a2f78160a"><div class="ttname"><a href="class_server.html#ab4a0ae2ec5d126062a7c5d4a2f78160a">Server::removeCGIFileDescriptor</a></div><div class="ttdeci">void removeCGIFileDescriptor(int &amp;delfd)</div><div class="ttdoc">Removes a CGI file descriptor from the server.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00253">Server.cpp:253</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_aca4c75c911f0de6d36648d3c519d396b"><div class="ttname"><a href="struct_h_t_t_p_request.html#aca4c75c911f0de6d36648d3c519d396b">HTTPRequest::body</a></div><div class="ttdeci">std::string body</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00026">HTTPRequest.hpp:26</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_aa67430205b6049aa70bad4682a7442b8_cgraph.svg" width="100%" height="480"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_aa67430205b6049aa70bad4682a7442b8_icgraph.svg" width="100%" height="385"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a735bf6535f62b5907ea2d5f0e1abf3c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a735bf6535f62b5907ea2d5f0e1abf3c7">&#9670;&nbsp;</a></span>connectionReceiveFromCGI()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionReceiveFromCGI </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>activeFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles receiving data from a CGI script and processes it accordingly. </p>
<p>This function reads data from the CGI script's output pipe and appends it to the request body. It also handles errors during the read operation and manages the connection state based on the data received. If the read operation indicates that the CGI script has finished sending data, the function will transition the connection to the response-building state and clean up the associated file descriptors.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>Reference to the <a class="el" href="class_server.html" title="Main class of the HTTP server.">Server</a> instance managing the connection. </td></tr>
    <tr><td class="paramname">activeFd</td><td>The file descriptor being handled. </td></tr>
    <tr><td class="paramname">connection</td><td>Reference to the <a class="el" href="struct_connection.html" title="Represents a connection between a server and a client.">Connection</a> instance representing the client connection. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01240">1240</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;{</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <span class="keywordflow">if</span> (activeFd == connection.<a class="code" href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">m_clientFd</a>)</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160; </div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Receive from CGI for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160; </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    std::vector&lt;char&gt;&amp; buffer = server.<a class="code" href="class_server.html#aa6eec7b99c50847aeef2b0746f46a8f6">getCGIBodyBuffer</a>();</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="keywordflow">if</span> (buffer.capacity() &lt; <a class="code" href="class_server.html#aab518a710ed11e456b78a34392a137c5">Server::s_cgiBodyBufferSize</a>)</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        buffer.resize(<a class="code" href="class_server.html#aab518a710ed11e456b78a34392a137c5">Server::s_cgiBodyBufferSize</a>);</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    buffer.clear();</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160; </div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keyword">const</span> ssize_t bytesRead</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        = server.<a class="code" href="class_server.html#a8aa46a2d98652ee4c70ac7528f614422">readProcess</a>(connection.<a class="code" href="struct_connection.html#aef664543be678acdc3121965feadc51b">m_pipeFromCGIReadEnd</a>, &amp;buffer[0], <a class="code" href="class_server.html#aab518a710ed11e456b78a34392a137c5">Server::s_cgiBodyBufferSize</a>);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Bytes read: &quot;</span> &lt;&lt; bytesRead;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160; </div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="keywordflow">if</span> (bytesRead == -1) {</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;read(): can&#39;t read from CGI: &quot;</span> &lt;&lt; std::strerror(errno);</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;        connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9a10085fda0665e4093f44aff66484bc">StatusInternalServerError</a>;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(connection.<a class="code" href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">m_clientFd</a>, EPOLLOUT);</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        server.<a class="code" href="class_server.html#ab4a0ae2ec5d126062a7c5d4a2f78160a">removeCGIFileDescriptor</a>(connection.<a class="code" href="struct_connection.html#aef664543be678acdc3121965feadc51b">m_pipeFromCGIReadEnd</a>);</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ac318cf734aa441020ffb03ec67564985">m_pipeToCGIWriteEnd</a> != -1)</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;            server.<a class="code" href="class_server.html#ab4a0ae2ec5d126062a7c5d4a2f78160a">removeCGIFileDescriptor</a>(connection.<a class="code" href="struct_connection.html#ac318cf734aa441020ffb03ec67564985">m_pipeToCGIWriteEnd</a>);</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    }</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordflow">if</span> (bytesRead == 0) {</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;CGI: Full body received&quot;</span>;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a2ac033d09b30cd3cfc7b53526ae83952">Connection::BuildResponse</a>;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(connection.<a class="code" href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">m_clientFd</a>, EPOLLOUT);</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        server.<a class="code" href="class_server.html#ab4a0ae2ec5d126062a7c5d4a2f78160a">removeCGIFileDescriptor</a>(connection.<a class="code" href="struct_connection.html#aef664543be678acdc3121965feadc51b">m_pipeFromCGIReadEnd</a>);</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ac318cf734aa441020ffb03ec67564985">m_pipeToCGIWriteEnd</a> != -1)</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;            server.<a class="code" href="class_server.html#ab4a0ae2ec5d126062a7c5d4a2f78160a">removeCGIFileDescriptor</a>(connection.<a class="code" href="struct_connection.html#ac318cf734aa441020ffb03ec67564985">m_pipeToCGIWriteEnd</a>);</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        <span class="keywordtype">int</span> status = 0;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <span class="keywordflow">if</span> (waitpid(connection.<a class="code" href="struct_connection.html#ac38ba2b55c7b4b96c36ae75316de2a6f">m_cgiPid</a>, &amp;status, 0) == -1) {</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;waitpid(): &quot;</span> &lt;&lt; std::strerror(errno);</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;            connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9a10085fda0665e4093f44aff66484bc">StatusInternalServerError</a>;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        }</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <span class="comment">// Check if the child exited normally with exit() or returning from main()</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <span class="keywordflow">if</span> (WIFEXITED(status)) { <span class="comment">// NOLINT: misinterpretation by HIC++ standard</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;            <span class="keywordtype">int</span> exitCode = WEXITSTATUS(status); <span class="comment">// NOLINT: misinterpretation by HIC++ standard</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;            <span class="comment">// Any child exit status unequal to 0 indicates unsuccessful completion of the process</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            <span class="keywordflow">if</span> (exitCode != 0) {</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;child returned with: &quot;</span> &lt;&lt; exitCode;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9a10085fda0665e4093f44aff66484bc">StatusInternalServerError</a>;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;            }</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (WIFSIGNALED(status)) { <span class="comment">// NOLINT: misinterpretation by HIC++ standard</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;            <span class="keywordtype">int</span> signalNumber = WTERMSIG(status); <span class="comment">// NOLINT: misinterpretation by HIC++ standard</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;            <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;child terminated by signal: &quot;</span> &lt;&lt; signalNumber &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="signal_handler_8hpp.html#adc4193659d5893030190dca46c276ac7">signalNumToName</a>(signalNumber) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;            connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaa9a10085fda0665e4093f44aff66484bc">StatusInternalServerError</a>;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        }</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    }</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#aca4c75c911f0de6d36648d3c519d396b">body</a>.append(buffer.begin(), buffer.begin() + bytesRead);</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;}</div>
<div class="ttc" id="aclass_server_html_a8aa46a2d98652ee4c70ac7528f614422"><div class="ttname"><a href="class_server.html#a8aa46a2d98652ee4c70ac7528f614422">Server::readProcess</a></div><div class="ttdeci">ssize_t readProcess(int fileDescriptor, char *buffer, size_t size) const</div><div class="ttdoc">Wrapper function to ProcessOps::readProcess.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00427">Server.cpp:427</a></div></div>
<div class="ttc" id="aclass_server_html_aa6eec7b99c50847aeef2b0746f46a8f6"><div class="ttname"><a href="class_server.html#aa6eec7b99c50847aeef2b0746f46a8f6">Server::getCGIBodyBuffer</a></div><div class="ttdeci">std::vector&lt; char &gt; &amp; getCGIBodyBuffer()</div><div class="ttdoc">Getter for CGI body buffer.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00137">Server.cpp:137</a></div></div>
<div class="ttc" id="aclass_server_html_aab518a710ed11e456b78a34392a137c5"><div class="ttname"><a href="class_server.html#aab518a710ed11e456b78a34392a137c5">Server::s_cgiBodyBufferSize</a></div><div class="ttdeci">static const std::size_t s_cgiBodyBufferSize</div><div class="ttdef"><b>Definition:</b> <a href="_server_8hpp_source.html#l00059">Server.hpp:59</a></div></div>
<div class="ttc" id="astruct_connection_html_ac38ba2b55c7b4b96c36ae75316de2a6f"><div class="ttname"><a href="struct_connection.html#ac38ba2b55c7b4b96c36ae75316de2a6f">Connection::m_cgiPid</a></div><div class="ttdeci">pid_t m_cgiPid</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8hpp_source.html#l00044">Connection.hpp:44</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a735bf6535f62b5907ea2d5f0e1abf3c7_cgraph.svg" width="100%" height="546"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a735bf6535f62b5907ea2d5f0e1abf3c7_icgraph.svg" width="100%" height="385"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a9b6964fe44b1605c00c0f211a7f42896"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b6964fe44b1605c00c0f211a7f42896">&#9670;&nbsp;</a></span>connectionBuildResponse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionBuildResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>activeFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Builds the response for a client connection. </p>
<p>Builds the response for a client connection by calling <a class="el" href="class_server.html#aaa1a16c8d18a7d0a4191adfeb65fdf82" title="Wrapper function to ResponseBuilder::buildResponse.">Server::buildResponse()</a>. The response is stored in the connection buffer. The connection status is set to SendResponse and the response is sent to the client by calling <a class="el" href="_server_8cpp.html#a43e9e764c97aacfc12f233b33ffa3342" title="Sends the response to a client connection.">connectionSendResponse()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">activeFd</td><td>The file descriptor being handled. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to build the response for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01310">1310</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;{</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <span class="keywordflow">if</span> (activeFd != connection.<a class="code" href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">m_clientFd</a>)</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160; </div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;BuildResponse for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160; </div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    server.<a class="code" href="class_server.html#aaa1a16c8d18a7d0a4191adfeb65fdf82">buildResponse</a>(connection);</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.clear();</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a> = server.<a class="code" href="class_server.html#a718bf76e7c3f830abb2f7b0972cdaa63">getResponse</a>();</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7aeba45ef49dfe5c00ed4fb83f7de6a7c7">Connection::SendResponse</a>;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <a class="code" href="_server_8cpp.html#a43e9e764c97aacfc12f233b33ffa3342">connectionSendResponse</a>(server, activeFd, connection);</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;}</div>
<div class="ttc" id="aclass_server_html_a718bf76e7c3f830abb2f7b0972cdaa63"><div class="ttname"><a href="class_server.html#a718bf76e7c3f830abb2f7b0972cdaa63">Server::getResponse</a></div><div class="ttdeci">std::string getResponse()</div><div class="ttdoc">Wrapper function to ResponseBuilder::getResponse.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00493">Server.cpp:493</a></div></div>
<div class="ttc" id="aclass_server_html_aaa1a16c8d18a7d0a4191adfeb65fdf82"><div class="ttname"><a href="class_server.html#aaa1a16c8d18a7d0a4191adfeb65fdf82">Server::buildResponse</a></div><div class="ttdeci">void buildResponse(Connection &amp;connection)</div><div class="ttdoc">Wrapper function to ResponseBuilder::buildResponse.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00483">Server.cpp:483</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a9b6964fe44b1605c00c0f211a7f42896_cgraph.svg" width="100%" height="587"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a9b6964fe44b1605c00c0f211a7f42896_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a43e9e764c97aacfc12f233b33ffa3342"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43e9e764c97aacfc12f233b33ffa3342">&#9670;&nbsp;</a></span>connectionSendResponse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionSendResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>activeFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends the response to a client connection. </p>
<p>Sends the response to a client connection by calling <a class="el" href="class_server.html#a8bf2a41e8ddcccd54b5832b58211a283" title="Wrapper function to SocketPolicy::writeToSocket.">Server::writeToSocket()</a>. The amount of bytes to send is determined by the size of the connection buffer. If sent bytes == -1 it indicates an internal server error and the connection is closed. If the response is not completely sent, the bytes sent are removed from the buffer and timeSinceLastEvent is updated. If the response is completely sent and the connection is set to close, the client socket is closed and the connection status is set to Closed. If the response is completely sent and the connection is not set to close, the event is modified to listen to EPOLLIN and the connection is cleared. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">activeFd</td><td>The file descriptor being handled. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to send the response for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01340">1340</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;{</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="keywordflow">if</span> (activeFd != connection.<a class="code" href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">m_clientFd</a>)</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160; </div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;SendResponse for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a> &lt;&lt; <span class="stringliteral">&quot; on socket:&quot;</span> &lt;&lt; activeFd;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160; </div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="keyword">const</span> ssize_t bytesToSend = <span class="keyword">static_cast&lt;</span>ssize_t<span class="keyword">&gt;</span>(connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.size());</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="keyword">const</span> ssize_t sentBytes = server.<a class="code" href="class_server.html#a8bf2a41e8ddcccd54b5832b58211a283">writeToSocket</a>(activeFd, connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.c_str(), bytesToSend, 0);</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keywordflow">if</span> (sentBytes == -1) {</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <a class="code" href="_log_8hpp.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a> &lt;&lt; <span class="stringliteral">&quot;Internal server error&quot;</span>;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        close(activeFd);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    }</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160; </div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="keywordflow">if</span> (sentBytes &lt; bytesToSend) {</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Sent &quot;</span> &lt;&lt; sentBytes &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span>;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        connection.<a class="code" href="struct_connection.html#a4157497e77aed0e8b399a47eba498683">m_buffer</a>.erase(0, sentBytes);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        connection.<a class="code" href="struct_connection.html#a8038f77baa0072e5aa044efa5ab47625">m_timeSinceLastEvent</a> = std::time(0);</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    }</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160; </div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <span class="keywordflow">if</span> (connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#afc0f4c6d53b455a67ea264dbfc3be0e4">shallCloseConnection</a>) {</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Closing connection&quot;</span>;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        close(activeFd);</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        connection.<a class="code" href="struct_connection.html#af433353beabb6990235b13b24c8b6bbe">m_status</a> = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Connection alive&quot;</span>;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(activeFd, EPOLLIN);</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <a class="code" href="_connection_8hpp.html#a1787b72853fa3a6146cea621fa1d0d65">clearConnection</a>(connection, server.<a class="code" href="class_server.html#a54745950beb9e321d9a56084501c18e9">getServerConfigs</a>());</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    }</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;}</div>
<div class="ttc" id="a_connection_8hpp_html_a1787b72853fa3a6146cea621fa1d0d65"><div class="ttname"><a href="_connection_8hpp.html#a1787b72853fa3a6146cea621fa1d0d65">clearConnection</a></div><div class="ttdeci">bool clearConnection(Connection &amp;connection, const std::vector&lt; ConfigServer &gt; &amp;serverConfigs)</div><div class="ttdoc">Clears the state of a given Connection object and resets its attributes.</div><div class="ttdef"><b>Definition:</b> <a href="_connection_8cpp_source.html#l00041">Connection.cpp:41</a></div></div>
<div class="ttc" id="aclass_server_html_a8bf2a41e8ddcccd54b5832b58211a283"><div class="ttname"><a href="class_server.html#a8bf2a41e8ddcccd54b5832b58211a283">Server::writeToSocket</a></div><div class="ttdeci">ssize_t writeToSocket(int sockfd, const char *buffer, size_t size, int flags) const</div><div class="ttdoc">Wrapper function to SocketPolicy::writeToSocket.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00407">Server.cpp:407</a></div></div>
<div class="ttc" id="astruct_h_t_t_p_request_html_afc0f4c6d53b455a67ea264dbfc3be0e4"><div class="ttname"><a href="struct_h_t_t_p_request.html#afc0f4c6d53b455a67ea264dbfc3be0e4">HTTPRequest::shallCloseConnection</a></div><div class="ttdeci">bool shallCloseConnection</div><div class="ttdef"><b>Definition:</b> <a href="_h_t_t_p_request_8hpp_source.html#l00028">HTTPRequest.hpp:28</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a43e9e764c97aacfc12f233b33ffa3342_cgraph.svg" width="100%" height="461"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a43e9e764c97aacfc12f233b33ffa3342_icgraph.svg" width="100%" height="442"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ad132a77471376bd48681070a795df914"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad132a77471376bd48681070a795df914">&#9670;&nbsp;</a></span>connectionHandleTimeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connectionHandleTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>activeFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_connection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles a timeout for a client connection. </p>
<p>Handles a timeout for a client connection by setting the request status to StatusRequestTimeout. Then it builds the error message by calling <a class="el" href="_server_8cpp.html#a9b6964fe44b1605c00c0f211a7f42896" title="Builds the response for a client connection.">connectionBuildResponse()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object which handles the connection. </td></tr>
    <tr><td class="paramname">activeFd</td><td>The file descriptor being handled. </td></tr>
    <tr><td class="paramname">connection</td><td>The connection object to handle the timeout for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01384">1384</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;{</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="keywordflow">if</span> (activeFd != connection.<a class="code" href="struct_connection.html#a07f7eaa4b84226772eb4a88c37e5c9fd">m_clientFd</a>)</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160; </div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Timeout for: &quot;</span> &lt;&lt; connection.<a class="code" href="struct_connection.html#a244c1b9870181fb1c847758d21e2c8b3">m_clientSocket</a>;</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160; </div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#afc0f4c6d53b455a67ea264dbfc3be0e4">shallCloseConnection</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    connection.<a class="code" href="struct_connection.html#ae94a8a88f07c64cf17ada17c7e670ada">m_request</a>.<a class="code" href="struct_h_t_t_p_request.html#a4ab3aefab7679eeb2b4e97f7043bdff3">httpStatus</a> = <a class="code" href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaacffa58a18c688740c290369c8bf13a3f">StatusRequestTimeout</a>;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160; </div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <a class="code" href="_server_8cpp.html#a9b6964fe44b1605c00c0f211a7f42896">connectionBuildResponse</a>(server, activeFd, connection);</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;}</div>
<div class="ttc" id="a_status_code_8hpp_html_a0506d82d6e3d6758981ff5eac9ca85eaacffa58a18c688740c290369c8bf13a3f"><div class="ttname"><a href="_status_code_8hpp.html#a0506d82d6e3d6758981ff5eac9ca85eaacffa58a18c688740c290369c8bf13a3f">StatusRequestTimeout</a></div><div class="ttdeci">@ StatusRequestTimeout</div><div class="ttdef"><b>Definition:</b> <a href="_status_code_8hpp_source.html#l00013">StatusCode.hpp:13</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_ad132a77471376bd48681070a795df914_cgraph.svg" width="100%" height="587"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_ad132a77471376bd48681070a795df914_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a28fd29ec48bd9459c678980cfccca4cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28fd29ec48bd9459c678980cfccca4cf">&#9670;&nbsp;</a></span>checkForTimeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkForTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterates through all connections and checks if any have timed out. </p>
<p>If the connection status is Closed, it is skipped. The time since last event is saved in a variable to print it to the log and check if it is greater than the timeout set for the server. If it is, the connection is modified to EPOLLOUT, and the state is set to Timeout. When the fd is ready to receive a message the timeout error will be send. </p>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01405">1405</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;{</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;int, Connection&gt;::iterator iter = server.<a class="code" href="class_server.html#a1f8929bed093f869374cb81da4d97505">getConnections</a>().begin();</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;         iter != server.<a class="code" href="class_server.html#a1f8929bed093f869374cb81da4d97505">getConnections</a>().end(); ++iter) {</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;second.m_status == <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>)</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        <span class="keyword">const</span> time_t timeSinceLastEvent = std::time(0) - iter-&gt;second.m_timeSinceLastEvent;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; iter-&gt;second.m_clientSocket &lt;&lt; <span class="stringliteral">&quot;: Time since last event: &quot;</span> &lt;&lt; timeSinceLastEvent;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        <span class="keywordflow">if</span> (timeSinceLastEvent &gt; server.<a class="code" href="class_server.html#af8184a299847cca0789696048893bc48">getClientTimeout</a>()) {</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;            <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Connection timeout: &quot;</span> &lt;&lt; iter-&gt;second.m_clientSocket;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;            server.<a class="code" href="class_server.html#afab1a4ec9e524b0dae8f60080642e7fe">modifyEvent</a>(iter-&gt;first, EPOLLOUT);</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;            iter-&gt;second.m_status = <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7ad5d9faed520e1cb7205bbba881940d47">Connection::Timeout</a>;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        }</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    }</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;}</div>
<div class="ttc" id="aclass_server_html_af8184a299847cca0789696048893bc48"><div class="ttname"><a href="class_server.html#af8184a299847cca0789696048893bc48">Server::getClientTimeout</a></div><div class="ttdeci">time_t getClientTimeout() const</div><div class="ttdoc">Const Getter for client timeout.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00116">Server.cpp:116</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a28fd29ec48bd9459c678980cfccca4cf_cgraph.svg" width="626" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a28fd29ec48bd9459c678980cfccca4cf_icgraph.svg" width="556" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a9e2693ba11e20b84de090bcdd0b665db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e2693ba11e20b84de090bcdd0b665db">&#9670;&nbsp;</a></span>cleanupClosedConnections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanupClosedConnections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterates through all connections and removes closed ones. </p>
<p>The for loop through the connections map has no increment statement because the iterator is incremented in the loop body. If .erase() is called on an iterator, it is invalidated.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to cleanup closed connections for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01432">1432</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;{</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;int, Connection&gt;::iterator iter = server.<a class="code" href="class_server.html#a1f8929bed093f869374cb81da4d97505">getConnections</a>().begin();</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;         iter != server.<a class="code" href="class_server.html#a1f8929bed093f869374cb81da4d97505">getConnections</a>().end();</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        <span class="comment">/* no iter*/</span>) {</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;second.m_status == <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a297f64602a349bd3f0b3955c15e8e614">Connection::Closed</a>)</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;            server.<a class="code" href="class_server.html#a1f8929bed093f869374cb81da4d97505">getConnections</a>().erase(iter++);</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;            ++iter;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    }</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a9e2693ba11e20b84de090bcdd0b665db_cgraph.svg" width="430" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a9e2693ba11e20b84de090bcdd0b665db_icgraph.svg" width="619" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="af2feae308a0fa968c84525fcdfb19251"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2feae308a0fa968c84525fcdfb19251">&#9670;&nbsp;</a></span>cleanupIdleConnections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanupIdleConnections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterates through all connections, closes and removes idle ones. </p>
<p>The for loop through the connections map has no increment statement because the iterator is incremented in the loop body. If .erase() is called on an iterator, it is invalidated.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to cleanup idle connections for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01453">1453</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;{</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;int, Connection&gt;::iterator iter = server.<a class="code" href="class_server.html#a1f8929bed093f869374cb81da4d97505">getConnections</a>().begin();</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;         iter != server.<a class="code" href="class_server.html#a1f8929bed093f869374cb81da4d97505">getConnections</a>().end();</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <span class="comment">/* no iter*/</span>) {</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <span class="keywordflow">if</span> (iter-&gt;second.m_status == <a class="code" href="struct_connection.html#a482f32f94d99bd510db3eabf9a1d35b7a69ce01d1521944754fb16d9d2e59186c">Connection::Idle</a>) {</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;            close(iter-&gt;first);</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;            server.<a class="code" href="class_server.html#a1f8929bed093f869374cb81da4d97505">getConnections</a>().erase(iter++);</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;            ++iter;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    }</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_af2feae308a0fa968c84525fcdfb19251_cgraph.svg" width="410" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_af2feae308a0fa968c84525fcdfb19251_icgraph.svg" width="599" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a115ecd76e344c1007bedc48b9bbdc0fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a115ecd76e344c1007bedc48b9bbdc0fa">&#9670;&nbsp;</a></span>shutdownServer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void shutdownServer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_server.html">Server</a> &amp;&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a graceful shutdown of the server. </p>
<p>Closes all virtual servers, cleans up idle and closed connections. Then enters another event loop with two conditions:</p><ol type="1">
<li>last signal received is SIGQUIT (which initiated graceful shutdown)</li>
<li>as long as active connections exist. This second loop always cleans up idle connections. It can also be interrupted with another signal, which aborts the graceful shutdown.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>The server object to shut down. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a href="https://pkg.go.dev/net/http#Server.Shutdown">https://pkg.go.dev/net/http#Server.Shutdown</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="_server_8cpp_source.html#l01479">1479</a> of file <a class="el" href="_server_8cpp_source.html">Server.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;{</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Closing all virtual servers&quot;</span>;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;int, Socket&gt;::iterator iter = server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().begin();</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;         iter != server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().end(); ++iter) {</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        server.<a class="code" href="class_server.html#a3ea71b66d27b584d8c33eb5cb64813f1">removeEvent</a>(iter-&gt;first);</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        close(iter-&gt;first);</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    }</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    server.<a class="code" href="class_server.html#a878b0cc2f9bc228dd12b250d95d61a75">getVirtualServers</a>().clear();</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160; </div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Cleanup idle connections&quot;</span>;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <a class="code" href="_server_8cpp.html#af2feae308a0fa968c84525fcdfb19251">cleanupIdleConnections</a>(server);</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <a class="code" href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">cleanupClosedConnections</a>(server);</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160; </div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <a class="code" href="_log_8hpp.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;Waiting for connections to finish&quot;</span>;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a> == SIGQUIT &amp;&amp; !server.<a class="code" href="class_server.html#a1f8929bed093f869374cb81da4d97505">getConnections</a>().empty()) {</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> nfds = server.<a class="code" href="class_server.html#acbcbebe2c30446acc9a90f40f9986b62">waitForEvents</a>();</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160; </div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        <span class="keywordflow">for</span> (std::vector&lt;struct epoll_event&gt;::const_iterator iter = server.<a class="code" href="class_server.html#a1768b6e65ed7b3205141698ca459ffd8">eventsBegin</a>();</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;             iter != server.<a class="code" href="class_server.html#a1768b6e65ed7b3205141698ca459ffd8">eventsBegin</a>() + nfds; ++iter) {</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            <a class="code" href="_server_8cpp.html#af9f4479a6262c17deef89938118d27f4">handleEvent</a>(server, *iter);</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        }</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        <a class="code" href="_server_8cpp.html#a28fd29ec48bd9459c678980cfccca4cf">checkForTimeout</a>(server);</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        <a class="code" href="_server_8cpp.html#af2feae308a0fa968c84525fcdfb19251">cleanupIdleConnections</a>(server);</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        <a class="code" href="_server_8cpp.html#a9e2693ba11e20b84de090bcdd0b665db">cleanupClosedConnections</a>(server);</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    }</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a> != SIGQUIT)</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Graceful shutdown interrupted with signal &quot;</span> &lt;&lt; <a class="code" href="signal_handler_8hpp.html#a8dcc1e48e0bf890094e11efb58edafa1">g_signalStatus</a>;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        <a class="code" href="_log_8hpp.html#aeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a> &lt;&lt; <span class="stringliteral">&quot;Server shutdown gracefully&quot;</span>;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;}</div>
<div class="ttc" id="a_server_8cpp_html_af2feae308a0fa968c84525fcdfb19251"><div class="ttname"><a href="_server_8cpp.html#af2feae308a0fa968c84525fcdfb19251">cleanupIdleConnections</a></div><div class="ttdeci">void cleanupIdleConnections(Server &amp;server)</div><div class="ttdoc">Iterates through all connections, closes and removes idle ones.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l01453">Server.cpp:1453</a></div></div>
<div class="ttc" id="aclass_server_html_a3ea71b66d27b584d8c33eb5cb64813f1"><div class="ttname"><a href="class_server.html#a3ea71b66d27b584d8c33eb5cb64813f1">Server::removeEvent</a></div><div class="ttdeci">void removeEvent(int delfd) const</div><div class="ttdoc">Wrapper function to EpollWrapper::removeEvent.</div><div class="ttdef"><b>Definition:</b> <a href="_server_8cpp_source.html#l00308">Server.cpp:308</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a115ecd76e344c1007bedc48b9bbdc0fa_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="_server_8cpp_a115ecd76e344c1007bedc48b9bbdc0fa_icgraph.svg" width="374" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="_server_8cpp.html">Server.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
